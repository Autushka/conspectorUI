/*! conspector 12-12-2014 */
var app=angular.module("conspector",["ui.router","viewControllers","pascalprecht.translate","ngCookies","ngTable"]),viewControllers=angular.module("viewControllers",[]);app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/signIn"),a.state("signIn",{url:"/signIn",templateUrl:"apps/conspector/components/userManagement/templates/signInView.html",controller:"signInView"})}]),app.factory("CONSTANTS",["dataProvider",function(){return{messageDisplayTime:5e3,messageDisplayLayout:"topCenter",currentProject:"conspector",appPathname:"",sServicePath:"odata.svc/"}}]),app.controller("mainController",["$scope",function(){}]),app.factory("rolesSettings",[function(){return{oInitialViews:{systemAdministrator:"#/app/deficienciesList"}}}]),app.factory("TYPES",[function(){return{oEntityCacheStructure:{aCachedRequests:[],oCurrentEntity:{},bDisplayMode:!0,bCreateNewMode:!1,sListSearchFilter:"",oListColumnFilters:{},oListSelectCriterias:{}}}}]),app.factory("apiProvider",["dataProvider",function(a){return{getUserProfile:function(b){var c=CONSTANTS.sServicePath+"Users('"+b+"')?$expand=User_RoleDetails/RoleDetails&$format=json",d=[],e=!1,f=function(a){e=a.d.bIsInitialPassword;for(var b=0;b<a.d.User_RoleDetails.results.length;b++)d.push(a.d.User_RoleDetails.results[b].RoleDetails.RoleName)};return a.ajaxRequest({sPath:c,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:f}}),{sUserName:b,aUserRoles:d,bIsInitialPassword:e}}}}]),app.factory("cacheProvider",["TYPES",function(a){return{oEntitiesCache:{oDeficiencyEntity:a.oEntityCacheStructure,oAccountEntity:a.oEntityCacheStructure,oUnitEntity:a.oEntityCacheStructure,oUserEntity:a.oEntityCacheStructure,oRoleEntity:a.oEntityCacheStructure,oProjectEntity:a.oEntityCacheStructure,oStatusEntity:a.oEntityCacheStructure,oPriorityEntity:a.oEntityCacheStructure,oVersion:a.oEntityCacheStructure,oAccountTypeEntity:a.oEntityCacheStructure},oUserProfile:{},getFromCache:function(a,b){for(var c=0;c<this.oEntitiesCache[a].aCachedRequests.length;c++)if(this.oEntitiesCache[a].aCachedRequests[c].sRequestSettings===b)return this.oEntitiesCache[a].aCachedRequests[c].aEntitiesArray;return[]},putToCache:function(a,b,c){this.oEntitiesCache[a].aCachedRequests.push({sRequestSettings:b,aEntitiesArray:c})},cleanEntitiesCache:function(b,c){if(b&&!c)return void(this.oEntitiesCache[b]=a.oEntityCacheStructure);if(b&&c){for(var d=0;d<this.oEntitiesCache[b].aCachedRequests.length;d++)if(this.oEntitiesCache[b].aCachedRequests[d].sRequestSettings===c){this.oEntitiesCache[b].aCachedRequests.splice(d,1);break}}else for(var e in this.oEntitiesCache)this.oEntitiesCache[e]=a.oEntityCacheStructure}}}]),app.factory("genericODataFactory",["$resource","CONSTANTS",function(a,b){var c=b.sServicePath;return a("",{},{getEntitySetWithFilterAndExpand:{method:"GET",url:c+":path?$filter=:filter&$expand=:expand&$format=json"},getEntitySetWithFilter:{method:"GET",url:c+":path?$filter=:filter&$format=json"},getEntitySetWithExpand:{method:"GET",url:c+":path?$expand=:expand&$format=json"},getEntitySet:{method:"GET",url:c+":path?$format=json"},post:{method:"POST",url:c+":path"},put:{method:"PUT",params:{key:"@key"},url:c+":path(':key')?$format=json"},getEntity:{method:"GET",params:{key:"@key"},url:c+":path(':key')?$expand=:expand&$format=json"},"delete":{method:"DELETE",params:{key:"@key"},url:c+":path(':key')"}})}]),app.factory("dataProvider",["genericODataFactory","utilsProvider","$q","$rootScope",function(a,b,c,d){return{commonOnSuccess:function(a){a.bShowSpinner&&d.$emit("UNLOAD"),a.bShowSuccessMessage&&b.displayMessage({sText:jQuery.i18n.prop("globalTE.successOperationNoticeTE"),sType:"success"})},commonOnError:function(a,c){a.bShowSpinner&&d.$emit("UNLOAD"),a.bShowErrorMessage&&b.displayMessage({sText:jQuery.i18n.prop("globalTE.failureOperationNoticeTE"),sType:"error"}),c.reject()},getEntitySet:function(b){var e={},f=c.defer(),g=[],h=b.sKey+b.sFilter+b.sExpand;return b.oCacheProvider&&b.sCacheProviderAttribute&&(g=b.oCacheProvider.getFromCache(b.sCacheProviderAttribute,h),g.length)?g:(b.bShowSpinner&&d.$emit("LOAD"),b.sFilter&&b.sExpand&&(e=(new a).$getEntitySetWithFilterAndExpand({path:b.sPath,expand:b.sExpand,filter:b.sFilter})),b.sFilter&&!b.sExpand&&(e=(new a).$getEntitySetWithFilter({path:b.sPath,filter:b.sFilter})),!b.sFilter&&b.sExpand&&(e=(new a).$getEntitySetWithExpand({path:b.sPath,expand:b.sExpand})),b.sFilter||b.sExpand||(e=(new a).$getEntitySet({path:b.sPath})),e.then($.proxy(function(a){b.oCacheProvider&&b.sCacheProviderAttribute&&a.d.results.length&&b.oCacheProvider.putToCache(b.sCacheProviderAttribute,h,a.d.results),this.commonOnSuccess(b),f.resolve(a.d.results)},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise)},getEntity:function(b){var e={},f=c.defer();return b.bShowSpinner&&d.$emit("LOAD"),e=(new a).$getEntity({path:b.sPath,expand:b.sExpand,key:b.sKey}),e.then($.proxy(function(a){this.commonOnSuccess(b),f.resolve(a.d)},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise},updateEntity:function(b){var e={},f=c.defer();return b.bShowSpinner&&d.$emit("LOAD"),e=new a(b.oData).$put({path:b.sPath,key:b.sKey}),e.then($.proxy(function(a){this.commonOnSuccess(b),f.resolve(a.d)},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise},createEntity:function(b){var e={},f=c.defer();return b.bShowSpinner&&d.$emit("LOAD"),e=new a(b.oData).$post({path:b.path}),e.then($.proxy(function(a){this.commonOnSuccess(b),f.resolve(a.d)},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise},deleteEntity:function(b){var e={},f=c.defer();return b.bShowSpinner&&d.$emit("LOAD"),e=(new a).$delete({path:b.sPath,key:b.sKey}),e.then($.proxy(function(){this.commonOnSuccess(b),f.resolve()},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise},httpRequest:function(a){var b="",e="application/x-www-form-urlencoded",f=[],g={},h={};a.sRequestType||(a.sRequestType="GET");for(var i in a.oUrlParameters)f.push(i+"="+a.oUrlParameters[i]);for(var j=0;j<f.length;j++)b+=f[j],j!==f.length-1&&(b+="&");return g=c.defer(),a.bShowBusyIndicator&&d.$emit("LOAD"),h=$http({url:a.sPath,method:sRequestType,headers:{"Content-Type":e},data:b}),h.success($.proxy(function(b){this.commonOnSuccess(a),g.resolve(b)},this)),h.error($.proxy(function(){this.commonOnError(a,g)},this)),g.promise},ajaxRequest:function(a){a.sRequestType||(a.sRequestType="POST"),$.ajax({type:a.sRequestType,async:a.bAsync,url:a.sPath,data:a.oData,beforeSend:function(){},success:function(b){a.oEventHandlers&&a.oEventHandlers.onSuccess&&a.oEventHandlers.onSuccess(b)},error:function(b){a.oEventHandlers&&a.oEventHandlers.onError&&a.oEventHandlers.onError(b)}})}}}]),app.config(["$translateProvider",function(a){a.translations("en",{signIn_userName:"Username",signIn_password:"Password",signIn_logIn:"Log In",signIn_languageCode:"EN",signIn_forgotPassword:"Forgot your password?"}),a.translations("fr",{signIn_userName:"Utilisateur",signIn_password:"Mot de pass",signIn_logIn:"Connection",signIn_languageCode:"FR",signIn_forgotPassword:"Mot de passe oubliÃ©?"}),a.preferredLanguage("en"),a.useCookieStorage()}]),app.factory("utilsProvider",["ngTableParams","$translate",function(a,b){return{changeLanguage:function(){var a=b.use();switch(a){case"en":b.use("fr");break;case"fr":b.use("en")}},setCookieFromJson:function(a,b){$.removeCookie(a),$.cookie(a,JSON.stringify(b))},getJsonCookie:function(a){return $.cookie(a)?JSON.parse($.cookie(a)):void 0},removeCookie:function(a){$.removeCookie(a)},convertJsonArrayToString:function(a){sReturn="[";for(var b=0;b<a.length;b++){sReturn+="{";var c=[];for(var d in a[b])c.push(d);for(var e=0;e<c.length;e++)sReturn=e!=c.length-1?sReturn+'"'+c[e]+'":"'+a[b][c[e]]+'", ':sReturn+'"'+c[e]+'":"'+a[b][c[e]]+'"';sReturn+=b!=a.length-1?"}, ":"}"}return sReturn+="]",sReturn},getParameterByName:function(a){var b=window.location.href.replace("#","");a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))},displayMessage:function(a){noty({text:a.sText,type:a.sType,layout:CONSTANTS.messageDisplayLayout,timeout:CONSTANTS.messageDisplayTime})},messagesHandler:function(a){for(var b=!0,c=0;c<a.length;c++){var d=a[c].messageCode.toString(),e=jQuery.i18n.prop("messages.m"+a[c].messageCode);switch(d[c].substring(0,1)){case"1":this.displayMessage({sText:e,sType:"success"});break;case"2":this.displayMessage({sText:e,sType:"error"}),b=!1;break;case"3":this.displayMessage({sText:e,sType:"warning"})}}return b},createNgTableParams:function(b){var c=new a({page:1,filterDelay:100,count:1e3},{groupBy:b.groupTableBy,total:b.oTableDataArrays[b.sSourceDataArrayAttribute].length,getData:function(a,c){c.settings().filterDelay=10,c.settings().setGroupsInfo(),c.settings().counts=[50,500,1e3];var d=[];if(void 0===c.sorting()||JSON.stringify(c.sorting())===JSON.stringify({}))d=b.oTableDataArrays[b.sSourceDataArrayAttribute];else{var e=c.orderBy();b.groupTableBy&&e.unshift(b.groupTableBy),d=$filter("orderBy")(b.oTableDataArrays[b.sSourceDataArrayAttribute],e)}var f="";if(c.filter().$){f=c.filter().$;for(var g in c.filter())0===g.indexOf("$")&&delete c.filter().property}if(void 0!==c.filter()&&JSON.stringify(c.filter())!==JSON.stringify({})&&(d=$filter("filter")(d,c.filter(),function(a,b){return a=a.toString().toLowerCase(),b=b.toString().toLowerCase(),0===b.indexOf("=")?(b=b.slice(1,b.length),angular.equals(b,a)):a.indexOf(b)>=0?!0:!1})),f){for(var h=f.toLowerCase(),i=[],j=!1,k="",l=0;l<d.length;l++){j=!1;for(var g in d[l])"string"==typeof d[l][g]&&(k=d[l][g].toLowerCase(),k.indexOf(h)>=0&&0!==g.indexOf("_")&&0!==g.indexOf("$")&&(j=!0)),"number"==typeof d[l][g]&&(k=d[l][g].toString(),k.indexOf(h)>=0&&0!==g.indexOf("_")&&0!==g.indexOf("$")&&(j=!0));j&&i.push(d[l])}d=i,c.filter().$=f}c.total(d.length),c.total()<(c.page()-1)*c.count()&&c.page(1),a.resolve(b.oTableData[b.sTargerObjectAttribute]=d.slice((c.page()-1)*c.count(),c.page()*c.count()))},$scope:b.scope});return c}}}]),viewControllers.controller("signInView",["$scope","$state","utilsProvider",function(a,b,c){a.viewData={userName:"",password:""},a.onChangeLanguage=function(){c.changeLanguage()}}]);