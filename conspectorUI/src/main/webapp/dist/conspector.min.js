/*! conspector 05-02-2015 */

var app=angular.module("conspector",["ui.router","viewControllers","pascalprecht.translate","ngCookies","ngTable","ngResource","ngMaterial","multi-select","angularFileUpload","colorpicker.module","pubnub.angular.service","ngTagsInput","ngAnimate","filtersProvider","ngMessages"]),viewControllers=angular.module("viewControllers",[]);app.config(["$mdThemingProvider",function(a){a.definePalette("conspectorColorPalette",{50:"55b0d0",100:"44a8cb",200:"33a0c6",300:"2298c1",400:"1190bd",500:"0088b8",600:"007da9",700:"00729b",800:"00678c",900:"005c7d",A100:"0088b8",A200:"0088b8",A400:"0088b8",A700:"0088b8",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),a.theme("default").primaryColor("conspectorColorPalette").accentColor("conspectorColorPalette"),a.definePalette("conspectorColorPaletteNavbar",{50:"8e9192",100:"838687",200:"787b7d",300:"6d7072",400:"616567",500:"565a5c",600:"4f5355",700:"484c4d",800:"414446",900:"3a3d3f",A100:"565a5c",A200:"565a5c",A400:"565a5c",A700:"565a5c",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),a.theme("conspectorColorPaletteNavbar").primaryColor("conspectorColorPaletteNavbar").accentColor("conspectorColorPaletteNavbar")}]),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/signIn"),a.state("signIn",{url:"/signIn",templateUrl:"apps/conspector/components/userManagement/templates/signInView.html",controller:"signInView"}),a.state("forgotPassword",{url:"/forgotPassword",templateUrl:"apps/conspector/components/userManagement/templates/forgotPasswordView.html",controller:"forgotPasswordView"}),a.state("initialPasswordReset",{url:"/initialPasswordReset",templateUrl:"apps/conspector/components/userManagement/templates/initialPasswordResetView.html",controller:"initialPasswordResetView"}),a.state("companySelection",{url:"/companySelection",templateUrl:"apps/conspector/components/userManagement/templates/companySelectionView.html",controller:"companySelectionView"}),a.state("roleSelection",{url:"/roleSelection",templateUrl:"apps/conspector/components/userManagement/templates/roleSelectionView.html",controller:"roleSelectionView"}),a.state("resetPassword",{url:"/resetPassword/:pr",templateUrl:"apps/conspector/components/userManagement/templates/passwordResetView.html",controller:"passwordResetView"}),a.state("app",{url:"/app",templateUrl:"apps/conspector/components/generalLayout/templates/appView.html",controller:"appView"}),a.state("app.deficienciesList",{url:"/deficienciesList",templateUrl:"apps/conspector/components/deficiencies/templates/deficienciesListView.html",controller:"deficienciesListView"}),a.state("app.deficiencyDetailsWrapper",{templateUrl:"apps/conspector/components/deficiencies/templates/deficiencyDetailsWrapperView.html",controller:"deficiencyDetailsWrapperView"}),a.state("app.deficiencyDetailsWrapper.deficiencyDetails",{url:"/deficiencyDetails/:sDeficiencyGuid/:sMode",views:{deficiencyDetails:{templateUrl:"apps/conspector/components/deficiencies/templates/deficiencyDetailsView.html",controller:"deficiencyDetailsView"}}}),a.state("app.unitsList",{url:"/unitsList",templateUrl:"apps/conspector/components/units/templates/unitsListView.html",controller:"unitsListView"}),a.state("app.contractorsList",{url:"/contractorsList",templateUrl:"apps/conspector/components/contractors/templates/contractorsListView.html",controller:"contractorsListView"}),a.state("app.contractorDetailsWrapper",{templateUrl:"apps/conspector/components/contractors/templates/contractorDetailsWrapperView.html",controller:"contractorDetailsWrapperView"}),a.state("app.contractorDetailsWrapper.contractorDetails",{url:"/contractorDetails/:sContractorGuid/:sMode",views:{contractorDetails:{templateUrl:"apps/conspector/components/contractors/templates/contractorDetailsView.html",controller:"contractorDetailsView"},contractorContacts:{templateUrl:"apps/conspector/components/contacts/templates/contactsListView.html",controller:"contactsListView"},contractorActivities:{templateUrl:"apps/conspector/components/activities/templates/activitiesListView.html",controller:"activitiesListView"}}}),a.state("app.clientsList",{url:"/clientsList",templateUrl:"apps/conspector/components/clients/templates/clientsListView.html",controller:"clientsListView"}),a.state("app.clientDetailsWrapper",{templateUrl:"apps/conspector/components/clients/templates/clientDetailsWrapperView.html",controller:"clientDetailsWrapperView"}),a.state("app.clientDetailsWrapper.clientDetails",{url:"/clientDetails/:sClientGuid/:sMode",views:{clientDetails:{templateUrl:"apps/conspector/components/clients/templates/clientDetailsView.html",controller:"clientDetailsView"},clientContacts:{templateUrl:"apps/conspector/components/contacts/templates/contactsListView.html",controller:"contactsListView"},clientActivities:{templateUrl:"apps/conspector/components/activities/templates/activitiesListView.html",controller:"activitiesListView"}}}),a.state("app.contactsList",{url:"/contactsList",templateUrl:"apps/conspector/components/contacts/templates/contactsListView.html",controller:"contactsListView"}),a.state("app.contactDetailsWrapper",{templateUrl:"apps/conspector/components/contacts/templates/contactDetailsWrapperView.html",controller:"contactDetailsWrapperView"}),a.state("app.contactDetailsWrapper.contactDetails",{url:"/contactDetails/:sAccountGuid/:sContactGuid/:sMode",views:{contactDetails:{templateUrl:"apps/conspector/components/contacts/templates/contactDetailsView.html",controller:"contactDetailsView"}}}),a.state("app.activitiesList",{url:"/activitiesList",templateUrl:"apps/conspector/components/activities/templates/activitiesListView.html",controller:"activitiesListView"}),a.state("app.activityDetailsWrapper",{templateUrl:"apps/conspector/components/activities/templates/activityDetailsWrapperView.html",controller:"activityDetailsWrapperView"}),a.state("app.activityDetailsWrapper.activityDetails",{url:"/activityDetails/:sActivityGuid/:sMode",views:{activityDetails:{templateUrl:"apps/conspector/components/activities/templates/activityDetailsView.html",controller:"activityDetailsView"}}}),a.state("app.adminPanel",{url:"/adminPanel",templateUrl:"apps/conspector/components/adminPanel/templates/adminPanelView.html",controller:"adminPanelView"}),a.state("app.adminPanel.companiesList",{url:"/companiesList",templateUrl:"apps/conspector/components/adminPanel/templates/companiesListView.html",controller:"companiesListView"}),a.state("app.adminPanel.usersList",{url:"/usersList",templateUrl:"apps/conspector/components/adminPanel/templates/usersListView.html",controller:"usersListView"}),a.state("app.adminPanel.userDetails",{url:"/userDetails/:sUserName/:sMode",templateUrl:"apps/conspector/components/adminPanel/templates/userDetailsView.html",controller:"userDetailsView"}),a.state("app.adminPanel.rolesList",{url:"/rolesList",templateUrl:"apps/conspector/components/adminPanel/templates/rolesListView.html",controller:"rolesListView"}),a.state("app.adminPanel.projectsList",{url:"/projectsList",templateUrl:"apps/conspector/components/adminPanel/templates/projectsListView.html",controller:"projectsListView"}),a.state("app.adminPanel.phasesList",{url:"/phasesList",templateUrl:"apps/conspector/components/adminPanel/templates/phasesListView.html",controller:"phasesListView"}),a.state("app.adminPanel.deficiencyStatusesList",{url:"/deficiencyStatusesList",templateUrl:"apps/conspector/components/adminPanel/templates/deficiencyStatusesListView.html",controller:"deficiencyStatusesListView"}),a.state("app.adminPanel.systemFiles",{url:"/systemFiles",templateUrl:"apps/conspector/components/adminPanel/templates/systemFilesView.html",controller:"systemFilesView"}),a.state("app.adminPanel.operationLogsList",{url:"/operationLogsList",templateUrl:"apps/conspector/components/adminPanel/templates/operationLogsListView.html",controller:"operationLogsListView"}),a.state("app.adminPanel.accountTypesList",{url:"/accountTypesList",templateUrl:"apps/conspector/components/adminPanel/templates/accountTypesListView.html",controller:"accountTypesListView"}),a.state("app.adminPanel.contactTypesList",{url:"/contactTypesList",templateUrl:"apps/conspector/components/adminPanel/templates/contactTypesListView.html",controller:"contactTypesListView"}),a.state("app.adminPanel.deficiencyPrioritiesList",{url:"/deficiencyPrioritiesList",templateUrl:"apps/conspector/components/adminPanel/templates/deficiencyPrioritiesListView.html",controller:"deficiencyPrioritiesListView"}),a.state("app.adminPanel.unitOptionSetList",{url:"/unitOptionSetList",templateUrl:"apps/conspector/components/adminPanel/templates/unitOptionSetListView.html",controller:"unitOptionSetListView"}),a.state("app.adminPanel.unitOptionValueList",{url:"/unitOptionValueList",templateUrl:"apps/conspector/components/adminPanel/templates/unitOptionValueListView.html",controller:"unitOptionValueListView"}),a.state("app.adminPanel.taskTypeList",{url:"/taskTypeList",templateUrl:"apps/conspector/components/adminPanel/templates/taskTypeListView.html",controller:"taskTypeListView"}),a.state("app.adminPanel.activityTypesList",{url:"/activityTypeList",templateUrl:"apps/conspector/components/adminPanel/templates/activityTypesListView.html",controller:"activityTypesListView"}),a.state("app.profileSettings",{url:"/profileSettings",templateUrl:"apps/conspector/components/profileSettings/templates/profileSettingsView.html",controller:"profileSettingsView"}),a.state("app.profileSettings.contactDetails",{url:"/profileSettings.contactDetails/:sAccountGuid/:sContactGuid/:sMode",templateUrl:"apps/conspector/components/contacts/templates/contactDetailsView.html",controller:"contactDetailsView"}),a.state("app.profileSettings.profileDetails",{url:"/profileDetails",templateUrl:"apps/conspector/components/profileSettings/templates/profileDetailsView.html",controller:"profileDetailsView"}),a.state("app.profileSettings.changePassword",{url:"/changePassword",templateUrl:"apps/conspector/components/profileSettings/templates/changePasswordView.html",controller:"changePasswordView"})}]),app.factory("CONSTANTS",[function(){return{messageDisplayTime:5e3,messageDisplayLayout:"topCenter",currentProject:"conspector",appPathname:"",sServicePath:"odata.svc/",sDefaultRoleNameForNewCompany:"systemAdministrator"}}]),app.factory("TYPES",[function(){return{oEntityCacheStructure:{aCachedRequests:[],sListSearchFilter:"",oListColumnFilters:{},oListSelectCriterias:{}}}}]),app.factory("cacheProvider",["TYPES",function(a){return{oEntitiesCache:{oDeficiencyEntity:angular.copy(a.oEntityCacheStructure),oAccountEntity:angular.copy(a.oEntityCacheStructure),oUnitEntity:angular.copy(a.oEntityCacheStructure),oCompanyEntity:angular.copy(a.oEntityCacheStructure),oUserEntity:angular.copy(a.oEntityCacheStructure),oRoleEntity:angular.copy(a.oEntityCacheStructure),oProjectEntity:angular.copy(a.oEntityCacheStructure),oPhaseEntity:angular.copy(a.oEntityCacheStructure),oRoleEntity:angular.copy(a.oEntityCacheStructure),oOperationLogEntity:angular.copy(a.oEntityCacheStructure),oTaskStatusEntity:angular.copy(a.oEntityCacheStructure),oTaskPriorityEntity:angular.copy(a.oEntityCacheStructure),oPriorityEntity:angular.copy(a.oEntityCacheStructure),oAccountTypeEntity:angular.copy(a.oEntityCacheStructure),oContactTypeEntity:angular.copy(a.oEntityCacheStructure),oActivityTypeEntity:angular.copy(a.oEntityCacheStructure),oCountryEntity:angular.copy(a.oEntityCacheStructure),oContactEntity:angular.copy(a.oEntityCacheStructure),oActivityEntity:angular.copy(a.oEntityCacheStructure),oUnitOptionSetEntity:angular.copy(a.oEntityCacheStructure),oUnitOptionValueEntity:angular.copy(a.oEntityCacheStructure),oTaskTypeEntity:angular.copy(a.oEntityCacheStructure)},oUserProfile:{},oTableStatus:{deficienciesList:[{sStateName:"app.deficienciesList",aGroups:[],oFilter:{},oSorting:{}}],contactsList:[{sStateName:"app.contactsList",aGroups:[],oFilter:{},oSorting:{}}],clientsList:[{sStateName:"app.clientsList",aGroups:[],oFilter:{},oSorting:{}}],contractorsList:[{sStateName:"app.contractorsList",aGroups:[],oFilter:{},oSorting:{}}],activitiesList:[{sStateName:"app.activitiesList",aGroups:[],oFilter:{},oSorting:{}}],unitsList:[{sStateName:"app.unitsList",aGroups:[],oFilter:{},oSorting:{}}]},getTableStatusFromCache:function(a){for(var b=0;b<this.oTableStatus[a.sTableName].length;b++)if(this.oTableStatus[a.sTableName][b].sStateName===a.sStateName)return{aGroups:angular.copy(this.oTableStatus[a.sTableName][b].aGroups),oSorting:angular.copy(this.oTableStatus[a.sTableName][b].oSorting),oFilter:angular.copy(this.oTableStatus[a.sTableName][b].oFilter)}},putTableStatusToCache:function(a){for(var b={},c=0;c<this.oTableStatus[a.sTableName].length;c++)if(this.oTableStatus[a.sTableName][c].sStateName===a.sStateName){this.oTableStatus[a.sTableName][c].oFilter=angular.copy(a.oFilter),this.oTableStatus[a.sTableName][c].oSorting=angular.copy(a.oSorting),this.oTableStatus[a.sTableName][c].aGroups=angular.copy([]);for(var d=0;d<a.aGroups.length;d++)b=angular.copy({}),b.value=a.aGroups[d].value,a.aGroups[d].$hideRows&&(b.$hideRows=!0),this.oTableStatus[a.sTableName][c].aGroups.push(b)}},getFromCache:function(a,b){for(var c=0;c<this.oEntitiesCache[a].aCachedRequests.length;c++)if(this.oEntitiesCache[a].aCachedRequests[c].sRequestSettings===b)return this.oEntitiesCache[a].aCachedRequests[c].aEntitiesArray;return[]},putToCache:function(a,b,c){this.oEntitiesCache[a].aCachedRequests.push({sRequestSettings:b,aEntitiesArray:c})},cleanEntitiesCache:function(b,c){if(b&&!c)return void(this.oEntitiesCache[b]=angular.copy(a.oEntityCacheStructure));if(b&&c){for(var d=0;d<this.oEntitiesCache[b].aCachedRequests.length;d++)if(this.oEntitiesCache[b].aCachedRequests[d].sRequestSettings===c){this.oEntitiesCache[b].aCachedRequests.splice(d,1);break}}else for(var e in this.oEntitiesCache)this.oEntitiesCache[e]=angular.copy(a.oEntityCacheStructure)},cleanProfileCache:function(){this.oUserProfile={}},cleanAllCache:function(){this.cleanEntitiesCache(),this.cleanProfileCache()},getEntityDetails:function(a){for(var b={},c=0;c<this.oEntitiesCache[a.sCacheProviderAttribute].aCachedRequests.length;c++)if(this.oEntitiesCache[a.sCacheProviderAttribute].aCachedRequests[c].sRequestSettings===a.sRequestSettings){for(var d=0;d<this.oEntitiesCache[a.sCacheProviderAttribute].aCachedRequests[c].aEntitiesArray.length;d++)if(this.oEntitiesCache[a.sCacheProviderAttribute].aCachedRequests[c].aEntitiesArray[d][a.sKeyName]===a.sKeyValue){b=angular.copy(this.oEntitiesCache[a.sCacheProviderAttribute].aCachedRequests[c].aEntitiesArray[d]),console.log("Entitiy: "+a.sCacheProviderAttribute+" retrieved from cache...");break}break}return b}}}]),app.factory("utilsProvider",["$mdToast",function(a){return{displayMessage:function(b){var c=a.simple();c.content(b.sText),c.hideDelay(2e3),c.position("top right"),a.show(c)},generateGUID:function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)});return b},dateToDBDate:function(a){var b=a.getTime()-a.getTime()%1e3;return"/Date("+b.toString()+")/"},dateToString:function(a){var b="",c=a.getDate().toString(),d=(a.getMonth()+1).toString(),e=a.getFullYear(),f=a.getHours();1===f.toString().length&&(f="0"+f);var g=a.getMinutes();1===g.toString().length&&(g="0"+g);var h=a.getSeconds();return 1===h.toString().length&&(h="0"+h),1===c.length&&(c="0"+c),1===d.length&&(d="0"+d),b=d+"."+c+"."+e+" "+f+":"+g+":"+h},dBDateToDate:function(a){if(null===a||void 0===a||""===a)return a;var b=a.substring(6,a.length-2),c=new Date(parseInt(b));return c},dBDateToSting:function(a){return null===a||void 0===a||""===a?a:this.dateToString(this.dBDateToDate(a))},stringToJson:function(a){var b=$.parseJSON(a);return b},setCookieFromJson:function(a,b){$.removeCookie(a),$.cookie(a,JSON.stringify(b))},getJsonCookie:function(a){return $.cookie(a)?JSON.parse($.cookie(a)):void 0},removeCookie:function(a){$.removeCookie(a)},convertJsonArrayToString:function(a){sReturn="[";for(var b=0;b<a.length;b++){sReturn+="{";var c=[];for(var d in a[b])c.push(d);for(var e=0;e<c.length;e++)sReturn=e!=c.length-1?sReturn+'"'+c[e]+'":"'+a[b][c[e]]+'", ':sReturn+'"'+c[e]+'":"'+a[b][c[e]]+'"';sReturn+=b!=a.length-1?"}, ":"}"}return sReturn+="]",sReturn},getParameterByName:function(a){var b=window.location.href.replace("#","");a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))},tagsStringToTagsArray:function(a){var b=[],c=[];if(null===a||void 0===a||""===a)return b;a=a.substring(0,a.length-1),c=a.split(";");for(var d=0;d<c.length;d++)b.push({text:c[d]});return b},tagsArrayToTagsString:function(a){for(var b="",c=0;c<a.length;c++)b=0!==c?b+" "+a[c].text+";":b+a[c].text+";";return b}}}]),app.config(["$translateProvider",function(a){a.translations("en",{global_addNew:"Add New",global_actions:"Actions",global_descriptionEN:"Description EN",global_descriptionFR:"Description FR",global_sortingSequence:"Sorting sequence",global_successOperation:"Operation finished successfully.",global_errorOperation:"Operation failed.",global_errorEntityWasUpdatedBefore:"Operation failed. Data has been modified before you, prease refresh the page and try again.",global_noDefaultViewForTheRole:"Contact your system administrator (No default view assignment to the role)",global_noCompanyAssignment:"Contact your system administrator (No company assignment to the user)",global_noRoleAssignment:"Contact your system administrator (No role assignment to the user)",global_noInitialPasswordProvided:"No initial password has been provided. User creation is not possible",global_changesSaveConfirmationHeader:"Do you want to save changes?",global_changesSaveConfirmationContent:"Unsaved changes will be lost...",global_emptyFields:"Please make sure that all the fields are filled",global_authorizedPhases:"Authorized projects and phases:",global_avatar:"Avatar:",global_noTableData:"No data selected",global_createdBy:"Created By",global_createdAt:"Created At",global_role:"Role",global_company:"Company",global_roles:"Role(s)",global_companies:"Companies",global_project:"Project",global_unitOptionSet:"Unit Option Set",global_upload:"Upload",global_icon:"Icon",global_userName:"Username",global_email:"Email",global_emailPlaceholder:"e.g. sara@conspector.com",global_back:"Back",global_edit:"Edit",global_save:"Save",global_delete:"Delete",global_saveAndNew:"Save and new",global_creationDate:"Creation Date",global_lastModificationDate:"Last Modification Date",global_associatedIconFileGuid:"Associated Icon File Guid",global_associatedColor:"Associated Color",global_password:"Password",global_passwordConfirmation:"Password Confirmation",global_continue:"Continue",global_ok:"Ok",global_yes:"Yes",global_no:"No",global_cancel:"Cancel",global_passwordsDontMatch:"Provided passwords don't match.",global_contractorName:"Contractor",global_clientName:"Client",global_phone:"Phone",global_mobile:"Mobile",global_phonePlaceholder:"e.g. 514-123-1234",global_phoneExtensionPlaceholder:"e.g. #22",global_phoneExtension:"Ext:",global_tags:"Tags",global_name:"Name",global_title:"Title",global_secondaryPhone:"Secondary Phone",global_website:"Website",global_websitePlaceholder:"e.g. www.website.com",global_fax:"Fax",global_associatedPhases:"Associated projects and phases:",global_selectedProjectsAndPhases:"Select Project(s) - Phase(s)",global_billingStreet:"Billing street",global_billingStreetPlaceholder:"e.g. 1010 Brian #213",global_billingCity:"Billing city",global_billingCityPlaceholder:"e.g. Nassau",global_billingPostalCode:"Billing postal code",global_billingPostalCodePlaceholder:"e.g. J01 E24",global_billingCountry:"Billing country:",global_billingProvince:"Billing state/province:",global_shippingStreet:"Shipping street",global_shippingStreetPlaceholder:"e.g. 1010 Brian #213 A",global_shippingCity:"Shipping city",global_shippingCityPlaceholder:"e.g. Nassau",global_shippingPostalCode:"Shipping postal code",global_shippingPostalCodePlaceholder:"e.g. J01 E24",global_shippingCountry:"Shipping country:",global_shippingProvince:"Shipping state/province:",global_tags:"Tags",global_addTag:"Add a tag",global_contactType:"Contact Type:",global_account:"Account",global_selectCountry:"Select Country",global_selectState:"Select Province/State",global_pleaseSaveFirst:"To edit this field, please save first.",global_emptyFieldError:"This field is required",global_minPasswordLength:"Enter a password with 8 characters minimum",m100:"Operation finished successfully.",m101:"Email with instructions to recover your password was successfully sent.",m102:"Your password was successfully changed.",m200:"Username already exists",m201:"User with provided email already exists",m203:"Can't log you in. Please check your Username and Password.",m204:"Email not found.",m205:"Provided Old Password is not correct",m206:"Username not found",app_switchCompanies:"Switch Company",app_switchRoles:"Switch Role",app_logOut:"Log Out",app_adminPanel:"Admin Panel",app_profileSettings:"Profile Settings",app_deficienciesTab:"Deficiencies",app_unitsTab:"Units",app_contractorsTab:"Contractors",app_clientsTab:"Clients",app_contactsTab:"Contacts",profileSettings_menuHeader:"User Menu",profileSettings_profileDetails:"User Profile",profileSettings_contactDetails:"User's Contact",profileSettings_changePassword:"Change Password",profileSettings_hideSidenav:"Open User Menu",profileDetails_title:"User Profile",changePassword_title:"Change Password",changePassword_resetPassword:"Change Password",changePassword_newPassword:"New Password",changePassword_newPasswordConfirmation:"New Password Confirmation",adminPanel_menuHeader:"Admin Panel Menu",adminPanel_companies:"Companies",adminPanel_userManagement:"User Management",adminPanel_roles:"User Roles",adminPanel_projects:"Projects",adminPanel_projectDefaultLabel:"Select Project",adminPanel_unitOptionSetDefaultLabel:"Select Unit Option Set",adminPanel_phases:"Phases",adminPanel_deficiencyStatuses:"Deficiency Statuses",adminPanel_deficiencyStatusIconDefaultLabel:"Select Icon",adminPanel_deficiencyPriorities:"Deficiency Priorities",adminPanel_systemFiles:"System Files",adminPanel_operationLogs:"Operation Logs",adminPanel_accountTypes:"Account Types",adminPanel_contactTypes:"Contact Types",adminPanel_hideSidenav:"Open Admin Panel Menu",adminPanel_unitOptionSet:"Unit Option Set",adminPanel_unitOptionValue:"Unit Option Values",adminPanel_taskType:"Task Type",adminPanel_activityTypes:"Logbook Entries Types",unitOptionValuesList_title:"Unit Option Values",taskTypesList_title:"Task Types",activityTypesList_title:"Logbook Entries Types",companiesList_title:"Companies",companiesList_companyName:"Company Name",usersList_title:"Users List",userDetails_title:"User Details",userDetails_deletionConfirmationHeader:"Are you sure that you want to delete current user?",userDetails_deletionConfirmationContent:"Current user will be deleted...",userDetails_username:"Username:",userDetails_password:"Password:",userDetails_passwordConfirmation:"Password Confirmation:",userDetails_email:"Email:",userDetails_associatedCompanies:"Associated Companies:",userDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",userDetails_associatedRoles:"Roles:",userDetails_avatar:"Profile Picture:",userDetails_associatedContact:"Associated Contact:",userDetails_communicationLanguage:"Preferred Communication Language:",rolesList_title:"User Roles",rolesList_roleName:"Role Name",projectsList_title:"Projects",phasesList_title:"Phases",deficiencyStatuses_title:"Deficiency Statuses",deficiencyPriorities_title:"Deficiency Priorities",operationLogsList_title:"Operation Logs",operationLogsList_operationName:"Operation Name",operationLogsList_operationContent:"Operation Content",accountTypesList_title:"Account Types",contactTypesList_title:"Contact Types",systemFiles_title:"System Files",systemFiles_logos:"Logos",systemFiles_logo:"Logo",systemFiles_deficiencyStatusIcon:"Deficiency Status Icons",systemFiles_Icon:"Icon",signIn_userName:"Username",signIn_password:"Password",signIn_logIn:"Log In to Conspector",signIn_languageCode:"FR",signIn_forgotPassword:"Forgot your password?",signIn_rememberUserName:"Remember Username",initialPasswordReset_headerLabel:"Please enter a new password:",initialPasswordReset_newPassword:"New password",initialPasswordReset_newPasswordConfirmation:"New password confirmation",initialPasswordReset_reset:"Set new password",passwordReset_headerLabel:"Please enter a new password:",passwordReset_newPassword:"New password",passwordReset_newPasswordConfirmation:"New password confirmation",passwordReset_reset:"Set new password",passwordReset_passwordsDontMatch:"Provided passwords don't match.",companySelection_heagerLabel:"Please choose a company:",roleSelection_heagerLabel:"Please choose a role:",forgotPassword_heagerLabel:"Please select what you remember:",forgotPassword_userName:"Username",forgotPassword_email:"Email",forgotPassword_reset:"Reset password",forgotPassword_footerLabel:"Having issues logging in?\nEmail us at ",contractorsList_title:"Contractors List",contractorsList_addNew:"Add Contractor",contractorDetails_title:"Contractor Details",contractorDetails_deletionConfirmationHeader:"You are about to delete a contractor account.",contractorDetails_deletionConfirmationContent:"Are you sure you want to proceed ? All related contacts will be erased.",contractorDetails_name:"Name:",contractorDetails_namePlaceholder:"e.g. ABC Construction",contractorDetails_phone:"Phone:",contractorDetails_secondaryPhone:"Secondary Phone:",contractorDetails_website:"Website:",contractorDetails_email:"Email:",contractorDetails_fax:"Fax:",contractorDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",contractorDetails_descriptionTags:"Description Tags:",contractorDetails_billingStreet:"Billing Street:",contractorDetails_billingCity:"Billing City:",contractorDetails_billingPostalCode:"Postal Code/ZIP:",contractorDetails_billingCountry:"Billing Country:",contractorDetails_billingProvince:"Billing State/Province:",contractorDetails_shippingStreet:"Shipping Street:",contractorDetails_shippingCity:"Shipping City:",contractorDetails_shippingPostalCode:"Postal Code/ZIP:",contractorDetails_shippingCountry:"Shipping Country:",contractorDetails_shippingProvince:"Shipping State/Province:",contactsList_title:"Contacts List",contactDetails_title:"Contact Details",contactsList_addNew:"Add Contact",contactDetails_title:"Contact Details",contactDetails_deletionConfirmationHeader:"You are about to delete a contact.",contactDetails_deletionConfirmationContent:"Are you sure you want to proceed ?",contactDetails_name:"Name:",contactDetails_namePlaceholder:"e.g. Sara",contactDetails_lastName:"Last Name:",contactDetails_lastNamePlaceholder:"e.g. Smith",contactDetails_personTitle:"Title:",contactDetails_personTitlePlaceholder:"e.g. Ms, Director",contactDetails_homePhone:"Home Phone:",contactDetails_workPhone:"Work Phone:",contactDetails_mobilePhone:"Mobile Phone:",contactDetails_email:"Email:",contactDetails_fax:"Fax:",contactDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",contactDetails_associatedParentAccount:"Parent Account:",contactDetails_selectParentAccount:"Select Parent Account",contactDetails_contactType:"Contact Type:",contactDetails_selectContactType:"Select Contact Type",contactDetails_descriptionTags:"Description Tags:",contactDetails_billingStreet:"Billing Street:",contactDetails_billingCity:"Billing City:",contactDetails_billingPostalCode:"Postal Code/ZIP:",contactDetails_billingCountry:"Billing Country:",contactDetails_billingProvince:"Billing State/Province:",contactDetails_shippingStreet:"Shipping Street:",contactDetails_shippingCity:"Shipping City:",contactDetails_shippingPostalCode:"Postal Code/ZIP:",contactDetails_shippingCountry:"Shipping Country:",contactDetails_shippingProvince:"Shipping State/Province:",clientsList_title:"Clients List",clientsList_addNew:"Add Client Account",clientDetails_title:"Client Details",clientDetails_deletionConfirmationHeader:"You are about to delete a client account.",clientDetails_deletionConfirmationContent:"Are you sure you want to proceed ? All related contacts will be erased.",clientDetails_name:"Name:",clientDetails_namePlaceholder:"e.g. Sara Conspector",clientDetails_phone:"Phone:",clientDetails_secondaryPhone:"Secondary Phone:",clientDetails_website:"Website:",clientDetails_email:"Email:",clientDetails_fax:"Fax:",clientDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",clientDetails_descriptionTags:"Description Tags:",clientDetails_billingStreet:"Billing Street:",clientDetails_billingCity:"Billing City:",clientDetails_billingPostalCode:"Postal Code/ZIP:",clientDetails_billingCountry:"Billing Country:",clientDetails_billingProvince:"Billing State/Province:",clientDetails_shippingStreet:"Shipping Street:",clientDetails_shippingCity:"Shipping City:",clientDetails_shippingPostalCode:"Postal Code/ZIP:",clientDetails_shippingCountry:"Shipping Country:",clientDetails_shippingProvince:"Shipping State/Province:"}),a.translations("fr",{global_addNew:"Ajouter",global_actions:"Actions",global_descriptionEN:"Description EN",global_descriptionFR:"Description FR",global_sortingSequence:"Ordre",global_successOperation:"Opération terminée avec succès",global_errorOperation:"Opération échouchée.",global_errorEntityWasUpdatedBefore:"Operation failed. Data has been modified before you, prease refresh the page and try again.",global_noDefaultViewForTheRole:"Svp contacter le support Conspector (Pas de vue associée à votre utilisateur)",global_noCompanyAssignment:"Svp contacter le support Conspector (Pas de compagnie associée à votre utilisateur)",global_noRoleAssignment:"Svp contacter le support Conspector (Pas de rôle associé à votre utilisateur)",global_noInitialPasswordProvided:"Mot de passe manquant. La création dun utilisateur requiert un mot de passe",global_changesSaveConfirmationHeader:"Voulez vous sauvegarder les changements?",global_changesSaveConfirmationContent:"Les changements non sauvegardés seront perdus...",global_emptyFields:"Veuillez svp remplir les champs requis",global_authorizedPhases:"Projets et phases autorisés:",global_avatar:"Avatar:",global_noTableData:"Pas de données à afficher",global_createdBy:"Créé par",global_createdAt:"Créé à",global_role:"Rôle",global_company:"Compagnie",global_roles:"Rôle(s)",global_companies:"Compagnie(s)",global_project:"Projet",global_unitOptionSet:"Unit Option Set",global_upload:"Charger",global_icon:"Icône",global_userName:"Nom d'utilisateur",global_email:"Email",global_emailPlaceholder:"e.g. sara@conspector.com",global_back:"Retour",global_edit:"Modifier",global_save:"Sauvegarder",global_delete:"Effacer",global_saveAndNew:"Sauvegarder et ajouter autre",global_creationDate:"Date de création",global_lastModificationDate:"Dernière modification",global_associatedIconFileGuid:"Guid du fichier d'icône associé",global_associatedColor:"Couleur associée",global_password:"Mot de passe",global_passwordConfirmation:"Confirmation du mot de passe",global_continue:"Continuer",global_ok:"Ok",global_yes:"Oui",global_no:"Non",global_cancel:"Annuler",global_passwordsDontMatch:"Les mots de passe ne correspondent pas.",global_contractorName:"Sous-traitant",global_clientName:"Client",global_phone:"Téléphone",global_mobile:"Cellulaire",global_phonePlaceholder:"e.g. 514-123-1234",global_phoneExtensionPlaceholder:"e.g. #22",global_phoneExtension:"Poste :",global_tags:"Tags",global_name:"Nom",global_title:"Titre",global_secondaryTelephone:"Téléphone secondaire",global_website:"Site web",global_websitePlaceholder:"e.g. www.website.com",global_fax:"Fax",global_associatedPhases:"Projets et phases associés:",global_selectedProjectsAndPhases:"Sélectionner projet(s) - phase(s)",global_billingStreet:"Adresse facturation",global_billingStreetPlaceholder:"e.g. 1010 Brian #213",global_billingCity:"Ville facturation",global_billingCityPlaceholder:"e.g. Nassau",global_billingPostalCode:"Code postal facturation",global_billingPostalCodePlaceholder:"e.g. J01 E24",global_billingCountry:"Pays facturation :",global_billingProvince:"Provice/état facturation:",global_shippingStreet:"Adresse livraison",global_shippingStreetPlaceholder:"e.g. 1010 Brian #213 A",global_shippingCity:"Ville livraison",global_shippingCityPlaceholder:"e.g. Nassau",global_shippingPostalCode:"Code postal livraison",global_shippingPostalCodePlaceholder:"e.g. J01 E24",global_shippingCountry:"Pays livraison:",global_shippingProvince:"Province/état livraison:",global_tags:"Tags",global_addTag:"Ajouter un mot clef",global_contactType:"Type de contact:",global_account:"Compte",global_selectCountry:"Sélectionner pays",global_selectState:"Sélectionner province/état",global_pleaseSaveFirst:"Pour modifier ce champ, veuillez d'abord sauvegarder.",global_emptyFieldError:"Ce champ est requis",global_minPasswordLength:"Le mot de passe doit comporter au moins 8 charactères",m100:"Opération complétée avec succès.",m101:"Un email contenant les instructions pour votre mot de passe vous a été envoyé.",m102:"Votre mot de passe a bien été modifié.",m200:"Ce nom d'utilisateur est déjà utilisé",m201:"Un autre utilisateur est enregistré avec cette adresse email.",m203:"Connexion impossible, svp vérifier votre nom d'utilisateur et mot de passe.",m204:"Email non trouvé.",m205:"Le mot de passe fourni est incorrect.",m206:"Nom d'utilisateur non trouvé",app_switchCompanies:"Changer de compagnie",app_switchRoles:"Changer de rôle",app_logOut:"Quitter",app_adminPanel:"Configuration",app_profileSettings:"Réglages utilisateur",app_deficienciesTab:"Déficiences",app_unitsTab:"Unités",app_contractorsTab:"Sous-traitants",app_clientsTab:"Clients",app_contactsTab:"Contacts",profileSettings_menuHeader:"Menu utilisateur",profileSettings_contactDetails:"Contact de l'utilisateur",profileSettings_profileDetails:"Réglages utilisateur",profileSettings_changePassword:"Changement mot de de passe",profileSettings_hideSidenav:"Ouvrir menu",profileDetails_title:"Réglages utilisateur",changePassword_title:"Changement mot de passe",changePassword_resetPassword:"Changer le mot de passe",changePassword_newPassword:"Nouveau mot de passe",changePassword_newPasswordConfirmation:"Confirmation nouveau mot de passe",adminPanel_menuHeader:"Menu de configuration",adminPanel_companies:"Compagnies",adminPanel_userManagement:"Gestion des utilisateurs",adminPanel_roles:"Rôles",adminPanel_projects:"Projets",adminPanel_projectDefaultLabel:"Sélectionner projet",adminPanel_unitOptionSetDefaultLabel:"Sélectionner unit option set",adminPanel_phases:"Phases",adminPanel_deficiencyStatuses:"Statuts des déficiences",adminPanel_deficiencyStatusIconDefaultLabel:"Sélectionner icône",adminPanel_deficiencyPriorities:"Priorités des déficiences",adminPanel_systemFiles:"Fichiers systèmes",adminPanel_operationLogs:"Journal des opérations",adminPanel_accountTypes:"Types de comptes",adminPanel_contactTypes:"Types de contact",adminPanel_hideSidenav:"Ouvrir menu",adminPanel_unitOptionSet:"Unit Option Set",adminPanel_unitOptionValue:"Unit Option Values",adminPanel_taskType:"Task Type",adminPanel_activityTypes:"Types d'entrées du Journal",unitOptionValuesList_title:"Unit Option Values",taskTypesList_title:"Task Types",activityTypesList_title:"Types d'entrées du Journal",companiesList_title:"Compagnies",companiesList_companyName:"Nom compagnie",usersList_title:"Liste des utilisateurs",userDetails_title:"Détails de l'utilisateur",userDetails_deletionConfirmationHeader:"Voulez-vous vraiment efface cet utilisateur?",userDetails_deletionConfirmationContent:"L'utilisateur sera effacé...",userDetails_username:"Utilisateur:",userDetails_password:"Mot de passe:",userDetails_passwordConfirmation:"Confirmation du mot de passe :",userDetails_email:"Email :",userDetails_associatedCompanies:"Compagnies associées :",userDetails_associatedProjectsAndPhases:"Projets et phases associées :",userDetails_associatedRoles:"Rôles :",userDetails_avatar:"Photo de l'utilisateur :",userDetails_associatedContact:"Contact associé :",userDetails_communicationLanguage:"Langue de correspondance :",rolesList_title:"Rôles de l'utilisateur",rolesList_roleName:"Nom du rôle",projectsList_title:"Projets",phasesList_title:"Phases",deficiencyStatuses_title:"Statuts des déficiences",deficiencyPriorities_title:"Priorités des déficiences",operationLogsList_title:"Journal des opérations",operationLogsList_operationName:"Operation",operationLogsList_operationContent:"Contenu",accountTypesList_title:"Types de comptes",contactTypesList_title:"Types de contacts",systemFiles_title:"Fichiers systèmes",systemFiles_logos:"Logos",systemFiles_logo:"Logo",systemFiles_deficiencyStatusIcon:"Icônes des statuts des déficiences",systemFiles_Icon:"Icône",signIn_userName:"Nom d'utilisateur",signIn_password:"Mot de passse",signIn_logIn:"Connexion à Conspector",signIn_languageCode:"EN",signIn_forgotPassword:"Mot de passe oublié ?",signIn_rememberUserName:"Retenir nom d'utilisateur",initialPasswordReset_headerLabel:"Veuillez en choisir un nouveau mot de passe :",initialPasswordReset_newPassword:"Nouveau mot de passe",initialPasswordReset_newPasswordConfirmation:"Confirmation mot de passe",initialPasswordReset_reset:"Changer mot de passe",passwordReset_headerLabel:"Veuillez entrer un nouveau mot de passe:",passwordReset_newPassword:"Nouveau mot de passe",passwordReset_newPasswordConfirmation:"Confirmation mot de passe",passwordReset_reset:"Changer mot de passe",passwordReset_passwordsDontMatch:"Les mots de passe ne correspondent pas.",companySelection_heagerLabel:"Veuillez choisir une compagnie :",roleSelection_heagerLabel:"Veuillez sélectionner un rôle:",forgotPassword_heagerLabel:"Veuillez sélectionner ce que vous vous souvenez :",forgotPassword_userName:"Utilisateur",forgotPassword_email:"Email",forgotPassword_reset:"Réinitialiser mot de passe",forgotPassword_footerLabel:"Un problème de connexion?\nÉcrivez à ",contractorsList_title:"Liste de sous-traitants",contractorsList_addNew:"Ajouter un sous-traitant",contractorDetails_title:"Détails du sous-traitant",contractorDetails_deletionConfirmationHeader:"Vous êtes sur le point d'effacer un compte sous-traitant.",contractorDetails_deletionConfirmationContent:"Êtes-vous sûr de vouloir effacer ce sous-traitant, ses contacts associés seront également effacés.",contractorDetails_name:"Nom :",contractorDetails_namePlaceholder:"e.g. ABC Construction",contractorDetails_phone:"Téléphone :",contractorDetails_secondaryPhone:"Téléphone secondaire :",contractorDetails_website:"Site Web :",contractorDetails_email:"Email :",contractorDetails_fax:"Fax :",contractorDetails_associatedProjectsAndPhases:"Projets et phases associées :",contractorDetails_descriptionTags:"Tags descriptifs :",contractorDetails_billingStreet:"Adresse facturation :",contractorDetails_billingCity:"Ville facturation :",contractorDetails_billingPostalCode:"Code postal facturation :",contractorDetails_billingCountry:"Pays facturation :",contractorDetails_billingProvince:"Provice/état facturation :",contractorDetails_shippingStreet:"Adresse livraison :",contractorDetails_shippingCity:"Ville livraison :",contractorDetails_shippingPostalCode:"Code postal livraison :",contractorDetails_shippingCountry:"Pays livraison :",contractorDetails_shippingProvince:"Province/état livraison :",contactsList_title:"Liste des contacts",contactsList_addNew:"Ajouter contact",contactDetails_title:"Détail du contact",contactDetails_deletionConfirmationHeader:"Vous êtes sur le point d'effacer un contact.",contactDetails_deletionConfirmationContent:"Êtes-vous sûr de vouloir effacer ce contact?",contactDetails_name:"Nom :",contactDetails_namePlaceholder:"e.g. Sara",contactDetails_lastName:"Nom de famille :",contactDetails_lastNamePlaceholder:"e.g. Smith",contactDetails_personTitle:"Titre :",contactDetails_personTitlePlaceholder:"e.g. Ms, Director",contactDetails_homePhone:"Téléphone domicile :",contactDetails_workPhone:"Téléphone travail :",contactDetails_mobilePhone:"Téléphone mobile :",contactDetails_email:"Email :",contactDetails_fax:"Fax :",contactDetails_associatedProjectsAndPhases:"Projets et phases associées:",contactDetails_associatedParentAccount:"Compte associé :",contactDetails_selectParentAccount:"Sélectionner le compte",contactDetails_contactType:"Type de contact :",contactDetails_selectContactType:"Selectionner le type de contact",contactDetails_descriptionTags:"Tags descriptifs :",contactDetails_billingStreet:"Adresse facturation :",contactDetails_billingCity:"Ville facturation :",contactDetails_billingPostalCode:"Code postal facturation :",contactDetails_billingCountry:"Pays facturation :",contactDetails_billingProvince:"Provice/état facturation :",contactDetails_shippingStreet:"Adresse livraison :",contactDetails_shippingCity:"Ville livraison :",contactDetails_shippingPostalCode:"Code postal livraison :",contactDetails_shippingCountry:"Pays livraison :",contactDetails_shippingProvince:"Province/état livraison :",clientsList_title:"Liste de clients",clientsList_addNew:"Ajouter un compte client",clientDetails_title:"Client Details",clientDetails_deletionConfirmationHeader:"Vous êtes sur le point d'effacer un compte client.",clientDetails_deletionConfirmationContent:"Êtes-vous sûr de vouloir effacer ce compte client?, ses contacts associés seront également effacés.",clientDetails_name:"Nom :",clientDetails_namePlaceholder:"e.g. Sara Conspector",clientDetails_phone:"Téléphone :",clientDetails_secondaryPhone:"Téléphone secondaire :",clientDetails_website:"Site Web :",clientDetails_email:"Email :",clientDetails_fax:"Fax :",clientDetails_associatedProjectsAndPhases:"Projets et phases associées:",clientDetails_descriptionTags:"Tags descriptifs :",clientDetails_billingStreet:"Adresse facturation :",clientDetails_billingCity:"Ville facturation :",clientDetails_billingPostalCode:"Code postal facturation :",clientDetails_billingCountry:"Pays facturation :",clientDetails_billingProvince:"Provice/état facturation :",clientDetails_shippingStreet:"Adresse livraison :",clientDetails_shippingCity:"Ville livraison :",clientDetails_shippingPostalCode:"Code postal livraison :",clientDetails_shippingCountry:"Pays livraison :",clientDetails_shippingProvince:"Province/état livraison :"}),a.preferredLanguage("en"),a.useCookieStorage()
}]),app.factory("genericODataFactory",["$resource","CONSTANTS",function(a,b){var c=b.sServicePath;return a("",{},{getEntitySetWithFilterAndExpand:{method:"GET",url:c+":path?$filter=:filter&$expand=:expand&$format=json"},getEntitySetWithFilter:{method:"GET",url:c+":path?$filter=:filter&$format=json"},getEntitySetWithExpand:{method:"GET",url:c+":path?$expand=:expand&$format=json"},getEntitySet:{method:"GET",url:c+":path?$format=json"},getLinks:{method:"GET",url:c+":sParentEntityWithKey/$links/:sRelationName"},post:{method:"POST",url:c+":path"},put:{method:"PUT",params:{key:"@key"},url:c+":path(':key')"},getEntity:{method:"GET",params:{key:"@key"},url:c+":path(':key')?$format=json"},getEntityWithFilter:{method:"GET",params:{key:"@key"},url:c+":path(':key')?$filter=:filter&$format=json"},getEntityWithExpand:{method:"GET",params:{key:"@key"},url:c+":path(':key')?$expand=:expand&$format=json"},getEntityWithFilterAndExpand:{method:"GET",params:{key:"@key"},url:c+":path(':key')?$filter=:filter&$expand=:expand&$format=json"},"delete":{method:"DELETE",params:{key:"@key"},url:c+":path(':key')"}})}]),app.factory("dataProvider",["genericODataFactory","utilsProvider","$q","$rootScope","$http","$translate","cacheProvider","$window","CONSTANTS",function(a,b,c,d,e,f,g,h,i){return{commonOnSuccess:function(a){a.bShowSpinner&&d.$emit("UNLOAD"),a.bShowSuccessMessage&&b.displayMessage({sText:f.instant("global_successOperation"),sType:"success"})},commonOnError:function(a,c,e){a.bShowSpinner&&d.$emit("UNLOAD"),a.bShowErrorMessage&&b.displayMessage(e?{sText:f.instant(e),sType:"error"}:{sText:f.instant("global_errorOperation"),sType:"error"}),c&&c.reject()},getEntitySet:function(b){var e={},f=c.defer(),g=[],h="";return b.sKey&&(h=b.sKey),b.sFilter&&(h+=b.sFilter),b.sExpand&&(h+=b.sExpand),h||(h=""),b.oCacheProvider&&b.sCacheProviderAttribute&&(g=b.oCacheProvider.getFromCache(b.sCacheProviderAttribute,h),g.length)?(console.log("Entities: "+b.sCacheProviderAttribute+" retrieved from cache..."),g):(b.bShowSpinner&&d.$emit("LOAD"),b.sFilter&&b.sExpand&&(e=(new a).$getEntitySetWithFilterAndExpand({path:b.sPath,expand:b.sExpand,filter:b.sFilter})),b.sFilter&&!b.sExpand&&(e=(new a).$getEntitySetWithFilter({path:b.sPath,filter:b.sFilter})),!b.sFilter&&b.sExpand&&(e=(new a).$getEntitySetWithExpand({path:b.sPath,expand:b.sExpand})),b.sFilter||b.sExpand||(e=(new a).$getEntitySet({path:b.sPath})),e.then($.proxy(function(a){b.oCacheProvider&&b.sCacheProviderAttribute&&a.d.results.length&&b.oCacheProvider.putToCache(b.sCacheProviderAttribute,h,a.d.results),this.commonOnSuccess(b),f.resolve(a.d.results)},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise)},getEntity:function(b){var e={},f=c.defer();return b.bShowSpinner&&d.$emit("LOAD"),b.sFilter&&!b.sExpand&&(e=(new a).$getEntityWithFilter({path:b.sPath,key:b.sKey,filter:b.sFilter})),!b.sFilter&&b.sExpand&&(e=(new a).$getEntityWithExpand({path:b.sPath,key:b.sKey,expand:b.sExpand})),b.sFilter&&b.sExpand&&(e=(new a).$getEntityWithFilterAndExpand({path:b.sPath,filter:b.sFilter,key:b.sKey,expand:b.sExpand})),b.sFilter||b.sExpand||(e=(new a).$getEntity({path:b.sPath,key:b.sKey})),e.then($.proxy(function(a){this.commonOnSuccess(b),f.resolve(a.d)},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise},getLinks:function(b){var d={},e=c.defer(),f="";return f=b.sParentEntity+"('"+b.sParentKey+"')",d=(new a).$getLinks({path:b.sParentEntity,sParentEntity:f,sRelationName:b.sRelationName}),d.then(function(a){e.resolve(a.d)}),e.promise},updateLinks:function(a){for(var b={__batchRequests:[]},c={},d={},e=[],f="",h="",j=!1,k=function(a){a.d.CompanyName===g.oUserProfile.sCurrentCompany&&g.oUserProfile.sCurrentCompany&&a.d.CompanyName||(j=!0)},l=0;l<a.aLinks.length;l++)c={},c.requestUri=a.sParentEntityWithKey+"/$links/"+a.aLinks[l].sRelationName,c.method="GET",b.__batchRequests.push(c);d=this.batchRequest({oRequestData:b}),d.then($.proxy(function(g){b={__batchRequests:[]};for(var l=0;l<g.length;l++){e=[];for(var m=0;m<g[l].data.results.length;m++)j=!1,c={},h=g[l].data.results[m].uri.substring(g[l].data.results[m].uri.indexOf("'")+1,g[l].data.results[m].uri.lastIndexOf("'")),a.aLinks[l].bKeepCompanyDependentLinks&&this.ajaxRequest({bAsync:!1,oData:{},sRequestType:"GET",sDataType:"json",sPath:i.sServicePath+a.aLinks[l].sRelationName.substring(0,a.aLinks[l].sRelationName.length-7)+"s('"+h+"')",oEventHandlers:{onSuccess:k}}),j||(f=a.aLinks[l].sRelationName+"('"+h+"')",c.requestUri=a.sParentEntityWithKey+"/$links/"+f,c.method="DELETE",e.push(c));e.length&&this.constructChangeBlockForBatch({oRequestData:b,aData:e})}b.__batchRequests.length?(d=this.batchRequest({oRequestData:b}),d.then($.proxy(function(){this.createLinks(a)},this))):this.createLinks(a)},this))},updateEntity:function(e){var f={},h={},i=c.defer();e.bShowSpinner&&d.$emit("LOAD");var h=this.getEntity({sKey:e.sKey,sPath:e.sPath});return h.then($.proxy(function(c){var d={};d=angular.copy(e.oData),c.LastModifiedAt===d.LastModifiedAt?(d.LastModifiedAt=b.dateToDBDate(new Date),d.GeneralAttributes||(d.GeneralAttributes={}),d.GeneralAttributes.LastModifiedBy=g.oUserProfile.sUserName,d.GeneralAttributes.IsDeleted||(d.GeneralAttributes.IsDeleted=!1),d.GeneralAttributes.IsArchived||(d.GeneralAttributes.IsArchived=!1),d.GeneralAttributes.SortingSequence||(d.GeneralAttributes.SortingSequence=0),f=new a(d).$put({path:e.sPath,key:e.sKey}),f.then($.proxy(function(a){if(e.aLinks&&e.aLinks.length){var b=e.sPath+"('"+a[e.sKeyAttribute]+"')";this.updateLinks({aLinks:e.aLinks,sParentEntityWithKey:b,onSuccess:$.proxy(function(){this.commonOnSuccess(e),i.resolve(a)},this)})}else this.commonOnSuccess(e),i.resolve(a)},this),$.proxy(function(){this.commonOnError(e,i)},this))):this.commonOnError(e,i,"global_errorEntityWasUpdatedBefore")},this)),i.promise},createLinks:function(a){for(var b={__batchRequests:[]},c=[],d={},e={},f=0;f<a.aLinks.length;f++){c=[];for(var g=0;g<a.aLinks[f].aUri.length;g++)d={},d.requestUri=a.sParentEntityWithKey+"/$links/"+a.aLinks[f].sRelationName,d.method="POST",d.data={uri:a.aLinks[f].aUri[g]},c.push(d);c.length&&this.constructChangeBlockForBatch({oRequestData:b,aData:c})}e=this.batchRequest({oRequestData:b}),e.then(function(){a.onSuccess&&a.onSuccess()})},createEntity:function(e){var f={},h={},i=c.defer();return e.bShowSpinner&&d.$emit("LOAD"),h=angular.copy(e.oData),e.bGuidNeeded&&(h.Guid=b.generateGUID()),e.bCompanyNeeded&&!h.CompanyName&&(h.CompanyName=g.oUserProfile.sCurrentCompany),h.CreatedAt=b.dateToDBDate(new Date),h.LastModifiedAt=h.CreatedAt,h.GeneralAttributes||(h.GeneralAttributes={}),h.GeneralAttributes.CreatedBy=g.oUserProfile.sUserName,h.GeneralAttributes.LastModifiedBy=g.oUserProfile.sUserName,h.GeneralAttributes.IsDeleted=!1,h.GeneralAttributes.IsArchived=!1,h.GeneralAttributes.SortingSequence||(h.GeneralAttributes.SortingSequence=0),f=new a(h).$post({path:e.sPath}),f.then($.proxy(function(a){if(e.aLinks&&e.aLinks.length){var b=e.sPath+"('"+a.d[e.sKeyAttribute]+"')";this.createLinks({aLinks:e.aLinks,sParentEntityWithKey:b,onSuccess:$.proxy(function(){this.commonOnSuccess(e),i.resolve(a.d)},this)})}else this.commonOnSuccess(e),i.resolve(a.d)},this),$.proxy(function(){this.commonOnError(e,i)},this)),i.promise},deleteEntity:function(b){var e={},f=c.defer();return b.bShowSpinner&&d.$emit("LOAD"),e=(new a).$delete({path:b.sPath,key:b.sKey}),e.then($.proxy(function(){this.commonOnSuccess(b),f.resolve()},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise},httpRequest:function(a){var b="",f="application/x-www-form-urlencoded",g=[],h={},i={};a.sRequestType||(a.sRequestType="GET");for(var j in a.oUrlParameters)g.push(j+"="+a.oUrlParameters[j]);for(var k=0;k<g.length;k++)b+=g[k],k!==g.length-1&&(b+="&");return h=c.defer(),a.bShowSpinner&&d.$emit("LOAD"),i=e({url:a.sPath,method:a.sRequestType,headers:{"Content-Type":f},data:b}),i.success($.proxy(function(b){this.commonOnSuccess(a),h.resolve(b)},this)),i.error($.proxy(function(){this.commonOnError(a,h)},this)),h.promise},constructChangeBlockForBatch:function(a){for(var b={__changeRequests:[]},c=0;c<a.aData.length;c++)b.__changeRequests.push(a.aData[c]);a.oRequestData.__batchRequests.push(b)},batchRequest:function(a){var b=c.defer();return a.bShowSpinner&&d.$emit("LOAD"),a.oRequestData.__batchRequests.length&&OData.request({requestUri:h.location.origin+h.location.pathname+"odata.svc/$batch",method:"POST",data:a.oRequestData},$.proxy(function(c){for(var d=0;d<c.__batchResponses.length;d++)if("HTTP request failed"===c.__batchResponses[d].message)return void this.commonOnError(a);this.commonOnSuccess(a),b.resolve(c.__batchResponses)},this),$.proxy(function(){this.commonOnError(a)},this),OData.batchHandler),b.promise},ajaxRequest:function(a){a.sRequestType||(a.sRequestType="POST"),a.bShowSpinner&&d.$emit("LOAD"),$.ajax({type:a.sRequestType,async:a.bAsync,url:a.sPath,data:a.oData,dataType:a.sDataType,beforeSend:function(){},success:$.proxy(function(b){this.commonOnSuccess(a),a.oEventHandlers&&a.oEventHandlers.onSuccess&&a.oEventHandlers.onSuccess(b)},this),error:$.proxy(function(b){this.commonOnError(a),a.oEventHandlers&&a.oEventHandlers.onError&&a.oEventHandlers.onError(b)},this)})}}}]),app.factory("apiProvider",["dataProvider","CONSTANTS","$q","utilsProvider","cacheProvider","PubNub",function(a,b,c,d,e,f){return{getUserProfile:function(c){var d=b.sServicePath+"Users('"+c+"')?$expand=CompanyDetails,RoleDetails,PhaseDetails/ProjectDetails,ContactDetails/AccountDetails&$format=json",e=[],f=[],g=[],h="",i=!1,j="",k="",l=function(a){i=a.d.IsPasswordInitial,h=a.d.LastModifiedAt;for(var b=0;b<a.d.CompanyDetails.results.length;b++)a.d.CompanyDetails.results[b].GeneralAttributes.IsDeleted||e.push(a.d.CompanyDetails.results[b]);for(var b=0;b<a.d.RoleDetails.results.length;b++)a.d.RoleDetails.results[b].GeneralAttributes.IsDeleted||f.push(a.d.RoleDetails.results[b]);for(var b=0;b<a.d.PhaseDetails.results.length;b++)a.d.PhaseDetails.results[b].GeneralAttributes.IsDeleted||(a.d.PhaseDetails.results[b]._sortingSequence=a.d.PhaseDetails.results[b].GeneralAttributes.SortingSequence,a.d.PhaseDetails.results[b].ProjectDetails._sortingSequence=a.d.PhaseDetails.results[b].ProjectDetails.GeneralAttributes.SortingSequence,g.push(a.d.PhaseDetails.results[b]));a.d.ContactDetails&&(j=a.d.ContactDetails.Guid,a.d.ContactDetails.AccountDetails&&(k=a.d.ContactDetails.AccountDetails.Guid))};return a.ajaxRequest({sPath:d,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:l}}),{sUserName:c,aUserRoles:f,aAllUserRoles:f,aUserPhases:g,aAllUserPhases:g,aUserCompanies:e,bIsInitialPassword:i,sLastModifiedAt:h,aGloballySelectedPhasesGuids:[],sUserContactGuid:j,sUserAccountGuid:k}},getCurrentUserName:function(){var b,c="rest/account/getCurrentUserName",d=function(a){b=a};return a.ajaxRequest({sPath:c,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:d}}),b},getCurrentCompany:function(){var b,c="rest/account/getCurrentCompany",d=function(a){b=a};return a.ajaxRequest({sPath:c,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:d}}),b},setCurrentCompany:function(b){a.ajaxRequest({sPath:"rest/account/setCurrentCompany/"+b,bAsync:!1,sRequestType:"GET"})},getCurrentRole:function(){var b,c="rest/account/getCurrentRole",d=function(a){b=a};return a.ajaxRequest({sPath:c,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:d}}),b},setCurrentRole:function(b){a.ajaxRequest({sPath:"rest/account/setCurrentRole/"+b,bAsync:!1,sRequestType:"GET"})},resetPasswordWithPRCode:function(b){var c=a.httpRequest({sPath:"rest/account/passwordRecovery/PRCode/"+b.oData.passwordRecoveryCode+"/newPassword/"+b.oData.newPassword,sRequestType:"GET",bShowSpinner:!0});c.then(function(a){b.onSuccess(a)})},resetPassword:function(b){var c={},d="";d=b.oData.userName?"rest/account/passwordRecovery/userName/"+b.oData.userName:"rest/account/passwordRecovery/email/"+b.oData.email,c=a.httpRequest({sPath:d,sRequestType:"GET",bShowSpinner:!0}),c.then(function(a){b.onSuccess(a)})},hashPassword:function(b){var c="",d="rest/account/hashPassword/"+b,e=function(a){c=a};return a.ajaxRequest({sPath:d,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:e}}),c},getAttachments:function(b){var c=b.sPath,d=a.httpRequest({sPath:c});d.then(function(a){b.onSuccess(a)})},getUsersWithCompaniesPhasesAndRoles:function(b){var c=a.getEntitySet({sPath:"Users",sExpand:"CompanyDetails,PhaseDetails,RoleDetails",sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oUserEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getUserWithCompaniesPhasesAndRoles:function(b){var c=a.getEntity({sPath:"Users",sKey:b.sKey,sExpand:"CompanyDetails,PhaseDetails/ProjectDetails,RoleDetails",sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner});c.then(b.onSuccess)},createUser:function(b){var c=function(a){e.cleanEntitiesCache("oUserEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"Users",sKeyAttribute:"UserName",oData:b.oData,aLinks:b.aLinks,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!1});d.then(c)},updateUser:function(b){var c=function(a){e.cleanEntitiesCache("oUserEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Users",sKeyAttribute:"UserName",sKey:b.sKey,oData:b.oData,aLinks:b.aLinks,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},logEvent:function(b){var c=b.oData,d=function(){e.cleanEntitiesCache("oOperationLogEntity")};c.OperationContent=JSON.stringify(b.oData.OperationContent);var f=a.createEntity({sPath:"OperationLogs",oData:c,bGuidNeeded:!0,bCompanyNeeded:!0});f.then(d)},getOperationLogs:function(b){var c=a.getEntitySet({sPath:"OperationLogs",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oOperationLogEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getProjects:function(b){var c=a.getEntitySet({sPath:"Projects",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oProjectEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getProjectsWithPhases:function(b){var c=a.getEntitySet({sPath:"Projects",sExpand:"PhaseDetails",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oProjectEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createProject:function(b){var c=function(a){e.cleanEntitiesCache("oProjectEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"Projects",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateProject:function(b){var c=function(a){e.cleanEntitiesCache("oProjectEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Projects",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getPhases:function(b){var c=a.getEntitySet({sPath:"Phases",sExpand:"ProjectDetails",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oPhaseEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createPhase:function(b){var c=function(a){e.cleanEntitiesCache("oPhaseEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"Phases",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updatePhase:function(b){var c=function(a){e.cleanEntitiesCache("oPhaseEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Phases",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getCompanies:function(b){var c=a.getEntitySet({sPath:"Companys",sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oCompanyEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createCompany:function(c){var f={},g={__batchRequests:[]},h=[],i=angular.copy(c.oData),j={};i.GeneralAttributes||(i.GeneralAttributes={}),i.GeneralAttributes.CreatedBy=e.oUserProfile.sUserName,i.GeneralAttributes.LastModifiedBy=e.oUserProfile.sUserName,i.GeneralAttributes.IsDeleted=!1,i.GeneralAttributes.IsArchived=!1,i.GeneralAttributes.SortingSequence||(i.GeneralAttributes.SortingSequence=0),i.CreatedAt=d.dateToDBDate(new Date),i.LastModifiedAt=i.CreatedAt;var k={requestUri:"Companys",method:"POST",data:i};h.push(k),j.Guid=d.generateGUID(),j.RoleName=b.sDefaultRoleNameForNewCompany,j.CompanyName=c.oData.CompanyName,j.CreatedAt=i.CreatedAt,j.LastModifiedAt=i.LastModifiedAt,j.GeneralAttributes=angular.copy(i.GeneralAttributes),j.GeneralAttributes.SortingSequence=0,k={requestUri:"Roles",method:"POST",data:j},h.push(k),a.constructChangeBlockForBatch({oRequestData:g,aData:h}),h=[],k={requestUri:"Users('"+e.oUserProfile.sUserName+"')/$links/CompanyDetails",method:"POST",data:{uri:"Companys('"+c.oData.CompanyName+"')"}},h.push(k),k={requestUri:"Users('"+e.oUserProfile.sUserName+"')/$links/RoleDetails",method:"POST",data:{uri:"Roles('"+j.Guid+"')"}},h.push(k),a.constructChangeBlockForBatch({oRequestData:g,aData:h}),f=a.batchRequest({oRequestData:g,bShowSpinner:c.bShowSpinner,bShowSuccessMessage:c.bShowSuccessMessage,bShowErrorMessage:c.bShowErrorMessage}),f.then(function(a){e.cleanEntitiesCache("oCompanyEntity"),c.onSuccess&&c.onSuccess(a)})},updateCompany:function(b){var c=function(a){e.cleanEntitiesCache("oCompanyEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Companys",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getRoles:function(b){var c=a.getEntitySet({sPath:"Roles",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oRoleEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createRole:function(b){var c=function(a){e.cleanEntitiesCache("oRoleEntity"),b.onSuccess(a)},d=a.createEntity({sPath:"Roles",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateRole:function(b){var c=function(a){e.cleanEntitiesCache("oRoleEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Roles",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getDeficiencyStatuses:function(b){var c=a.getEntitySet({sPath:"TaskStatuss",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oTaskStatusEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createDeficiencyStatus:function(b){var c=function(a){e.cleanEntitiesCache("oTaskStatusEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"TaskStatuss",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateDeficiencyStatus:function(b){var c=function(a){e.cleanEntitiesCache("oTaskStatusEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"TaskStatuss",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getContractorAccountType:function(b){var c=a.getEntitySet({sPath:"AccountTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false and NameEN eq 'Contractor'",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getClientAccountType:function(b){var c=a.getEntitySet({sPath:"AccountTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false and NameEN eq 'Client'",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getAccountTypes:function(b){var c=a.getEntitySet({sPath:"AccountTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getAccountTypesWithAccounts:function(b){var c=a.getEntitySet({sPath:"AccountTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",sExpand:"AccountDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(function(a){for(var c=[],d=0;d<a.length;d++){c=[];for(var e=0;e<a[d].AccountDetails.results.length;e++)a[d].AccountDetails.results[e].GeneralAttributes.IsDeleted||c.push(a[d].AccountDetails.results[e]);a[d].AccountDetails.results=angular.copy(c)}b.onSuccess(a)})},createAccountType:function(b){var c=function(a){e.cleanEntitiesCache("oAccountTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"AccountTypes",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateAccountType:function(b){var c=function(a){e.cleanEntitiesCache("oAccountTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"AccountTypes",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getContactTypes:function(b){var c=a.getEntitySet({sPath:"ContactTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oContactTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createContactType:function(b){var c=function(a){e.cleanEntitiesCache("oContactTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"ContactTypes",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateContactType:function(b){var c=function(a){e.cleanEntitiesCache("oContactTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"ContactTypes",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getActivityTypes:function(b){var c=a.getEntitySet({sPath:"ActivityTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oActivityTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createActivityType:function(b){var c=function(a){e.cleanEntitiesCache("oActivityTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"ActivityTypes",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateActivityType:function(b){var c=function(a){e.cleanEntitiesCache("oActivityTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"ActivityTypes",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getDeficiencyPriorities:function(b){var c=a.getEntitySet({sPath:"TaskPrioritys",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oTaskPriorityEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createDeficiencyPriority:function(b){var c=function(a){e.cleanEntitiesCache("oTaskPriorityEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"TaskPrioritys",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateDeficiencyPriority:function(b){var c=function(a){e.cleanEntitiesCache("oTaskPriorityEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"TaskPrioritys",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getContractorsWithPhases:function(b){var c=a.getEntitySet({sPath:"Accounts",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",sExpand:"PhaseDetails/ProjectDetails,AccountTypeDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountEntity"});if(c instanceof Array){for(var d=[],f=0;f<c.length;f++)"Contractor"===c[f].AccountTypeDetails.NameEN&&d.push(c[f]);b.onSuccess(d)}else c.then(function(a){for(var c=[],d=0;d<a.length;d++)"Contractor"===a[d].AccountTypeDetails.NameEN&&c.push(a[d]);b.onSuccess(c)})},getClientsWithPhases:function(b){var c=a.getEntitySet({sPath:"Accounts",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",sExpand:"PhaseDetails/ProjectDetails,AccountTypeDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountEntity"});if(c instanceof Array){for(var d=[],f=0;f<c.length;f++)"Client"===c[f].AccountTypeDetails.NameEN&&d.push(c[f]);b.onSuccess(d)}else c.then(function(a){for(var c=[],d=0;d<a.length;d++)"Client"===a[d].AccountTypeDetails.NameEN&&c.push(a[d]);b.onSuccess(c)})},getAccountWithPhases:function(b){var c=a.getEntity({sPath:"Accounts",sKey:b.sKey,sExpand:"PhaseDetails/ProjectDetails,AccountTypeDetails",sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner});c.then(b.onSuccess)},getAccounts:function(b){var c=a.getEntity({sPath:"Accounts",sKey:b.sKey,sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner});c.then(b.onSuccess)},createAccount:function(b){var c=function(a){e.cleanEntitiesCache("oAccountEntity"),e.cleanEntitiesCache("oAccountTypeEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oAccountEntity",sText:"Account has been created...",sUserName:e.oUserProfile.sUserName}})},d=a.createEntity({sPath:"Accounts",sKeyAttribute:"Guid",oData:b.oData,aLinks:b.aLinks,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateAccount:function(b){var c=function(a){e.cleanEntitiesCache("oAccountEntity"),e.cleanEntitiesCache("oAccountTypeEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oAccountEntity",sText:"Account has been updated...",sUserName:e.oUserProfile.sUserName}})},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Accounts",sKeyAttribute:"Guid",sKey:b.sKey,oData:b.oData,aLinks:b.aLinks,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getCountriesWithProvinces:function(b){var c=a.getEntitySet({sPath:"Countrys",sFilter:"GeneralAttributes/IsDeleted eq false",sExpand:"ProvinceDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oCountryEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getContacts:function(b){var c=a.getEntitySet({sPath:"Contacts",sExpand:"UserDetails,ContactTypeDetails,AccountDetails/AccountTypeDetails,PhaseDetails/ProjectDetails",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oContactEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getContact:function(b){var c=a.getEntity({sPath:"Contacts",sKey:b.sKey,sExpand:"UserDetails,ContactTypeDetails,AccountDetails,PhaseDetails/ProjectDetails",sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner});c.then(b.onSuccess)},updateContact:function(b){var c=function(a){e.cleanEntitiesCache("oContactEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oContactEntity",sText:"Contact has been updated...",sUserName:e.oUserProfile.sUserName}})},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Contacts",sKeyAttribute:"Guid",sKey:b.sKey,oData:b.oData,aLinks:b.aLinks,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},createContact:function(b){var c=function(a){e.cleanEntitiesCache("oContactEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oContactEntity",sText:"Contact has been created...",sUserName:e.oUserProfile.sUserName}})},d=a.createEntity({sPath:"Contacts",sKeyAttribute:"Guid",oData:b.oData,aLinks:b.aLinks,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},getContactsForAccount:function(b){var c=a.getEntitySet({sPath:"Contacts",sFilter:"GeneralAttributes/IsDeleted eq false and AccountGuid eq '"+b.sAccountGuid+"'",sExpand:"UserDetails,ContactTypeDetails,AccountDetails,PhaseDetails/ProjectDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oContactEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getUnitOptionSets:function(b){var c=a.getEntitySet({sPath:"UnitOptionSets",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",sExpand:"PhaseDetails/ProjectDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oUnitOptionSetEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createUnitOptionSet:function(b){var c=function(a){e.cleanEntitiesCache("oUnitOptionSetEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"UnitOptionSets",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0,aLinks:b.aLinks,sKeyAttribute:"Guid"});d.then(c)},updateUnitOptionSet:function(b){var c=function(a){e.cleanEntitiesCache("oUnitOptionSetEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"UnitOptionSets",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,aLinks:b.aLinks,sKeyAttribute:"Guid"});d.then(c)},getUnitOptionValues:function(b){var c=a.getEntitySet({sPath:"UnitOptions",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",sExpand:"UnitOptionSetDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oUnitOptionValueEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createUnitOptionValue:function(b){var c=function(a){e.cleanEntitiesCache("oUnitOptionValueEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"UnitOptions",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});
d.then(c)},updateUnitOptionValue:function(b){var c=function(a){e.cleanEntitiesCache("oUnitOptionValueEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"UnitOptions",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getTaskTypes:function(b){var c=a.getEntitySet({sPath:"TaskTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oTaskTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createTaskType:function(b){var c=function(a){e.cleanEntitiesCache("oTaskTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"TaskTypes",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateTaskType:function(b){var c=function(a){e.cleanEntitiesCache("oTaskTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"TaskTypes",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getActivities:function(b){var c=a.getEntitySet({sPath:"Activitys",sExpand:b.sExpand,sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oActivityEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getActivity:function(b){var c=a.getEntity({sPath:"Activitys",sKey:b.sKey,sExpand:b.sExpand,sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner});c.then(b.onSuccess)},updateActivity:function(b){var c=function(a){e.cleanEntitiesCache("oActivityEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oActivityEntity",sText:"Activity has been updated...",sUserName:e.oUserProfile.sUserName}})},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Activitys",sKeyAttribute:"Guid",sKey:b.sKey,oData:b.oData,aLinks:b.aLinks,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},createActivity:function(b){var c=function(a){e.cleanEntitiesCache("oActivityEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oActivityEntity",sText:"Activity has been created...",sUserName:e.oUserProfile.sUserName}})},d=a.createEntity({sPath:"Activitys",sKeyAttribute:"Guid",oData:b.oData,aLinks:b.aLinks,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},getDeficiencies:function(b){var c=a.getEntitySet({sPath:"Tasks",sExpand:b.sExpand,sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oDeficiencyEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getDeficiency:function(b){var c=a.getEntity({sPath:"Tasks",sKey:b.sKey,sExpand:b.sExpand,sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner});c.then(b.onSuccess)},updateDeficiency:function(b){var c=function(a){e.cleanEntitiesCache("oDeficiencyEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oDeficiencyEntity",sText:"Deficiency has been updated...",sUserName:e.oUserProfile.sUserName}})},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Tasks",sKeyAttribute:"Guid",sKey:b.sKey,oData:b.oData,aLinks:b.aLinks,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},createDeficiency:function(b){var c=function(a){e.cleanEntitiesCache("oDeficiencyEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oDeficiencyEntity",sText:"Deficiency has been created...",sUserName:e.oUserProfile.sUserName}})},d=a.createEntity({sPath:"Tasks",sKeyAttribute:"Guid",oData:b.oData,aLinks:b.aLinks,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},getUnits:function(b){var c=a.getEntitySet({sPath:"Units",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oUnitEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getUnit:function(b){var c=a.getEntity({sPath:"Units",sKey:b.sKey,sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner});c.then(b.onSuccess)},updateUnit:function(b){var c=function(a){e.cleanEntitiesCache("oUnitEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oUnitEntity",sText:"Unit has been updated...",sUserName:e.oUserProfile.sUserName}})},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Units",sKeyAttribute:"Guid",sKey:b.sKey,oData:b.oData,aLinks:b.aLinks,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},createUnit:function(b){var c=function(a){e.cleanEntitiesCache("oUnitEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oUnitEntity",sText:"Unit has been created...",sUserName:e.oUserProfile.sUserName}})},d=a.createEntity({sPath:"Units",sKeyAttribute:"Guid",oData:b.oData,aLinks:b.aLinks,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},generateReport:function(){var a={reportId:"DocxProjectWithVelocityList.docx",fileGuid:"d38da805-e027-464a-b098-7926c86209cd",converter:"",processState:"generated",dispatch:"download",entryName:""};$.download("/conspector/xdocReportsService",a,"post")}}}]),app.factory("rolesSettings",["cacheProvider","utilsProvider","apiProvider","$translate",function(a,b,c,d){return{setCurrentRole:function(e){return this[e]&&this[e].sInitialState?(a.oUserProfile.sCurrentRole=e,a.oUserProfile.oCurrentRoleSettings=angular.copy(this[e]),c.setCurrentRole(e),!0):(b.displayMessage({sText:d.instant("global_noDefaultViewForTheRole"),sType:"error"}),!1)},getRolesInitialState:function(a){return this[a].sInitialState},getRolesMainMenuItemSettings:function(a){return this[a.sRole].oMainMenu[a.sMenuItem]},getRolesAdminPanelMenuItemSettings:function(a){return this[a.sRole].oAdminPanelMenu[a.sMenuItem]},getRolesSettingsForEntityAndOperation:function(a){return this[a.sRole].oAuthorizationsPerEntity[a.sEntityName][a.sOperation]},getRolesProfileMenuItemSettings:function(a){return this[a.sRole].oProfileMenu[a.sMenuItem]},globalAdministrator:{sInitialState:"app.deficienciesList",bIsGlobalUserAdministrator:!0,oMainMenu:{bShowDeficiencies:!0,bShowUnits:!0,bShowContractors:!0,bShowClients:!0,bShowContacts:!0,bShowActivities:!0,bShowAdminPanel:!0,bShowProfileSettings:!0},oAdminPanelMenu:{bShowCompaniesManagement:!0,bShowUsersManagement:!0,bShowRolesManagement:!0,bShowProjectsManagement:!0,bShowPhasesManagement:!0,bShowDeficiencyStatusesManagement:!0,bShowDeficiencyPrioritiesManagement:!0,bShowSystemFilesManagement:!0,bShowOperationLogs:!0,bShowAccountTypesManagement:!0,bShowContactTypesManagement:!0,bShowUnitOptionSetManagement:!0,bShowUnitOptionValueManagement:!0,bShowTaskTypeManagement:!0,bShowActivityTypesManagement:!0},oProfileMenu:{bShowContactDetails:!0,bShowProfileDetails:!0,bShowChangePassword:!0},oAuthorizationsPerEntity:{oDeficiency:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oUnit:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oContractor:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oClient:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oContact:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oActivity:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oUser:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0}}},systemAdministrator:{sInitialState:"app.deficienciesList",bIsGlobalUserAdministrator:!1,oMainMenu:{bShowDeficiencies:!0,bShowUnits:!0,bShowContractors:!0,bShowClients:!0,bShowContacts:!0,bShowActivities:!0,bShowAdminPanel:!0,bShowProfileSettings:!0},oAdminPanelMenu:{bShowCompaniesManagement:!1,bShowUsersManagement:!0,bShowRolesManagement:!0,bShowProjectsManagement:!0,bShowPhasesManagement:!0,bShowDeficiencyStatusesManagement:!0,bShowDeficiencyPrioritiesManagement:!0,bShowSystemFilesManagement:!0,bShowOperationLogs:!0,bShowAccountTypesManagement:!0,bShowContactTypesManagement:!0,bShowUnitOptionSetManagement:!0,bShowUnitOptionValueManagement:!0,bShowTaskTypeManagement:!0,bShowActivityTypesManagement:!0},oProfileMenu:{bShowContactDetails:!0,bShowProfileDetails:!0,bShowChangePassword:!0},oAuthorizationsPerEntity:{oDeficiency:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oUnit:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oContractor:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oClient:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oContact:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oActivity:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oUser:{bDisplay:!0,bUpdate:!0,bCreate:!1,bDelete:!1}}},contactManagementUser:{sInitialState:"app.contactsList",bIsGlobalUserAdministrator:!1,oMainMenu:{bShowDeficiencies:!1,bShowUnits:!1,bShowContractors:!0,bShowClients:!0,bShowContacts:!0,bShowActivities:!1,bShowAdminPanel:!1,bShowProfileSettings:!0},oAdminPanelMenu:{bShowCompaniesManagement:!1,bShowUsersManagement:!1,bShowRolesManagement:!1,bShowProjectsManagement:!1,bShowPhasesManagement:!1,bShowDeficiencyStatusesManagement:!1,bShowDeficiencyPrioritiesManagement:!1,bShowSystemFilesManagement:!1,bShowOperationLogs:!1,bShowAccountTypesManagement:!1,bShowContactTypesManagement:!1,bShowUnitOptionSetManagement:!1,bShowUnitOptionValueManagement:!1,bShowTaskTypeManagement:!1,bShowActivityTypesManagement:!1},oProfileMenu:{bShowContactDetails:!0,bShowProfileDetails:!0,bShowChangePassword:!0},oAuthorizationsPerEntity:{oDeficiency:{bDisplay:!1,bUpdate:!1,bCreate:!1,bDelete:!1},oUnit:{bDisplay:!1,bUpdate:!1,bCreate:!1,bDelete:!1},oContractor:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oClient:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oContact:{bDisplay:!0,bUpdate:!0,bCreate:!0,bDelete:!0},oActivity:{bDisplay:!1,bUpdate:!1,bCreate:!1,bDelete:!1},oUser:{bDisplay:!1,bUpdate:!1,bCreate:!1,bDelete:!1}}},contactViewerUser:{sInitialState:"app.contactsList",bIsGlobalUserAdministrator:!1,oMainMenu:{bShowDeficiencies:!1,bShowUnits:!1,bShowContractors:!0,bShowClients:!0,bShowContacts:!0,bShowActivities:!1,bShowAdminPanel:!1,bShowProfileSettings:!0},oAdminPanelMenu:{bShowCompaniesManagement:!1,bShowUsersManagement:!1,bShowRolesManagement:!1,bShowProjectsManagement:!1,bShowPhasesManagement:!1,bShowDeficiencyStatusesManagement:!1,bShowDeficiencyPrioritiesManagement:!1,bShowSystemFilesManagement:!1,bShowOperationLogs:!1,bShowAccountTypesManagement:!1,bShowContactTypesManagement:!1,bShowUnitOptionSetManagement:!1,bShowUnitOptionValueManagement:!1,bShowTaskTypeManagement:!1,bShowActivityTypesManagement:!1},oProfileMenu:{bShowContactDetails:!0,bShowProfileDetails:!0,bShowChangePassword:!0},oAuthorizationsPerEntity:{oDeficiency:{bDisplay:!1,bUpdate:!1,bCreate:!1,bDelete:!1},oUnit:{bDisplay:!1,bUpdate:!1,bCreate:!1,bDelete:!1},oContractor:{bDisplay:!0,bUpdate:!1,bCreate:!1,bDelete:!1},oClient:{bDisplay:!0,bUpdate:!1,bCreate:!1,bDelete:!1},oContact:{bDisplay:!0,bUpdate:!1,bCreate:!1,bDelete:!1},oActivity:{bDisplay:!1,bUpdate:!1,bCreate:!1,bDelete:!1},oUser:{bDisplay:!1,bUpdate:!1,bCreate:!1,bDelete:!1}}}}}]),app.factory("servicesProvider",["$rootScope","$state","ngTableParams","$translate","utilsProvider","cacheProvider","apiProvider","dataProvider","rolesSettings","$cookieStore","$window","$filter","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l,m){return{changeLanguage:function(){var b=d.use();switch(b){case"en":d.use("fr");break;case"fr":d.use("en")}a.$emit("languageChanged")},logIn:function(a,b){var c={},d=new Hashes.SHA512;a.password=d.hex(a.password);var e="rest/account/login/"+a.userName+"/"+a.password,f=$.proxy(function(c){var d=this.messagesHandler(c.messages);d&&(b?j.put("userName",{sUserName:a.userName}):j.remove("userName"),this.onLogInSuccessHandler(a.userName))},this);c=h.httpRequest({sPath:e,bShowSpinner:!0,sRequestType:"GET"}),c.then(function(a){f(a)})},logOut:function(){var a="rest/system/initializeSessionVariables",c=$.proxy(function(){f.oUserProfile.sUserName&&this.logLogOut(),f.cleanAllCache(),b.go("signIn")},this);h.ajaxRequest({sPath:a,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:c}})},logSuccessLogIn:function(){g.logEvent({oData:{GeneralAttributes:{},OperationName:"login_success",OperationContent:{sUserName:f.oUserProfile.sUserName,sCompany:f.oUserProfile.sCurrentCompany,sRole:f.oUserProfile.sCurrentRole}}})},logLogOut:function(){g.logEvent({oData:{GeneralAttributes:{},OperationName:"log_out",OperationContent:{sUserName:f.oUserProfile.sUserName,sCompany:f.oUserProfile.sCurrentCompany,sRole:f.oUserProfile.sCurrentRole}}})},onNoDefaultViewForTheRole:function(){this.logOut(),e.displayMessage({sText:d.instant("global_noDefaultViewForTheRole"),sType:"error"})},setUserPhasesForCurrentCompany:function(a){var b=[];f.oUserProfile.aUserPhases=angular.copy(f.oUserProfile.aAllUserPhases);for(var c=0;c<f.oUserProfile.aUserPhases.length;c++)f.oUserProfile.aUserPhases[c].ProjectDetails.CompanyName===a&&b.push(f.oUserProfile.aUserPhases[c]);f.oUserProfile.aAllUserPhases=angular.copy(f.oUserProfile.aUserPhases),f.oUserProfile.aUserPhases=angular.copy(b)},checkUserRolesAssignment:function(a){var c=[],g=!1;f.oUserProfile.aUserRoles=angular.copy(f.oUserProfile.aAllUserRoles);for(var h=0;h<f.oUserProfile.aUserRoles.length;h++)f.oUserProfile.aUserRoles[h].CompanyName===a&&c.push(f.oUserProfile.aUserRoles[h]);return f.oUserProfile.aAllUserRoles=angular.copy(f.oUserProfile.aUserRoles),f.oUserProfile.aUserRoles=angular.copy(c),f.oUserProfile.aUserRoles.length?1===f.oUserProfile.aUserRoles.length?(sCurrentRole=f.oUserProfile.aUserRoles[0].RoleName,(g=i.setCurrentRole(sCurrentRole))?(this.logSuccessLogIn(),void b.go(i.getRolesInitialState(sCurrentRole))):void this.logOut()):void b.go("roleSelection"):(this.logOut(),void e.displayMessage({sText:d.instant("global_noRoleAssignment"),sType:"error"}))},onLogInSuccessHandler:function(a){var c="";return f.oUserProfile=g.getUserProfile(a),f.oUserProfile.bIsInitialPassword?void b.go("initialPasswordReset"):(f.oUserProfile.sPassword="",f.oUserProfile.aUserCompanies.length?1!==f.oUserProfile.aUserCompanies.length?void b.go("companySelection"):(c=f.oUserProfile.aUserCompanies[0].CompanyName,f.oUserProfile.sCurrentCompany=c,g.setCurrentCompany(c),this.setUserPhasesForCurrentCompany(c),this.checkUserRolesAssignment(c),void 0):(this.logOut(),void e.displayMessage({sText:d.instant("global_noCompanyAssignment"),sType:"error"})))},onF5WithCurrentUserHandler:function(a){var c="",h="";return f.oUserProfile=g.getUserProfile(a),f.oUserProfile.bIsInitialPassword?void b.go("signIn"):f.oUserProfile.aUserCompanies.length?(c=g.getCurrentCompany())?(f.oUserProfile.sCurrentCompany=c,this.setUserPhasesForCurrentCompany(c),(h=g.getCurrentRole())?void i.setCurrentRole(h):void b.go("roleSelection")):void b.go("companySelection"):(this.logOut(),void e.displayMessage({sText:d.instant("global_noCompanyAssignment"),sType:"error"}))},messagesHandler:function(a){for(var b=!0,c=0;c<a.length;c++){var f=a[c].messageCode.toString(),g=d.instant("m"+a[c].messageCode);switch(f[c].substring(0,1)){case"1":e.displayMessage({sText:g,sType:"success"});break;case"2":e.displayMessage({sText:g,sType:"error"}),b=!1;break;case"3":e.displayMessage({sText:g,sType:"warning"})}}return b},costructUploadUrl:function(a){var b="",c=function(a){b=a};return h.ajaxRequest({sPath:a.sPath,sRequestType:"GET",bAsync:!1,oData:{},oEventHandlers:{onSuccess:function(a){c(a)}}}),b},deleteFileAttachment:function(a){var b="rest/file/delete/"+a;h.ajaxRequest({sPath:b,sRequestType:"GET",bAsync:!1,oData:{},oEventHandlers:{onSuccess:function(){e.displayMessage({sText:d.instant("global_successOperation"),sType:"success"})}}})},getUserPhasesGuids:function(){for(var a=[],b=0;b<f.oUserProfile.aUserPhases.length;b++)a.push(f.oUserProfile.aUserPhases[b].Guid);return a},constructUserProjectsPhases:function(){for(var a=[],b=!1,c=0,d=angular.copy(f.oUserProfile.aUserPhases),e=0;e<d.length;e++){b=!1,c=0;for(var g=0;g<a.length;g++)if(a[g].Guid===d[e].ProjectDetails.Guid){b=!0,c=g;break}b?a[c].PhaseDetails.results.push(d[e]):(d[e].ProjectDetails.PhaseDetails={results:[]},d[e].ProjectDetails.PhaseDetails.results.push(d[e]),a.push(d[e].ProjectDetails))}a=l("orderBy")(a,["_sortingSequence"]);for(var e=0;e<a.length;e++)a[e].PhaseDetails.results=l("orderBy")(a[e].PhaseDetails.results,["_sortingSequence"]);return a},constructUserProjectsPhasesForMultiSelect:function(a){var b=[];b=angular.copy(f.oUserProfile.aUserPhases);var c={aData:b,aPhases:[]},d=[];d=this.constructUserProjectsPhases();var e=a.aSelectedPhases;return this.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:d},sSecondLevelAttribute:"PhaseDetails",sSecondLevelNameEN:"NameEN",sSecondLevelNameFR:"NameFR",oParentArrayWrapper:c,oNewParentItemArrayWrapper:{aData:[]},sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",aParentKeys:e,sTargetArrayNameInParent:"aPhases"}),c.aData[0]?c.aData[0].aPhases:[]},constructLogoUrl:function(){var b="rest/file/list/companyDependentSettings/"+f.oUserProfile.sCurrentCompany+"/_logo_",c=h.httpRequest({sPath:b});c.then(function(b){a.sLogoUrl=b[0]?k.location.origin+k.location.pathname+"rest/file/get/"+b[0].guid:k.location.origin+k.location.pathname+"img/logo_conspector.png"})},getSeletedItemsKeysInMultiSelect:function(a){for(var b=[],c=0;c<a.aData.length;c++)a.aData[c].ticked===!0&&b.push(a.aData[c][a.sKey]);return b},constructDependentMultiSelectArray:function(a){for(var b=[],c={},e=0;e<a.oDependentArrayWrapper.aData.length;e++)if(a.sSecondLevelAttribute){c={},c.multiSelectGroup=!0;var f="";(a.oDependentArrayWrapper.aData[e][a.sNameEN]||a.oDependentArrayWrapper.aData[e][a.sNameFR])&&(f="en"===d.use()?a.oDependentArrayWrapper.aData[e][a.sNameEN]:a.oDependentArrayWrapper.aData[e][a.sNameFR],f||(f=a.oDependentArrayWrapper.aData[e][a.sNameEN])),c.name='<div class="cnpButtonLabelChild">'+f+"</div>",b.push(c);for(var g=0;g<a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results.length;g++)c={},(a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sSecondLevelNameEN]||a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sSecondLevelNameFR])&&(c.name="en"===d.use()?a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sSecondLevelNameEN]:a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sSecondLevelNameFR],c.name||(c.name=a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sSecondLevelNameEN]),c.fullName='<div class="cnpButtonLabelParent">'+f+'</div><div class="cnpButtonLabelSeparator">&nbsp;-&nbsp;</div><div class="cnpButtonLabelChild">'+c.name+"</div>"),c[a.sDependentKey]=a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sDependentKey],b.push(c);c={},c.multiSelectGroup=!1,b.push(c)}else c={},(a.oDependentArrayWrapper.aData[e][a.sNameEN]||a.oDependentArrayWrapper.aData[e][a.sNameFR])&&(c.name="en"===d.use()?a.oDependentArrayWrapper.aData[e][a.sNameEN]:a.oDependentArrayWrapper.aData[e][a.sNameFR],c.name||(c.name=a.oDependentArrayWrapper.aData[e][a.sNameEN])),a.oDependentArrayWrapper.aData[e][a.sDependentIconKey]&&(c.icon="<img src='"+k.location.origin+k.location.pathname+"rest/file/get/",c.icon=c.icon+a.oDependentArrayWrapper.aData[e][a.sDependentIconKey]+"' class='cnpMultiSelectIcon;'/>"),c[a.sDependentKey]=a.oDependentArrayWrapper.aData[e][a.sDependentKey],b.push(c);a.oNewParentItemArrayWrapper&&(a.oNewParentItemArrayWrapper.aData=angular.copy(b));for(var e=0;e<a.oParentArrayWrapper.aData.length;e++){for(var h=[],i={},j=!1,g=0;g<b.length;g++){if(i={},angular.copy(b[g],i),void 0===i.multiSelectGroup&&(i.ticked=!1),a.sParentKey&&a.oParentArrayWrapper.aData[e][a.sParentKey]===b[g][a.sDependentKey]&&(i.ticked=!0,j=!0),a.sParentKeys)for(var l=0;l<a.oParentArrayWrapper.aData[e][a.sParentKeys].length;l++)b[g][a.sDependentKey]===a.oParentArrayWrapper.aData[e][a.sParentKeys][l]&&(i.ticked=!0,j=!0);if(a.aParentKeys)for(var l=0;l<a.aParentKeys.length;l++)b[g][a.sDependentKey]===a.aParentKeys[l]&&(i.ticked=!0,j=!0);h.push(i)}a.oParentArrayWrapper.aData[e][a.sTargetArrayNameInParent]=h}},createNgTable:function(a){var b=new c({page:1,count:1e4,filterDelay:10,sorting:a.oInitialSorting,filter:a.oInitialFilter,groupsSettings:a.aInitialGroupsSettings},{groupBy:a.sGroupBy,total:a.oInitialDataArrayWrapper.aData.length,sDisplayedDataArrayName:a.sDisplayedDataArrayName,getData:function(b,c){var d=a.oInitialDataArrayWrapper.aData,e=c.filter()?l("filter")(d,c.filter()):d,f=[];if(void 0===c.sorting()||angular.equals(c.sorting(),{}))f=e;else{var g=angular.copy(c.orderBy());a.sGroupsSortingAttribue&&g.unshift(a.sGroupsSortingAttribue),f=l("orderBy")(e,g)}b.resolve(f.slice((c.page()-1)*c.count(),c.page()*c.count()))},counts:[]});return b},showConfirmationPopup:function(a){var b=m.confirm().title(a.sHeader).content(a.sContent).ok(a.sOk).cancel(a.sCancel).targetEvent(a.event);m.show(b).then(function(){a.onOk()},function(){a.onCancel&&a.onCancel()})},refreshUserProfile:function(){var a=f.oUserProfile.sCurrentCompany,b=f.oUserProfile.sCurrentRole,c=angular.copy(f.oUserProfile.aGloballySelectedPhasesGuids);f.oUserProfile=g.getUserProfile(f.oUserProfile.sUserName),f.oUserProfile.sCurrentCompany=a,f.oUserProfile.sCurrentRole=b,f.oUserProfile.aGloballySelectedPhasesGuids=c}}}]),app.factory("historyProvider",[function(){return{aHistoryStates:[],bBackNavigationFlag:!1,addStateToHistory:function(a){this.bBackNavigationFlag||this.aHistoryStates.push(a),this.bBackNavigationFlag=!1},navigateBack:function(a){this.bBackNavigationFlag=!0;var b=this.aHistoryStates[this.aHistoryStates.length-1];this.aHistoryStates.pop(),a.oState.go(b.sStateName,b.oStateParams)},removeHistory:function(){this.aHistoryStates=[]},getPreviousStateName:function(){var a="";return this.aHistoryStates.length&&this.aHistoryStates[this.aHistoryStates.length-1]&&(a=this.aHistoryStates[this.aHistoryStates.length-1].sStateName),a}}}]),angular.module("filtersProvider",[]).filter("phoneFormatter",function(){return function(a){if(!a)return"";var b=a.toString().trim().replace(/^\+/,"");if(b.match(/[^0-9]/))return a;var c,d,e;switch(b.length){case 10:c=0,d=b.slice(0,3),e=b.slice(3);break;case 11:c=1,d=b.slice(1,4),e=b.slice(4);break;default:return a}return 1==c&&(c="1"),0==c&&(c=""),e=e.slice(0,3)+"-"+e.slice(3),(c+" ("+d+") "+e).trim()}}),app.controller("mainController",["$scope","$rootScope","$state","apiProvider","servicesProvider","PubNub","cacheProvider",function(a,b,c,d,e,f,g){var h=d.getCurrentUserName();if(h){e.onF5WithCurrentUserHandler(h);var i="";f.init({publish_key:"pub-c-59bd66cf-9992-42d5-af04-87ec537c73bb",subscribe_key:"sub-c-7606f63c-9908-11e4-a626-02ee2ddab7fe"}),i="conspectorPubNub"+g.oUserProfile.sCurrentCompany,f.ngSubscribe({channel:i}),b.$on(f.ngMsgEv(i),function(a,c){switch(c.message.sUserName!==g.oUserProfile.sUserName&&(g.cleanEntitiesCache(c.message.sEntityName),"oAccountEntity"===c.message.sEntityName&&g.cleanEntitiesCache("oAccountTypeEntity")),c.message.sEntityName){case"oAccountEntity":c.message.sUserName!==g.oUserProfile.sUserName&&b.$broadcast("accountsShouldBeRefreshed");break;case"oContactEntity":c.message.sUserName!==g.oUserProfile.sUserName&&b.$broadcast("contactsShouldBeRefreshed")}})}b.$on("LOAD",function(){b.showSpinner=!0}),b.$on("UNLOAD",function(){b.showSpinner=!1})}]),viewControllers.controller("companySelectionView",["$scope","$rootScope","$state","$translate","utilsProvider","dataProvider","cacheProvider","$filter","rolesSettings","servicesProvider","apiProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=[];b.sCurrentStateName=c.current.name,b.oStateParams={},a.sLanguage=d.use(),b.$on("languageChanged",function(){a.sLanguage=d.use()});for(var n=0;n<g.oUserProfile.aUserCompanies.length;n++){var o={};o.CompanyName=g.oUserProfile.aUserCompanies[n].CompanyName,o.DescriptionEN=g.oUserProfile.aUserCompanies[n].DescriptionEN,o.DescriptionFR=g.oUserProfile.aUserCompanies[n].DescriptionFR,o.DescriptionFR||(o.DescriptionFR=o.DescriptionEN),o._sortingSequence=g.oUserProfile.aUserCompanies[n].GeneralAttributes.SortingSequence,m.push(o)}if(a.aUserCompanies=h("orderBy")(m,["_sortingSequence"]),g.oUserProfile.sCurrentCompany){for(var n=0;n<a.aUserCompanies.length;n++)if(a.aUserCompanies[n].CompanyName===g.oUserProfile.sCurrentCompany){a.sSelectedCompanyName=a.aUserCompanies[n].CompanyName;break}}else a.sSelectedCompanyName=a.aUserCompanies[0].CompanyName;a.onContinue=function(){var b=a.sSelectedCompanyName;g.oUserProfile.sCurrentCompany=b,k.setCurrentCompany(b),g.oUserProfile.aUserRoles=angular.copy(g.oUserProfile.aAllUserRoles),j.checkUserRolesAssignment(b),j.setUserPhasesForCurrentCompany(b)},a.onChangeLanguage=function(){j.changeLanguage()},a.onBack=function(){l.aHistoryStates.length||c.go("signIn"),l.navigateBack({oState:c})},a.$on("$destroy",function(){l.addStateToHistory({sStateName:b.sCurrentStateName})})}]),viewControllers.controller("forgotPasswordView",["$scope","$rootScope","$state","$stateParams","utilsProvider","dataProvider","servicesProvider","apiProvider","$translate","historyProvider",function(a,b,c,d,e,f,g,h,i,j){a.sSelectedResetType="userName",a.resetData={sUserName:"",sEmail:""},a.onChangeLanguage=function(){g.changeLanguage()},a.onReset=function(){var b={userName:"",email:""};if("userName"===a.sSelectedResetType?b.userName=a.resetData.sUserName:b.email=a.resetData.sEmail,!b.userName&&!b.email)return void e.displayMessage({sText:i.instant("global_emptyFields"),sType:"error"});var c=function(a){g.messagesHandler(a.messages)};h.resetPassword({oData:b,onSuccess:c})},a.onResetTypeChange=function(){"userName"===a.sSelectedResetType?a.resetData.sEmail="":a.resetData.sUserName=""},a.onBack=function(){j.aHistoryStates.length||c.go("signIn"),j.navigateBack({oState:c})}}]),viewControllers.controller("initialPasswordResetView",["$scope","$rootScope","$state","dataProvider","$translate","servicesProvider","utilsProvider","cacheProvider","apiProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j){a.oForms={},a.resetPasswordData={sNewPassword:"",sNewPasswordConfirmation:""},b.sCurrentStateName=c.current.name,b.oStateParams={},a.onChangeLanguage=function(){f.changeLanguage()};var k=function(a){h.oUserProfile.sLastModifiedAt=a.LastModifiedAt,f.onLogInSuccessHandler(h.oUserProfile.sUserName,"")};a.resetPassword=function(){a.oForms.initialPasswordResetForm.password.$setDirty(),a.oForms.initialPasswordResetForm.passwordConfirmation.$setDirty();var b=new Hashes.SHA512,c={};return a.resetPasswordData.sNewPassword&&a.resetPasswordData.sNewPasswordConfirmation?a.resetPasswordData.sNewPassword!==a.resetPasswordData.sNewPasswordConfirmation?void g.displayMessage({sText:e.instant("global_passwordsDontMatch"),sType:"error"}):(c.UserName=h.oUserProfile.sUserName,c.Password=i.hashPassword(b.hex(a.resetPasswordData.sNewPassword)),c.IsPasswordInitial=!1,c.LastModifiedAt=h.oUserProfile.sLastModifiedAt,void i.updateUser({bShowSpinner:!0,sKey:c.UserName,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:k})):void g.displayMessage({sText:e.instant("global_emptyFields"),sType:"error"})},a.onBack=function(){j.aHistoryStates.length||c.go("signIn"),j.navigateBack({oState:c})},a.$on("$destroy",function(){j.addStateToHistory({sStateName:b.sCurrentStateName})})}]),viewControllers.controller("passwordResetView",["$scope","$rootScope","$state","dataProvider","$translate","servicesProvider","utilsProvider","cacheProvider","apiProvider","$stateParams","historyProvider",function(a,b,c,d,e,f,g,h,i,j,k){a.oForms={},a.resetPasswordData={sNewPassword:"",sNewPasswordConfirmation:""},b.sCurrentStateName=c.current.name,b.oStateParams={},a.onChangeLanguage=function(){f.changeLanguage()},a.resetPassword=function(){a.oForms.passwordResetForm.password.$setDirty(),a.oForms.passwordResetForm.passwordConfirmation.$setDirty();var b=new Hashes.SHA512,d={};if(!a.resetPasswordData.sNewPassword||!a.resetPasswordData.sNewPasswordConfirmation)return void g.displayMessage({sText:e.instant("global_emptyFields"),sType:"error"});if(a.resetPasswordData.sNewPassword!==a.resetPasswordData.sNewPasswordConfirmation)return void g.displayMessage({sText:e.instant("passwordReset_passwordsDontMatch"),sType:"error"});d.newPassword=b.hex(a.resetPasswordData.sNewPassword),d.passwordRecoveryCode=j.pr;{var h=function(a){var b=f.messagesHandler(a.messages);b&&c.go("signIn")};i.resetPasswordWithPRCode({oData:d,onSuccess:h})}},a.onBack=function(){k.aHistoryStates.length||c.go("signIn"),k.navigateBack({oState:c})},a.$on("$destroy",function(){k.addStateToHistory({sStateName:b.sCurrentStateName})})}]),viewControllers.controller("roleSelectionView",["$scope","$rootScope","$state","$translate","utilsProvider","dataProvider","cacheProvider","$filter","rolesSettings","servicesProvider","apiProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j,k,l){var m=[];b.sCurrentStateName=c.current.name,b.oStateParams={},a.sLanguage=d.use(),b.$on("languageChanged",function(){a.sLanguage=d.use()});for(var n=0;n<g.oUserProfile.aUserRoles.length;n++){var o={};o.RoleName=g.oUserProfile.aUserRoles[n].RoleName,o.DescriptionEN=g.oUserProfile.aUserRoles[n].DescriptionEN,o.DescriptionFR=g.oUserProfile.aUserRoles[n].DescriptionFR,o.CompanyName=g.oUserProfile.aUserRoles[n].CompanyName,o.DescriptionFR||(o.DescriptionFR=o.DescriptionEN),o._sortingSequence=g.oUserProfile.aUserRoles[n].GeneralAttributes.SortingSequence,o.CompanyName===g.oUserProfile.sCurrentCompany&&m.push(o)}if(a.aUserRoles=h("orderBy")(m,["_sortingSequence"]),g.oUserProfile.sCurrentRole){for(var p=!1,n=0;n<a.aUserRoles.length;n++)if(a.aUserRoles[n].RoleName===g.oUserProfile.sCurrentRole){a.sSelectedRoleName=a.aUserRoles[n].RoleName,p=!0;break}p||(a.sSelectedRoleName=a.aUserRoles[0].RoleName)}else a.sSelectedRoleName=a.aUserRoles[0].RoleName;a.onContinue=function(){var b=a.sSelectedRoleName,d=!1;return(d=i.setCurrentRole(b))?(j.logSuccessLogIn(),void c.go(i.getRolesInitialState(b))):void j.logOut()},a.onChangeLanguage=function(){j.changeLanguage()},a.onBack=function(){l.aHistoryStates.length||c.go("signIn"),l.navigateBack({oState:c})},a.$on("$destroy",function(){l.addStateToHistory({sStateName:b.sCurrentStateName})})}]),viewControllers.controller("signInView",["$scope","$rootScope","$state","servicesProvider","dataProvider","$cookieStore","utilsProvider","$translate","historyProvider",function(a,b,c,d,e,f,g,h,i){b.sCurrentStateName=c.current.name,a.oForms={};var j={},k="";f.get("userName")&&(k=f.get("userName").sUserName),a.logInData={sUserName:k,sPassword:"",bRememberUserName:!0},a.onChangeLanguage=function(){d.changeLanguage()},a.login=function(){if(a.oForms.signInForm.password.$setDirty(),a.oForms.signInForm.userName.$setDirty(),a.oForms.signInForm.$valid){var b={userName:a.logInData.sUserName,password:a.logInData.sPassword};d.logIn(b,a.logInData.bRememberUserName)}},a.passwordFldKeyDown=function(a){13===a.keyCode&&this.login()},a.onSignInClick=function(){a.bSubmitted=!0,this.login()},a.onSwitchLanguage=function(){g.switchLanguage()},a.onForgotPassword=function(){c.go("forgotPassword")},a.$on("$destroy",function(){i.addStateToHistory({sStateName:b.sCurrentStateName})}),a.setForm=function(a){j=angular.copy(a)}}]),viewControllers.controller("appView",["$scope","$rootScope","$state","$window","servicesProvider","$translate","$timeout","cacheProvider","rolesSettings","$cookieStore","historyProvider",function(a,b,c,d,e,f,g,h,i,j,k){var l=h.oUserProfile.sUserName,m=h.oUserProfile.sCurrentCompany,n=[];
a.sCurrentUser=l,b.sCurrentStateName=c.current.name,b.oStateParams={},l||e.logOut(),e.constructLogoUrl(),n=j.get("globallySelectedPhasesGuids"+l+m)&&j.get("globallySelectedPhasesGuids"+l+m).aPhasesGuids?angular.copy(j.get("globallySelectedPhasesGuids"+l+m).aPhasesGuids):e.getUserPhasesGuids(),h.oUserProfile.aGloballySelectedPhasesGuids=n,a.globalProjectsWithPhases=e.constructUserProjectsPhasesForMultiSelect({aSelectedPhases:n}),a.onGlobalUserPhasesChanged=function(){var b=[];b=e.getSeletedItemsKeysInMultiSelect({sKey:"Guid",aData:a.globalProjectsWithPhases}),j.put("globallySelectedPhasesGuids"+l+m,{aPhasesGuids:b}),h.oUserProfile.aGloballySelectedPhasesGuids=b,a.$broadcast("globalUserPhasesHaveBeenChanged")};var o=h.oUserProfile.sCurrentRole;h.oUserProfile.oCurrentRoleSettings&&i.getRolesMainMenuItemSettings({sRole:o,sMenuItem:"bShowAdminPanel"})&&(a.bDisplayAdminPanel=!0),h.oUserProfile.oCurrentRoleSettings&&i.getRolesMainMenuItemSettings({sRole:o,sMenuItem:"bShowProfileSettings"})&&(a.bDisplayProfileSettings=!0),h.oUserProfile.aUserCompanies&&h.oUserProfile.aUserCompanies.length>1&&(a.bDisplaySwitchCompanies=!0),h.oUserProfile.aUserRoles&&h.oUserProfile.aUserRoles.length>1&&(a.bDisplaySwitchRoles=!0),a.aTabs=[],h.oUserProfile.oCurrentRoleSettings&&i.getRolesMainMenuItemSettings({sRole:o,sMenuItem:"bShowDeficiencies"})&&a.aTabs.push({sTitle:"app_deficienciesTab",sState:"app.deficienciesList"}),h.oUserProfile.oCurrentRoleSettings&&i.getRolesMainMenuItemSettings({sRole:o,sMenuItem:"bShowUnits"})&&a.aTabs.push({sTitle:"app_unitsTab",sState:"app.unitsList"}),h.oUserProfile.oCurrentRoleSettings&&i.getRolesMainMenuItemSettings({sRole:o,sMenuItem:"bShowContractors"})&&a.aTabs.push({sTitle:"app_contractorsTab",sState:"app.contractorsList"}),h.oUserProfile.oCurrentRoleSettings&&i.getRolesMainMenuItemSettings({sRole:o,sMenuItem:"bShowClients"})&&a.aTabs.push({sTitle:"app_clientsTab",sState:"app.clientsList"}),h.oUserProfile.oCurrentRoleSettings&&i.getRolesMainMenuItemSettings({sRole:o,sMenuItem:"bShowContacts"})&&a.aTabs.push({sTitle:"app_contactsTab",sState:"app.contactsList"}),h.oUserProfile.oCurrentRoleSettings&&i.getRolesMainMenuItemSettings({sRole:o,sMenuItem:"bShowActivities"})&&a.aTabs.push({sTitle:"app_activitiesTab",sState:"app.activitiesList"}),a.onSwitchCompanies=function(){c.go("companySelection")},a.onSwitchRoles=function(){c.go("roleSelection")},a.onLogOut=function(){e.logOut()};var p=function(b){for(var c=0;c<a.aTabs.length;c++)if(a.aTabs[c].sState===b)return c},q=function(){return d.location.hash.indexOf("#/app/adminPanel")>-1||d.location.hash.indexOf("#/app/profileSettings")>-1||d.location.hash.indexOf("#/app/clientDetails")>-1||d.location.hash.indexOf("#/app/contractorDetails")>-1||d.location.hash.indexOf("#/app/contactDetails")>-1||d.location.hash.indexOf("#/app/deficiencyDetails")>-1?(a.selectedTabIndex=-1,void a.$broadcast("$mdTabsPaginationChanged")):d.location.hash.indexOf("deficienc")>-1?void(a.selectedTabIndex=p("app.deficienciesList")):d.location.hash.indexOf("unit")>-1?void(a.selectedTabIndex=p("app.unitsList")):d.location.hash.indexOf("contractor")>-1?void(a.selectedTabIndex=p("app.contractorsList")):d.location.hash.indexOf("client")>-1?void(a.selectedTabIndex=p("app.clientsList")):d.location.hash.indexOf("contact")>-1?void(a.selectedTabIndex=p("app.contactsList")):d.location.hash.indexOf("activity")>-1?void(a.selectedTabIndex=p("app.activitiesList")):void 0};g(q,100),a.onTabSelect=function(b){var e="";d.location.hash.indexOf("deficienc")>-1&&(e="Deficiencies"),d.location.hash.indexOf("unit")>-1&&(e="Units"),d.location.hash.indexOf("contractor")>-1&&(e="Contractors"),d.location.hash.indexOf("client")>-1&&(e="Clients"),d.location.hash.indexOf("contact")>-1&&(e="Contacts"),d.location.hash.indexOf("activity")>-1&&(e="Activities"),void 0!==a.selectedTabIndex&&c.go(b.sState)},a.onAdminPanel=function(){a.selectedTabIndex=-1,a.$broadcast("$mdTabsPaginationChanged"),c.go("app.adminPanel.usersList")},a.onProfileSettings=function(){a.selectedTabIndex=-1,a.$broadcast("$mdTabsPaginationChanged"),c.go("app.profileSettings.profileDetails")},a.onChangeLanguage=function(){e.changeLanguage()},a.$on("$stateChangeSuccess",function(){g(q,100)}),a.$on("$destroy",function(){k.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:b.oStateParams})})}]),viewControllers.controller("deficienciesListView",["$scope","$rootScope","$state","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider","$mdSidenav","$window","$filter","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l){h.removeHistory();var m=g.oUserProfile.sCurrentRole;a.bDisplayAddButton=l.getRolesSettingsForEntityAndOperation({sRole:m,sEntityName:"oDeficiency",sOperation:"bCreate"}),a.bDisplayEditButtons=l.getRolesSettingsForEntityAndOperation({sRole:m,sEntityName:"oDeficiency",sOperation:"bUpdate"}),b.sCurrentStateName=c.current.name,b.oStateParams={};var n={aData:[]},o=g.getTableStatusFromCache({sTableName:"deficienciesList",sStateName:b.sCurrentStateName}),p={};o&&!angular.equals(o.oSorting,{})&&(p=angular.copy(o.oSorting));var q={};o&&!angular.equals(o.oFilter,{})&&(q=angular.copy(o.oFilter));var r=[];o&&!angular.equals(o.aGroups,[])&&(r=angular.copy(o.aGroups)),a.tableParams=d.createNgTable({oInitialDataArrayWrapper:n,sDisplayedDataArrayName:"aDisplayedDeficiencies",oInitialSorting:p,oInitialFilter:q,aInitialGroupsSettings:r,sGroupBy:"sProjectPhase",sGroupsSortingAttribue:"_sortingSequence"});var s=function(b){for(var c="",d="",f="",h=!1,i=0,k="",l=0;l<b.length;l++){if(c="",d="",f="",i=0,k="",h=!1,b[l].PhaseDetails){i=b[l].PhaseDetails.GeneralAttributes.SortingSequence;for(var m=0;m<g.oUserProfile.aGloballySelectedPhasesGuids.length;m++)if(b[l].PhaseDetails.Guid===g.oUserProfile.aGloballySelectedPhasesGuids[m]){h=!0;break}c="en"===e.use()?b[l].PhaseDetails.ProjectDetails.NameEN:b[l].PhaseDetails.ProjectDetails.NameFR,c||(c=b[l].PhaseDetails.ProjectDetails.NameEN),d="en"===e.use()?b[l].PhaseDetails.NameEN:b[l].PhaseDetails.NameFR,d||(d=b[l].PhaseDetails.NameEN),f=c+" - "+d}else f="Not Assigned";b[l].TaskStatusDetails&&(k=j.location.origin+j.location.pathname+"rest/file/get/"+b[l].TaskStatusDetails.AssociatedIconFileGuid),n.aData.push({_guid:b[l].Guid,sTags:b[l].DescriptionTags,sProjectPhase:f,_sortingSequence:i,sStatuseIconUrl:k})}a.tableParams.reload()},t=function(){n.aData=[],f.getDeficiencies({sExpand:"PhaseDetails/ProjectDetails,TaskStatusDetails",bShowSpinner:!0,onSuccess:s})};t(),a.onDisplay=function(a){c.go("app.deficiencyDetailsWrapper.deficiencyDetails",{sMode:"display",sDeficiencyGuid:a._guid})},a.onEdit=function(a){c.go("app.deficiencyDetailsWrapper.deficiencyDetails",{sMode:"edit",sDeficiencyGuid:a._guid})},a.onAddNew=function(){c.go("app.deficiencyDetailsWrapper.deficiencyDetails",{sMode:"create",sDeficiencyGuid:""})},a.$on("globalUserPhasesHaveBeenChanged",function(){loadDeficiencys()}),a.$on("accountsShouldBeRefreshed",function(){loadDeficiencys()}),a.$on("$destroy",function(){h.getPreviousStateName()!==b.sCurrentStateName&&(h.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:b.oStateParams}),g.putTableStatusToCache({sTableName:"deficienciesList",sStateName:b.sCurrentStateName,aGroups:a.tableParams.settings().$scope.$groups,oFilter:a.tableParams.$params.filter,oSorting:a.tableParams.$params.sorting}))})}]),viewControllers.controller("deficiencyDetailsView",["$scope","$rootScope","$state","servicesProvider","apiProvider","$translate","$stateParams","cacheProvider","utilsProvider","$filter","dataProvider","CONSTANTS","historyProvider","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.sDeficiencyGuid;a.oForms={},b.sCurrentStateName=c.current.name,b.oStateParams=angular.copy(g);var p=h.oUserProfile.sCurrentRole;a.bDisplayEditButton=n.getRolesSettingsForEntityAndOperation({sRole:p,sEntityName:"oContact",sOperation:"bUpdate"}),a.bDisplayDeleteButton=n.getRolesSettingsForEntityAndOperation({sRole:p,sEntityName:"oContact",sOperation:"bDelete"}),a.bShowBackButton=m.aHistoryStates.length>0?!0:!1;var q=!1,r={};a.sMode=g.sMode,a.oDeficiency={};var s={aData:[{}]},t=function(b){a.aUserProjectsPhasesForMultiselect=d.constructUserProjectsPhasesForMultiSelect({aSelectedPhases:b})},u=function(b){a.oDeficiency._guid=b.Guid,a.oDeficiency._lastModifiedAt=b.LastModifiedAt,a.oDeficiency.aDescriptionTags=i.tagsStringToTagsArray(b.DescriptionTags),a.oDeficiency.aLocationTags=i.tagsStringToTagsArray(b.LocationTags),t([b.PhaseGuid]),a.oDeficiency._deficiencyStatusGuid=b.TaskStatusGuid,s.aData[0]=angular.copy(a.oDeficiency)},v="CompanyName eq '"+h.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false";v+="PhaseDetails/ProjectDetails";var w=h.getEntityDetails({sCacheProviderAttribute:"oDeficiencyEntity",sRequestSettings:v,sKeyName:"Guid",sKeyValue:o}),x=function(b){for(var c=0;c<b.length;c++)b[c]._sortingSequence=b[c].GeneralAttributes.SortingSequence;b=j("orderBy")(b,["_sortingSequence"]),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},oParentArrayWrapper:s,sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",sParentKey:"_deficiencyStatusGuid",sDependentIconKey:"AssociatedIconFileGuid",sTargetArrayNameInParent:"aDeficiencyStatuses"}),s.aData[0]&&(a.aDeficiencyStatuses=angular.copy(s.aData[0].aDeficiencyStatuses))},y=function(a){u(a),e.getDeficiencyStatuses({bShowSpinner:!1,onSuccess:x})},z=function(){e.getDeficiency({sExpand:"PhaseDetails/ProjectDetails,TaskStatusDetails",sKey:o,bShowSpinner:!0,onSuccess:y})};"create"!==a.sMode?angular.equals(w,{})?z():(u(w),e.getDeficiencyStatuses({bShowSpinner:!1,onSuccess:x})):(t({aSelectedPhases:[]}),e.getDeficiencyStatuses({bShowSpinner:!1,onSuccess:x})),a.onEdit=function(){c.go("app.deficiencyDetailsWrapper.deficiencyDetails",{sMode:"edit",sDeficiencyGuid:a.oDeficiency._guid})};var A=function(){var b={GeneralAttributes:{IsDeleted:!0}},d=function(){m.navigateBack({oState:c})};b.Guid=a.oDeficiency._guid,b.LastModifiedAt=a.oDeficiency._lastModifiedAt,e.updateDeficiency({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})};a.onDelete=function(a){d.showConfirmationPopup({sHeader:f.instant("deficiencyDetails_deletionConfirmationHeader"),sContent:f.instant("deficiencyDetails_deletionConfirmationContent"),sOk:f.instant("global_ok"),sCancel:f.instant("global_cancel"),onOk:A,event:a})};a.onCloseCheckSelectedPhasesLength=function(){0==a.aSelectedPhases.length&&a.onSelectedPhasesModified()},a.onSelectedPhasesModified=function(){a.onDataModified(),a.oForms.deficiencyDetailsForm.selectedPhases.$setDirty()},a.onCloseCheckSelectedPhasesLength=function(){0==a.aSelectedPhases.length&&a.onSelectedPhasesModified()},a.onSelectedStatusesModified=function(){a.onDataModified(),a.oForms.deficiencyDetailsForm.selectedStatuses.$setDirty()},a.onDataModified=function(){q=!0},a.onSave=function(b,d){if(a.oForms.deficiencyDetailsForm.selectedPhases&&a.oForms.deficiencyDetailsForm.selectedPhases.$setDirty(),a.oForms.deficiencyDetailsForm.selectedStatuses&&a.oForms.deficiencyDetailsForm.selectedStatuses.$setDirty(),a.oForms.deficiencyDetailsForm.$valid){var f={GeneralAttributes:{}};f.Guid=a.oDeficiency._guid;var g=function(e){return q=!1,d?void c.go(d.toState,d.toParams):void(b?(a.oDeficiency.aDescriptionTags=[],a.oDeficiency.aLocationTags=[]):(c.go("app.deficiencyDetailsWrapper.deficiencyDetails",{sMode:"display",sDeficiencyGuid:e.Guid}),a.oDeficiency._lastModifiedAt=e.LastModifiedAt,a.oDeficiency.sLastModifiedAt=i.dBDateToSting(e.LastModifiedAt),a.oDeficiency.sCreatedAt=i.dBDateToSting(e.CreatedAt),a.oDeficiency._guid=e.Guid))},h=function(b){return q=!1,d?void c.go(d.toState,d.toParams):(a.oDeficiency._lastModifiedAt=b.LastModifiedAt,a.oDeficiency.sLastModifiedAt=i.dBDateToSting(b.LastModifiedAt),void c.go("app.deficiencyDetailsWrapper.deficiencyDetails",{sMode:"display",sDeficiencyGuid:b.Guid}))};switch(f.DescriptionTags=i.tagsArrayToTagsString(a.oDeficiency.aDescriptionTags),f.LocationTags=i.tagsArrayToTagsString(a.oDeficiency.aLocationTags),a.aSelectedPhases.length&&(f.PhaseGuid=a.aSelectedPhases[0].Guid),a.aSelectedStatuses.length&&(f.TaskStatusGuid=a.aSelectedStatuses[0].Guid),f.LastModifiedAt=a.oDeficiency._lastModifiedAt,a.sMode){case"edit":e.updateDeficiency({bShowSpinner:!0,sKey:f.Guid,oData:f,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:h});break;case"create":e.createDeficiency({bShowSpinner:!0,oData:f,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:g})}}},a.onBack=function(){m.navigateBack({oState:c})},a.onSaveAndNew=function(){a.onSave(!0)};var B=function(){a.onSave(!1,r)},C=function(){q=!1,c.go(r.toState,r.toParams)};a.$on("$stateChangeStart",function(a,b,c){q&&(a.preventDefault(),r={toState:b,toParams:c},d.showConfirmationPopup({sHeader:f.instant("global_changesSaveConfirmationHeader"),sContent:f.instant("global_changesSaveConfirmationContent"),sOk:f.instant("global_yes"),sCancel:f.instant("global_no"),onOk:B,onCancel:C,event:a}))})}]),viewControllers.controller("deficiencyDetailsWrapperView",["$scope","$rootScope","$state","$stateParams","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i){a.$on("$destroy",function(){i.getPreviousStateName()!==b.sCurrentStateName&&i.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:angular.copy(b.oStateParams)})})}]),viewControllers.controller("unitDetailsView",["$scope","$rootScope","$state","servicesProvider","apiProvider","$translate","$stateParams","cacheProvider","utilsProvider","$filter","dataProvider","CONSTANTS","historyProvider","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.sUnitGuid;a.oForms={},b.sCurrentStateName=c.current.name,b.oStateParams=angular.copy(g);var p=h.oUserProfile.sCurrentRole;a.bDisplayEditButton=n.getRolesSettingsForEntityAndOperation({sRole:p,sEntityName:"oContact",sOperation:"bUpdate"}),a.bDisplayDeleteButton=n.getRolesSettingsForEntityAndOperation({sRole:p,sEntityName:"oContact",sOperation:"bDelete"}),a.bShowBackButton=m.aHistoryStates.length>0?!0:!1;var q=!1;a.sMode=g.sMode,a.oUnit={aDescriptionTags:[]};var r="CompanyName eq '"+h.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false";r+="";var s=h.getEntityDetails({sCacheProviderAttribute:"oUnitEntity",sRequestSettings:r,sKeyName:"Guid",sKeyValue:o}),t=function(a){setDisplayedUnitDetails(a)},u=function(){e.getUnit({sKey:o,bShowSpinner:!0,onSuccess:t})};"create"!==a.sMode&&(angular.equals(s,{})?u():setDisplayedUnitDetails(s)),a.onEdit=function(){c.go("app.unitDetailsWrapper.unitDetails",{sMode:"edit",sUnitGuid:a.oUnit._guid})},a.onDataModified=function(){q=!0},a.onSave=function(b,d){var f={GeneralAttributes:{}};f.Guid=a.oUnit._guid;var g=function(e){q=!1,d&&c.go(d.toState,d.toParams),b||(c.go("app.unitDetailsWrapper.unitDetails",{sMode:"display",sUnitGuid:e.Guid}),a.oUnit._lastModifiedAt=e.LastModifiedAt,a.oUnit.sLastModifiedAt=i.dBDateToSting(e.LastModifiedAt),a.oUnit.sCreatedAt=i.dBDateToSting(e.CreatedAt),a.oUnit._guid=e.Guid)},h=function(b){q=!1,d&&c.go(d.toState,d.toParams),a.oUnit._lastModifiedAt=b.LastModifiedAt,a.oUnit.sLastModifiedAt=i.dBDateToSting(b.LastModifiedAt),c.go("app.unitDetailsWrapper.unitDetails",{sMode:"display",sUnitGuid:b.Guid})};switch(f.DescriptionTags=i.tagsArrayToTagsString(a.oUnit.aDescriptionTags),f.LastModifiedAt=a.oUnit._lastModifiedAt,a.sMode){case"edit":e.updateUnit({bShowSpinner:!0,sKey:f.Guid,oData:f,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:h});break;case"create":e.createUnit({bShowSpinner:!0,oData:f,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:g})}},a.onBack=function(){m.navigateBack({oState:c})}}]),viewControllers.controller("unitDetailsWrapperView",["$scope","$rootScope","$state","$stateParams","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i){a.$on("$destroy",function(){i.getPreviousStateName()!==b.sCurrentStateName&&i.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:angular.copy(b.oStateParams)})})}]),viewControllers.controller("unitsListView",["$scope","$rootScope","$state","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider","$mdSidenav","$window","$filter","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l){h.removeHistory();var m=g.oUserProfile.sCurrentRole;a.bDisplayAddButton=l.getRolesSettingsForEntityAndOperation({sRole:m,sEntityName:"oUnit",sOperation:"bCreate"}),a.bDisplayEditButtons=l.getRolesSettingsForEntityAndOperation({sRole:m,sEntityName:"oUnit",sOperation:"bUpdate"}),b.sCurrentStateName=c.current.name,b.oStateParams={};var n={aData:[]},o=g.getTableStatusFromCache({sTableName:"unitsList",sStateName:b.sCurrentStateName}),p={};o&&!angular.equals(o.oSorting,{})&&(p=angular.copy(o.oSorting));var q={};o&&!angular.equals(o.oFilter,{})&&(q=angular.copy(o.oFilter));var r=[];o&&!angular.equals(o.aGroups,[])&&(r=angular.copy(o.aGroups)),a.tableParams=d.createNgTable({oInitialDataArrayWrapper:n,sDisplayedDataArrayName:"aDisplayedUnits",oInitialSorting:p,oInitialFilter:q,aInitialGroupsSettings:r,sGroupBy:"sProjectPhase",sGroupsSortingAttribue:"_sortingSequence"});var s=function(b){for(var c=!1,d=0,e=0;e<b.length;e++){if(d=0,c=!1,b[e].PhaseDetails){d=b[e].PhaseDetails.GeneralAttributes.SortingSequence;for(var f=0;f<g.oUserProfile.aGloballySelectedPhasesGuids.length;f++)if(b[e].PhaseDetails.Guid===g.oUserProfile.aGloballySelectedPhasesGuids[f]){c=!0;break}}n.aData.push({_guid:b[e].Guid,sTags:b[e].DescriptionTags,sProjectPhase:"None",_sortingSequence:d})}a.tableParams.reload()},t=function(){n.aData=[],f.getUnits({sExpand:"PhaseDetails/ProjectDetails",bShowSpinner:!0,onSuccess:s})};t(),a.onDisplay=function(a){c.go("app.unitDetailsWrapper.unitDetails",{sMode:"display",sUnitGuid:a._guid})},a.onEdit=function(a){c.go("app.unitDetailsWrapper.unitDetails",{sMode:"edit",sUnitGuid:a._guid})},a.onAddNew=function(){c.go("app.unitDetailsWrapper.unitDetails",{sMode:"create",sUnitGuid:""})},a.$on("globalUserPhasesHaveBeenChanged",function(){t()}),a.$on("accountsShouldBeRefreshed",function(){t()}),a.$on("$destroy",function(){h.getPreviousStateName()!==b.sCurrentStateName&&(h.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:b.oStateParams}),g.putTableStatusToCache({sTableName:"unitsList",sStateName:b.sCurrentStateName,aGroups:a.tableParams.settings().$scope.$groups,oFilter:a.tableParams.$params.filter,oSorting:a.tableParams.$params.sorting}))})}]),viewControllers.controller("contractorDetailsView",["$rootScope","$scope","$state","servicesProvider","apiProvider","$translate","$stateParams","cacheProvider","utilsProvider","$filter","dataProvider","CONSTANTS","historyProvider","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.oForms={};var o=g.sContractorGuid;b.sAccountType="",b.sMode=g.sMode,a.sCurrentStateName=c.current.name,a.oStateParams=angular.copy(g);var p=h.oUserProfile.sCurrentRole;b.bDisplayEditButton=n.getRolesSettingsForEntityAndOperation({sRole:p,sEntityName:"oContractor",sOperation:"bUpdate"}),b.bDisplayDeleteButton=n.getRolesSettingsForEntityAndOperation({sRole:p,sEntityName:"oContractor",sOperation:"bDelete"}),b.bShowBackButton=m.aHistoryStates.length>0?!0:!1,"app.contractorDetailsWrapper.contractorDetails"===a.sCurrentStateName&&(("display"===b.sMode||"edit"===b.sMode)&&(b.$parent.bDisplayContactsList=!0),b.sAccountType="Contractor"),b.sAccountTypeGuid="";var q=!1,r={};b.oContractor={_aPhases:[]};var s={aData:[{}]},t=[];b.aBillingCountries=[],b.aBillingProvinces=[],b.aShippingCountries=[],b.aShippingProvinces=[];var u=function(a){b.aUserProjectsPhasesForMultiselect=d.constructUserProjectsPhasesForMultiSelect({aSelectedPhases:a})},v=function(a){var c=[];b.oContractor._guid=a.Guid,b.oContractor._lastModifiedAt=a.LastModifiedAt,b.oContractor.sName=a.Name,b.oContractor.sPhone=a.MainPhone,b.oContractor.sPhoneExtension=a.MainPhoneExtension,b.oContractor.sSecondaryPhone=a.SecondaryPhone,b.oContractor.sSecondaryPhoneExtension=a.SecondaryPhoneExtension,b.oContractor.sWebsite=a.Website,b.oContractor.sEmail=a.Email,b.oContractor.sFax=a.Fax,b.oContractor.aTags=i.tagsStringToTagsArray(a.DescriptionTags),a.BillingAddress&&(b.oContractor.sBillingStreet=a.BillingAddress.BillingStreet,b.oContractor.sBillingCity=a.BillingAddress.BillingCity,b.oContractor.sBillingPostalCode=a.BillingAddress.BillingPostalCode,b.oContractor._billingCountryCode=a.BillingAddress.BillingCountry,b.oContractor._billingProvinceCode=a.BillingAddress.BillingProvince),a.ShippingAddress&&(b.oContractor.sShippingStreet=a.ShippingAddress.ShippingStreet,b.oContractor.sShippingCity=a.ShippingAddress.ShippingCity,b.oContractor.sShippingPostalCode=a.ShippingAddress.ShippingPostalCode,b.oContractor._shippingCountryCode=a.ShippingAddress.ShippingCountry,b.oContractor._shippingProvinceCode=a.ShippingAddress.ShippingProvince),b.oContractor.sCreatedAt=i.dBDateToSting(a.CreatedAt),b.oContractor.sLastModifiedAt=i.dBDateToSting(a.LastModifiedAt),b.oContractor._aPhases=angular.copy(a.PhaseDetails.results);for(var d=0;d<b.oContractor._aPhases.length;d++)c.push(b.oContractor._aPhases[d].Guid);u(c),s.aData[0]=angular.copy(b.oContractor)},w=h.getEntityDetails({sCacheProviderAttribute:"oAccountEntity",sRequestSettings:"CompanyName eq '"+h.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq falsePhaseDetails/ProjectDetails,AccountTypeDetails",sKeyName:"Guid",sKeyValue:g.sContractorGuid}),x=function(a){var c=a.sParentKey,e="",f="";"billingAddress"===a.sProvincesFor?(e="aBillingProvinces",f="aBillingCountries"):(e="aShippingProvinces",f="aShippingCountries");for(var g=0;g<b[f].length;g++)if(b[f][g].ticked){for(var h=0;h<t.length;h++)if(b[f][g].CountryCode===t[h].CountryCode){d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:t[h].ProvinceDetails.results},oParentArrayWrapper:s,sNameEN:"Name",sNameFR:"Name",sDependentKey:"ProvinceCode",sParentKey:c,sTargetArrayNameInParent:e}),s.aData[0]&&(b[e]=angular.copy(s.aData[0][e]));break}break}},y=function(a){t=angular.copy(a),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:s,sNameEN:"Name",sNameFR:"Name",sDependentKey:"CountryCode",sParentKey:"_billingCountryCode",sTargetArrayNameInParent:"aBillingCountries"}),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:s,sNameEN:"Name",sNameFR:"Name",sDependentKey:"CountryCode",sParentKey:"_shippingCountryCode",sTargetArrayNameInParent:"aShippingCountries"}),s.aData[0]&&(b.aBillingCountries=angular.copy(s.aData[0].aBillingCountries),b.aShippingCountries=angular.copy(s.aData[0].aShippingCountries)),b.oContractor._billingCountryCode&&x({sParentKey:"_billingProvinceCode",sProvincesFor:"billingAddress"}),b.oContractor._shippingCountryCode&&x({sParentKey:"_shippingProvinceCode",sProvincesFor:"shippingAddress"})},z=function(a){v(a),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:y})},A=function(){e.getAccountWithPhases({sKey:o,bShowSpinner:!0,onSuccess:z})},B=function(a){b.sAccountTypeGuid=a[0].Guid};"create"!==b.sMode?angular.equals(w,{})?A():(v(w),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:y})):(u({aSelectedPhases:[]}),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:y}),"Contractor"===b.sAccountType&&e.getContractorAccountType({bShowSpinner:!1,onSuccess:B}),"Client"===b.sAccountType&&e.getClientAccountType({bShowSpinner:!1,onSuccess:B})),b.onEdit=function(){c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"edit",sContractorGuid:b.oContractor._guid})};var C=function(){var a={GeneralAttributes:{IsDeleted:!0}},d=function(){m.navigateBack({oState:c})};a.Guid=b.oContractor._guid,a.LastModifiedAt=b.oContractor._lastModifiedAt,e.updateAccount({bShowSpinner:!0,sKey:a.Guid,oData:a,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})};b.onDelete=function(a){d.showConfirmationPopup({sHeader:f.instant("contractorDetails_deletionConfirmationHeader"),sContent:f.instant("contractorDetails_deletionConfirmationContent"),sOk:f.instant("global_ok"),sCancel:f.instant("global_cancel"),onOk:C,event:a})};var D=function(){for(var a=[],c=[],d="",e=0;e<b.aUserProjectsPhasesForMultiselect.length;e++)b.aUserProjectsPhasesForMultiselect[e].ticked&&(d="Phases('"+b.aUserProjectsPhasesForMultiselect[e].Guid+"')",c.push(d));return c.length&&a.push({sRelationName:"PhaseDetails",bKeepCompanyDependentLinks:!0,aUri:c}),a};b.onCloseCheckSelectedPhasesLength=function(){0==b.aSelectedPhases.length&&b.onSelectedPhasesModified()},b.onSelectedPhasesModified=function(){b.onDataModified(),b.oForms.contractorDetailsForm.selectedPhases.$setDirty()},b.onDataModified=function(){q=!0},b.onBillingCountryChanged=function(){b.onDataModified(),x({sParentKey:"",sProvincesFor:"billingAddress"})},b.onShippingCountryChanged=function(){b.onDataModified(),x({sParentKey:"",sProvincesFor:"shippingAddress"})},b.onBack=function(){m.navigateBack({oState:c})},b.onSave=function(a,d){if(b.oForms.contractorDetailsForm.selectedPhases&&b.oForms.contractorDetailsForm.selectedPhases.$setDirty(),b.oForms.contractorDetailsForm.contractorName&&b.oForms.contractorDetailsForm.contractorName.$setDirty(),b.oForms.contractorDetailsForm.$valid){var f={GeneralAttributes:{}},g=[],h=function(e){return q=!1,d?void c.go(d.toState,d.toParams):void(a?(b.oContractor.sName="",b.oContractor.sPhone="",b.oContractor.sPhoneExtension="",b.oContractor.sSecondaryPhone="",b.oContractor.sSecondaryPhoneExtension="",b.oContractor.sWebsite="",b.oContractor.sEmail="",b.oContractor.sFax="",b.oContractor.aTags=[],b.oContractor.sBillingStreet="",b.oContractor.sBillingCity="",b.oContractor.sBillingPostalCode="",b.oContractor.sShippingStreet="",b.oContractor.sShippingCity="",b.oContractor.sShippingPostalCode="",b.oForms.contractorDetailsForm.contractorName.$setPristine(),f.BillingAddress={},f.ShippingAddress={},b.oContractor._aPhases=[]):(b.oContractor._lastModifiedAt=e.LastModifiedAt,b.oContractor.sLastModifiedAt=i.dBDateToSting(e.LastModifiedAt),b.oContractor.sCreatedAt=i.dBDateToSting(e.CreatedAt),b.oContractor._guid=e.Guid,c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"display",sContractorGuid:e.Guid})))},j=function(a){return q=!1,b.oContractor._lastModifiedAt=a.LastModifiedAt,b.oContractor.sLastModifiedAt=i.dBDateToSting(a.LastModifiedAt),d?void c.go(d.toState,d.toParams):void c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"display",sContractorGuid:a.Guid})};f.Guid=b.oContractor._guid,f.Name=b.oContractor.sName,f.MainPhone=b.oContractor.sPhone?b.oContractor.sPhone.replace(/\D/g,""):"",f.SecondaryPhone=b.oContractor.sSecondaryPhone?b.oContractor.sSecondaryPhone.replace(/\D/g,""):"",f.Fax=b.oContractor.sFax?b.oContractor.sFax.replace(/\D/g,""):"",f.Website=b.oContractor.sWebsite,f.Email=b.oContractor.sEmail,f.MainPhoneExtension=b.oContractor.sPhoneExtension,f.SecondaryPhoneExtension=b.oContractor.sSecondaryPhoneExtension,f.DescriptionTags=i.tagsArrayToTagsString(b.oContractor.aTags),f.BillingAddress={},f.BillingAddress.BillingStreet=b.oContractor.sBillingStreet,f.BillingAddress.BillingCity=b.oContractor.sBillingCity,f.BillingAddress.BillingPostalCode=b.oContractor.sBillingPostalCode,f.ShippingAddress={},f.ShippingAddress.ShippingStreet=b.oContractor.sShippingStreet,f.ShippingAddress.ShippingCity=b.oContractor.sShippingCity,f.ShippingAddress.ShippingPostalCode=b.oContractor.sShippingPostalCode;for(var k=0;k<b.aBillingCountries.length;k++)if(b.aBillingCountries[k].ticked){f.BillingAddress.BillingCountry=b.aBillingCountries[k].CountryCode;break}for(var k=0;k<b.aBillingProvinces.length;k++)if(b.aBillingProvinces[k].ticked){f.BillingAddress.BillingProvince=b.aBillingProvinces[k].ProvinceCode;break}for(var k=0;k<b.aShippingCountries.length;k++)if(b.aShippingCountries[k].ticked){f.ShippingAddress.ShippingCountry=b.aShippingCountries[k].CountryCode;break}for(var k=0;k<b.aShippingProvinces.length;k++)if(b.aShippingProvinces[k].ticked){f.ShippingAddress.ShippingProvince=b.aShippingProvinces[k].ProvinceCode;break}switch(f.LastModifiedAt=b.oContractor._lastModifiedAt,g=D(),b.sMode){case"edit":e.updateAccount({bShowSpinner:!0,sKey:f.Guid,oData:f,aLinks:g,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:j});break;case"create":f.AccountTypeGuid=b.sAccountTypeGuid,e.createAccount({bShowSpinner:!0,oData:f,aLinks:g,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:h})}}},b.onSaveAndNew=function(){b.onSave(!0)};var E=function(){b.onSave(!1,r)},F=function(){q=!1,c.go(r.toState,r.toParams)};b.$on("$stateChangeStart",function(a,b,c){q&&(a.preventDefault(),r={toState:b,toParams:c},d.showConfirmationPopup({sHeader:f.instant("global_changesSaveConfirmationHeader"),sContent:f.instant("global_changesSaveConfirmationContent"),sOk:f.instant("global_yes"),sCancel:f.instant("global_no"),onOk:E,onCancel:F,event:a}))}),b.$on("$destroy",function(){a.aAccountPhasesGuids=[];for(var c=0;c<b.aSelectedPhases.length;c++)a.aAccountPhasesGuids.push(b.aSelectedPhases[c].Guid)})}]),viewControllers.controller("contractorDetailsWrapperView",["$scope","$rootScope","$state","$stateParams","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i){a.bDisplayContactsList=!1,a.$on("$destroy",function(){i.getPreviousStateName()!==b.sCurrentStateName&&i.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:angular.copy(b.oStateParams)})})}]),viewControllers.controller("contractorsListView",["$scope","$rootScope","$state","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider","$mdSidenav","$window","$filter","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l){h.removeHistory();var m=g.oUserProfile.sCurrentRole;a.bDisplayAddButton=l.getRolesSettingsForEntityAndOperation({sRole:m,sEntityName:"oContractor",sOperation:"bCreate"}),a.bDisplayEditButtons=l.getRolesSettingsForEntityAndOperation({sRole:m,sEntityName:"oContractor",sOperation:"bUpdate"}),b.sCurrentStateName=c.current.name,b.oStateParams={};var n={aData:[]},o=g.getTableStatusFromCache({sTableName:"contractorsList",sStateName:b.sCurrentStateName}),p={sContractorName:"asc"};o&&!angular.equals(o.oSorting,{})&&(p=angular.copy(o.oSorting));var q={};o&&!angular.equals(o.oFilter,{})&&(q=angular.copy(o.oFilter));var r=[];o&&!angular.equals(o.aGroups,[])&&(r=angular.copy(o.aGroups)),a.tableParams=d.createNgTable({oInitialDataArrayWrapper:n,sDisplayedDataArrayName:"aDisplayedContractors",oInitialSorting:p,oInitialFilter:q,aInitialGroupsSettings:r,sGroupBy:"sProjectPhase",sGroupsSortingAttribue:"_sortingSequence"});var s=function(b){for(var c="",d="",f=!1,h=0;h<b.length;h++)if(b[h].PhaseDetails.results.length){for(var i=0;i<b[h].PhaseDetails.results.length;i++)b[h].PhaseDetails.results[i]._sortingSequence=b[h].PhaseDetails.results[i].GeneralAttributes.SortingSequence;b[h].PhaseDetails.results=k("orderBy")(b[h].PhaseDetails.results,["_sortingSequence"]);for(var i=0;i<b[h].PhaseDetails.results.length;i++){f=!1;for(var j=0;j<g.oUserProfile.aGloballySelectedPhasesGuids.length;j++)if(b[h].PhaseDetails.results[i].Guid===g.oUserProfile.aGloballySelectedPhasesGuids[j]){f=!0;break}f&&(c="en"===e.use()?b[h].PhaseDetails.results[i].ProjectDetails.NameEN:b[h].PhaseDetails.results[i].ProjectDetails.NameFR,c||(c=b[h].PhaseDetails.results[i].ProjectDetails.NameEN),d="en"===e.use()?b[h].PhaseDetails.results[i].NameEN:b[h].PhaseDetails.results[i].NameFR,d||(d=b[h].PhaseDetails.results[i].NameEN),n.aData.push({sContractorName:b[h].Name,sPhone:b[h].MainPhone,sEmail:b[h].Email,_guid:b[h].Guid,sTags:b[h].DescriptionTags,sProjectPhase:c+" - "+d,_sortingSequence:b[h].PhaseDetails.results[i]._sortingSequence}))}}else n.aData.push({sContractorName:b[h].Name,sPhone:b[h].MainPhone,sEmail:b[h].Email,_guid:b[h].Guid,sTags:b[h].DescriptionTags,sProjectPhase:"Not Assigned",_sortingSequence:-1});a.tableParams.reload()},t=function(){n.aData=[],f.getContractorsWithPhases({bShowSpinner:!0,onSuccess:s})};t(),a.onDisplay=function(a){c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"display",sContractorGuid:a._guid})
},a.onEdit=function(a){c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"edit",sContractorGuid:a._guid})},a.onAddNew=function(){c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"create",sContractorGuid:""})},a.onGenerateReport=function(){f.generateReport({})},a.$on("globalUserPhasesHaveBeenChanged",function(){t()}),a.$on("accountsShouldBeRefreshed",function(){t()}),a.$on("$destroy",function(){h.getPreviousStateName()!==b.sCurrentStateName&&(h.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:b.oStateParams}),g.putTableStatusToCache({sTableName:"contractorsList",sStateName:b.sCurrentStateName,aGroups:a.tableParams.settings().$scope.$groups,oFilter:a.tableParams.$params.filter,oSorting:a.tableParams.$params.sorting}))})}]),viewControllers.controller("contactDetailsView",["$scope","$rootScope","$state","servicesProvider","apiProvider","$translate","$stateParams","cacheProvider","utilsProvider","$filter","dataProvider","CONSTANTS","historyProvider","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.sAccountGuid,p=g.sContactGuid;a.oForms={},a.bShowParentAccountAndContactType=!0,a.bShowDescriptionTags=!0,a.bIsChangePhasesAssignmentAllowed=!0,b.sCurrentStateName=c.current.name,b.oStateParams=angular.copy(g);var q=h.oUserProfile.sCurrentRole;a.bDisplayEditButton=n.getRolesSettingsForEntityAndOperation({sRole:q,sEntityName:"oContact",sOperation:"bUpdate"}),a.bDisplayDeleteButton=n.getRolesSettingsForEntityAndOperation({sRole:q,sEntityName:"oContact",sOperation:"bDelete"}),"app.profileSettings.contactDetails"===b.sCurrentStateName&&(a.bDisplayDeleteButton=!1,a.bShowParentAccountAndContactType=!1,a.bShowDescriptionTags=!1,a.bIsChangePhasesAssignmentAllowed=!1),a.bShowBackButton=m.aHistoryStates.length>0?!0:!1;var r=!1,s={};a.sMode=g.sMode,a.oContact={_aPhases:[]};var t={aData:[{_accountGuid:o}]};a.aContactTypes=[];var u=[];a.aBillingCountries=[],a.aBillingProvinces=[],a.aShippingCountries=[],a.aShippingProvinces=[];var v=function(b){a.aUserProjectsPhasesForMultiselect=d.constructUserProjectsPhasesForMultiSelect({aSelectedPhases:b})},w=function(b){var c=[];a.oContact._guid=b.Guid,a.oContact._accountGuid=b.AccountGuid,a.oContact._lastModifiedAt=b.LastModifiedAt,a.oContact.sFirstName=b.FirstName,a.oContact.sLastName=b.LastName,a.oContact.sEmail=b.Email,a.oContact.sHomePhone=b.HomePhone,a.oContact.sHomePhoneExtension=b.HomePhoneExtension,a.oContact.sWorkPhone=b.WorkPhone,a.oContact.sWorkPhoneExtension=b.WorkPhoneExtension,a.oContact.sMobilePhone=b.MobilePhone,a.oContact.sFax=b.Fax,a.oContact.sTitle=b.Title,a.oContact.aTags=i.tagsStringToTagsArray(b.DescriptionTags),a.oContact._contactTypeGuid=b.ContactTypeGuid,b.BillingAddress&&(a.oContact.sBillingStreet=b.BillingAddress.BillingStreet,a.oContact.sBillingCity=b.BillingAddress.BillingCity,a.oContact.sBillingPostalCode=b.BillingAddress.BillingPostalCode,a.oContact._billingCountryCode=b.BillingAddress.BillingCountry,a.oContact._billingProvinceCode=b.BillingAddress.BillingProvince),b.ShippingAddress&&(a.oContact.sShippingStreet=b.ShippingAddress.ShippingStreet,a.oContact.sShippingCity=b.ShippingAddress.ShippingCity,a.oContact.sShippingPostalCode=b.ShippingAddress.ShippingPostalCode,a.oContact._shippingCountryCode=b.ShippingAddress.ShippingCountry,a.oContact._shippingProvinceCode=b.ShippingAddress.ShippingProvince),b.AccountDetails&&(a.oContact._sAccountName=b.AccountDetails.Name),b.ContactTypeDetails&&(a.oContact._sContactType="en"===f.use()?b.ContactTypeDetails.NameEN:b.ContactTypeDetails.NameFR,a.oContact._sContactType||(a.oContact._sContactType=b.ContactTypeDetails.NameEN)),a.oContact.sCreatedAt=i.dBDateToSting(b.CreatedAt),a.oContact.sLastModifiedAt=i.dBDateToSting(b.LastModifiedAt),a.oContact._aPhases=angular.copy(b.PhaseDetails.results);for(var d=0;d<a.oContact._aPhases.length;d++)c.push(a.oContact._aPhases[d].Guid);v(c),t.aData[0]=angular.copy(a.oContact)},x="";x="app.contactsList"===m.getPreviousStateName()?"CompanyName eq '"+h.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false":"CompanyName eq '"+h.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false and AccountGuid eq '"+o+"'",x+="UserDetails,ContactTypeDetails,AccountDetails/AccountTypeDetails,PhaseDetails/ProjectDetails";var y=h.getEntityDetails({sCacheProviderAttribute:"oContactEntity",sRequestSettings:x,sKeyName:"Guid",sKeyValue:p}),z=function(b){var c=b.sParentKey,e="",f="";"billingAddress"===b.sProvincesFor?(e="aBillingProvinces",f="aBillingCountries"):(e="aShippingProvinces",f="aShippingCountries");for(var g=0;g<a[f].length;g++)if(a[f][g].ticked){for(var h=0;h<u.length;h++)if(a[f][g].CountryCode===u[h].CountryCode){d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:u[h].ProvinceDetails.results},oParentArrayWrapper:t,sNameEN:"Name",sNameFR:"Name",sDependentKey:"ProvinceCode",sParentKey:c,sTargetArrayNameInParent:e}),t.aData[0]&&(a[e]=angular.copy(t.aData[0][e]));break}break}},A=function(b){u=angular.copy(b),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},oParentArrayWrapper:t,sNameEN:"Name",sNameFR:"Name",sDependentKey:"CountryCode",sParentKey:"_billingCountryCode",sTargetArrayNameInParent:"aBillingCountries"}),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},oParentArrayWrapper:t,sNameEN:"Name",sNameFR:"Name",sDependentKey:"CountryCode",sParentKey:"_shippingCountryCode",sTargetArrayNameInParent:"aShippingCountries"}),t.aData[0]&&(a.aBillingCountries=angular.copy(t.aData[0].aBillingCountries),a.aShippingCountries=angular.copy(t.aData[0].aShippingCountries)),a.oContact._billingCountryCode&&z({sParentKey:"_billingProvinceCode",sProvincesFor:"billingAddress"}),a.oContact._shippingCountryCode&&z({sParentKey:"_shippingProvinceCode",sProvincesFor:"shippingAddress"})},B=function(b){for(var c=0;c<b.length;c++)b[c]._sortingSequence=b[c].GeneralAttributes.SortingSequence;b=j("orderBy")(b,["_sortingSequence"]),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},oParentArrayWrapper:t,sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",sParentKey:"_contactTypeGuid",sTargetArrayNameInParent:"aContactTypes"}),t.aData[0]&&(a.aContactTypes=angular.copy(t.aData[0].aContactTypes))},C=function(a){w(a),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:A}),e.getContactTypes({bShowSpinner:!1,onSuccess:B}),e.getAccountTypesWithAccounts({bShowSpinner:!1,onSuccess:E})},D=function(){e.getContact({sKey:p,bShowSpinner:!0,onSuccess:C})},E=function(b){for(var c=0;c<b.length;c++)b[c]._sortingSequence=b[c].GeneralAttributes.SortingSequence,b[c].AccountDetails.results=j("orderBy")(b[c].AccountDetails.results,["Name"]);b=j("orderBy")(b,["_sortingSequence"]),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},sSecondLevelAttribute:"AccountDetails",sSecondLevelNameEN:"Name",sSecondLevelNameFR:"Name",oParentArrayWrapper:t,sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",sParentKey:"_accountGuid",sTargetArrayNameInParent:"aAccounts"}),t.aData[0]&&(a.aAccounts=angular.copy(t.aData[0].aAccounts))};if("create"!==a.sMode)angular.equals(y,{})?D():(w(y),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:A}),e.getContactTypes({bShowSpinner:!1,onSuccess:B}),e.getAccountTypesWithAccounts({bShowSpinner:!1,onSuccess:E}));else{var F=[];("app.contractorDetailsWrapper.contractorDetails"===m.getPreviousStateName()||"app.clientDetailsWrapper.clientDetails"===m.getPreviousStateName())&&(F=angular.copy(b.aAccountPhasesGuids)),v(F),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:A}),e.getContactTypes({bShowSpinner:!1,onSuccess:B}),e.getAccountTypesWithAccounts({bShowSpinner:!1,onSuccess:E})}a.onEdit=function(){"app.contactDetailsWrapper.contactDetails"===b.sCurrentStateName?c.go("app.contactDetailsWrapper.contactDetails",{sMode:"edit",sAccountGuid:o,sContactGuid:a.oContact._guid}):c.go("app.profileSettings.contactDetails",{sMode:"edit",sAccountGuid:o,sContactGuid:a.oContact._guid})};var G=function(){var b={GeneralAttributes:{IsDeleted:!0}},d=function(){m.navigateBack({oState:c})};b.Guid=a.oContact._guid,b.LastModifiedAt=a.oContact._lastModifiedAt,e.updateContact({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})};a.onDelete=function(a){d.showConfirmationPopup({sHeader:f.instant("contactDetails_deletionConfirmationHeader"),sContent:f.instant("contactDetails_deletionConfirmationContent"),sOk:f.instant("global_ok"),sCancel:f.instant("global_cancel"),onOk:G,event:a})};var H=function(){for(var b=[],c=[],d="",e=0;e<a.aUserProjectsPhasesForMultiselect.length;e++)a.aUserProjectsPhasesForMultiselect[e].ticked&&(d="Phases('"+a.aUserProjectsPhasesForMultiselect[e].Guid+"')",c.push(d));return c.length&&b.push({sRelationName:"PhaseDetails",bKeepCompanyDependentLinks:!0,aUri:c}),b};a.onParentAccountModified=function(){a.onDataModified(),a.oForms.contactDetailsForm.selectedParentAccount.$setDirty()},a.onCloseCheckSelectedPhasesLength=function(){0==a.aSelectedPhases.length&&a.onSelectedPhasesModified()},a.onSelectedPhasesModified=function(){a.onDataModified(),a.oForms.contactDetailsForm.selectedPhases.$setDirty()},a.onDataModified=function(){r=!0},a.onBillingCountryChanged=function(){a.onDataModified(),z({sParentKey:"",sProvincesFor:"billingAddress"})},a.onShippingCountryChanged=function(){a.onDataModified(),z({sParentKey:"",sProvincesFor:"shippingAddress"})},a.onSave=function(d,f){a.oForms.contactDetailsForm.selectedPhases&&a.oForms.contactDetailsForm.selectedPhases.$setDirty(),a.oForms.contactDetailsForm.selectedParentAccount&&a.oForms.contactDetailsForm.selectedParentAccount.$setDirty(),a.oForms.contactDetailsForm.firstName&&a.oForms.contactDetailsForm.firstName.$setDirty(),a.oForms.contactDetailsForm.lastName&&a.oForms.contactDetailsForm.lastName.$setDirty(),aLinks=H();var g={GeneralAttributes:{}};g.Guid=a.oContact._guid;for(var h=0;h<a.aAccounts.length;h++)if(a.aAccounts[h].ticked&&void 0===a.aAccounts[h].multiSelectGroup){g.AccountGuid=a.aAccounts[h].Guid;break}if(a.oForms.contactDetailsForm.$valid){for(var j=function(e){return r=!1,f?void c.go(f.toState,f.toParams):void(d?(a.oContact.sFirstName="",a.oContact.sLastName="",a.oContact.sEmail="",a.oContact.sHomePhone="",a.oContact.sHomePhoneExtension="",a.oContact.sWorkPhone="",a.oContact.sWorkPhoneExtension="",a.oContact.sMobilePhone="",a.oContact.sFax="",a.oContact.sTitle="",a.oContact.aTags=[],a.oContact.sBillingStreet="",a.oContact.sBillingCity="",a.oContact.sBillingPostalCode="",a.oContact.sShippingStreet="",a.oContact.sShippingCity="",a.oContact.sShippingPostalCode="",a.oForms.contactDetailsForm.lastName.$setPristine(),a.oForms.contactDetailsForm.firstName.$setPristine(),g.BillingAddress={},g.ShippingAddress={}):("app.contactDetailsWrapper.contactDetails"===b.sCurrentStateName?c.go("app.contactDetailsWrapper.contactDetails",{sMode:"display",sAccountGuid:o,sContactGuid:e.Guid}):c.go("app.profileSettings.contactDetails",{sMode:"display",sAccountGuid:o,sContactGuid:e.Guid}),a.oContact._lastModifiedAt=e.LastModifiedAt,a.oContact.sLastModifiedAt=i.dBDateToSting(e.LastModifiedAt),a.oContact.sCreatedAt=i.dBDateToSting(e.CreatedAt),a.oContact._guid=e.Guid))},k=function(d){return r=!1,f?void c.go(f.toState,f.toParams):(a.oContact._lastModifiedAt=d.LastModifiedAt,a.oContact.sLastModifiedAt=i.dBDateToSting(d.LastModifiedAt),void("app.contactDetailsWrapper.contactDetails"===b.sCurrentStateName?c.go("app.contactDetailsWrapper.contactDetails",{sMode:"display",sAccountGuid:o,sContactGuid:d.Guid}):c.go("app.profileSettings.contactDetails",{sMode:"display",sAccountGuid:o,sContactGuid:d.Guid})))},h=0;h<a.aContactTypes.length;h++)if(a.aContactTypes[h].ticked){g.ContactTypeGuid=a.aContactTypes[h].Guid;break}g.FirstName=a.oContact.sFirstName,g.LastName=a.oContact.sLastName,g.HomePhone=a.oContact.sHomePhone?a.oContact.sHomePhone.replace(/\D/g,""):"",g.WorkPhone=a.oContact.sWorkPhone?a.oContact.sWorkPhone.replace(/\D/g,""):"",g.MobilePhone=a.oContact.sMobilePhone?a.oContact.sMobilePhone.replace(/\D/g,""):"",g.Email=a.oContact.sEmail,g.Fax=a.oContact.sFax,g.Title=a.oContact.sTitle,g.HomePhoneExtension=a.oContact.sHomePhoneExtension,g.WorkPhoneExtension=a.oContact.sWorkPhoneExtension,g.DescriptionTags=i.tagsArrayToTagsString(a.oContact.aTags),g.BillingAddress={},g.BillingAddress.BillingStreet=a.oContact.sBillingStreet,g.BillingAddress.BillingCity=a.oContact.sBillingCity,g.BillingAddress.BillingPostalCode=a.oContact.sBillingPostalCode,g.ShippingAddress={},g.ShippingAddress.ShippingStreet=a.oContact.sShippingStreet,g.ShippingAddress.ShippingCity=a.oContact.sShippingCity,g.ShippingAddress.ShippingPostalCode=a.oContact.sShippingPostalCode;for(var h=0;h<a.aBillingCountries.length;h++)if(a.aBillingCountries[h].ticked){g.BillingAddress.BillingCountry=a.aBillingCountries[h].CountryCode;break}for(var h=0;h<a.aBillingProvinces.length;h++)if(a.aBillingProvinces[h].ticked){g.BillingAddress.BillingProvince=a.aBillingProvinces[h].ProvinceCode;break}for(var h=0;h<a.aShippingCountries.length;h++)if(a.aShippingCountries[h].ticked){g.ShippingAddress.ShippingCountry=a.aShippingCountries[h].CountryCode;break}for(var h=0;h<a.aShippingProvinces.length;h++)if(a.aShippingProvinces[h].ticked){g.ShippingAddress.ShippingProvince=a.aShippingProvinces[h].ProvinceCode;break}switch(g.LastModifiedAt=a.oContact._lastModifiedAt,a.sMode){case"edit":e.updateContact({bShowSpinner:!0,sKey:g.Guid,aLinks:aLinks,oData:g,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:k});break;case"create":e.createContact({bShowSpinner:!0,aLinks:aLinks,oData:g,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:j})}}},a.onBack=function(){m.navigateBack({oState:c})},a.onNavigateToAccountDetails=function(){for(var b="",d=0;d<a.aAccounts.length;d++)if(a.aAccounts[d].ticked&&void 0===a.aAccounts[d].multiSelectGroup){b=a.aAccounts[d].Guid;break}c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"display",sContractorGuid:b})},a.onSaveAndNew=function(){a.onSave(!0)};var I=function(){a.onSave(!1,s)},J=function(){r=!1,c.go(s.toState,s.toParams)};a.$on("$stateChangeStart",function(a,b,c){r&&(a.preventDefault(),s={toState:b,toParams:c},d.showConfirmationPopup({sHeader:f.instant("global_changesSaveConfirmationHeader"),sContent:f.instant("global_changesSaveConfirmationContent"),sOk:f.instant("global_yes"),sCancel:f.instant("global_no"),onOk:I,onCancel:J,event:a}))})}]),viewControllers.controller("contactDetailsWrapperView",["$scope","$rootScope","$state","$stateParams","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i){a.$on("$destroy",function(){i.getPreviousStateName()!==b.sCurrentStateName&&i.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:angular.copy(b.oStateParams)})})}]),viewControllers.controller("contactsListView",["$scope","$rootScope","$state","$stateParams","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider","$filter","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k){var l=h.oUserProfile.sCurrentRole;a.bDisplayAddButton=k.getRolesSettingsForEntityAndOperation({sRole:l,sEntityName:"oContact",sOperation:"bCreate"}),a.bDisplayEditButtons=k.getRolesSettingsForEntityAndOperation({sRole:l,sEntityName:"oContact",sOperation:"bUpdate"}),a.bDisplayAccountColumn="app.contactsList"===c.current.name?!0:!1,b.sCurrentStateName=c.current.name,b.oStateParams=angular.copy(d);var m="";d.sContractorGuid&&(m=d.sContractorGuid),d.sClientGuid&&(m=d.sClientGuid);var n={aData:[]},o=h.getTableStatusFromCache({sTableName:"contactsList",sStateName:b.sCurrentStateName}),p={sName:"asc"};o&&!angular.equals(o.oSorting,{})&&(p=angular.copy(o.oSorting));var q={};o&&!angular.equals(o.oFilter,{})&&(q=angular.copy(o.oFilter));var r=[];o&&!angular.equals(o.aGroups,[])&&(r=angular.copy(o.aGroups)),a.tableParams=e.createNgTable({oInitialDataArrayWrapper:n,sDisplayedDataArrayName:"aDisplayedContacts",oInitialSorting:p,oInitialFilter:q,aInitialGroupsSettings:r,sGroupBy:"sProjectPhase",sGroupsSortingAttribue:"_sortingSequence"});var s=function(b){for(var c="",d="",e="",g=!1,i=0;i<b.length;i++){for(var k=0;k<b[i].PhaseDetails.results.length;k++)b[i].PhaseDetails.results[k]._sortingSequence=b[i].PhaseDetails.results[k].GeneralAttributes.SortingSequence;if(b[i].PhaseDetails.results=j("orderBy")(b[i].PhaseDetails.results,["_sortingSequence"]),c="",b[i].FirstName&&(c=b[i].FirstName),b[i].LastName&&(b[i].FirstName&&(c+=" "),c+=b[i].LastName),b[i].PhaseDetails.results.length)for(var k=0;k<b[i].PhaseDetails.results.length;k++){g=!1;for(var l=0;l<h.oUserProfile.aGloballySelectedPhasesGuids.length;l++)if(b[i].PhaseDetails.results[k].Guid===h.oUserProfile.aGloballySelectedPhasesGuids[l]){g=!0;break}g&&(d="en"===f.use()?b[i].PhaseDetails.results[k].ProjectDetails.NameEN:b[i].PhaseDetails.results[k].ProjectDetails.NameFR,d||(d=b[i].PhaseDetails.results[k].ProjectDetails.NameEN),e="en"===f.use()?b[i].PhaseDetails.results[k].NameEN:b[i].PhaseDetails.results[k].NameFR,e||(e=b[i].PhaseDetails.results[k].NameEN),n.aData.push({sName:c,sTitle:b[i].Title,sPhone:b[i].MobilePhone,sEmail:b[i].Email,_guid:b[i].Guid,sProjectPhase:d+" - "+e,_accountGuid:b[i].AccountGuid,_accountTypeName:b[i].AccountDetails.AccountTypeDetails.NameEN,sAccountName:b[i].AccountDetails.Name,_sortingSequence:b[i].PhaseDetails.results[k]._sortingSequence}))}else n.aData.push({sName:c,sTitle:b[i].Title,sPhone:b[i].MobilePhone,sEmail:b[i].Email,_guid:b[i].Guid,sProjectPhase:"Not Assigned",_accountGuid:b[i].AccountGuid,_accountTypeName:b[i].AccountDetails.AccountTypeDetails.NameEN,sAccountName:b[i].AccountDetails.Name,_sortingSequence:-1})}a.tableParams.reload()},t=function(){n.aData=[],m?g.getContactsForAccount({bShowSpinner:!0,onSuccess:s,sAccountGuid:m}):g.getContacts({bShowSpinner:!0,onSuccess:s})};t(),a.onDisplay=function(a){m||(m=a._accountGuid),c.go("app.contactDetailsWrapper.contactDetails",{sMode:"display",sAccountGuid:m,sContactGuid:a._guid})},a.onEdit=function(a){m||(m=a._accountGuid),c.go("app.contactDetailsWrapper.contactDetails",{sMode:"edit",sAccountGuid:m,sContactGuid:a._guid})},a.onAddNew=function(){c.go("app.contactDetailsWrapper.contactDetails",{sMode:"create",sAccountGuid:m,sContactGuid:""})},a.onNavigateToAccountDetails=function(a){var b=a._accountGuid,d=a._accountTypeName;switch(d){case"Contractor":c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"display",sContractorGuid:b});break;case"Client":c.go("app.clientDetailsWrapper.clientDetails",{sMode:"display",sClientGuid:b})}},a.$on("globalUserPhasesHaveBeenChanged",function(){t()}),a.$on("contactsShouldBeRefreshed",function(){t()}),a.$on("$destroy",function(){if("app.contractorDetailsWrapper.contractorDetails"!==b.sCurrentStateName&&"app.clientDetailsWrapper.clientDetails"!==b.sCurrentStateName){if(i.getPreviousStateName()===b.sCurrentStateName)return;i.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:b.oStateParams})}h.putTableStatusToCache({sTableName:"contactsList",sStateName:b.sCurrentStateName,aGroups:a.tableParams.settings().$scope.$groups,oFilter:a.tableParams.$params.filter,oSorting:a.tableParams.$params.sorting})})}]),viewControllers.controller("clientDetailsView",["$rootScope","$scope","$state","servicesProvider","apiProvider","$translate","$stateParams","cacheProvider","utilsProvider","$filter","dataProvider","CONSTANTS","historyProvider","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.oForms={};var o=g.sClientGuid;b.sMode=g.sMode,a.sCurrentStateName=c.current.name,a.oStateParams=angular.copy(g);var p=h.oUserProfile.sCurrentRole;b.bDisplayEditButton=n.getRolesSettingsForEntityAndOperation({sRole:p,sEntityName:"oClient",sOperation:"bUpdate"}),b.bDisplayDeleteButton=n.getRolesSettingsForEntityAndOperation({sRole:p,sEntityName:"oClient",sOperation:"bDelete"}),b.sAccountType="",b.bShowBackButton=m.aHistoryStates.length>0?!0:!1,"app.clientDetailsWrapper.clientDetails"===a.sCurrentStateName&&(("display"===b.sMode||"edit"===b.sMode)&&(b.$parent.bDisplayContactsList=!0),b.sAccountType="Client"),b.sAccountTypeGuid="";var q=!1,r={};b.oClient={_aPhases:[]};var s={aData:[{}]},t=[];b.aBillingCountries=[],b.aBillingProvinces=[],b.aShippingCountries=[],b.aShippingProvinces=[];var u=function(a){b.aUserProjectsPhasesForMultiselect=d.constructUserProjectsPhasesForMultiSelect({aSelectedPhases:a})},v=function(a){var c=[];b.oClient._guid=a.Guid,b.oClient._lastModifiedAt=a.LastModifiedAt,b.oClient.sName=a.Name,b.oClient.sPhone=a.MainPhone,b.oClient.sPhoneExtension=a.MainPhoneExtension,b.oClient.sSecondaryPhone=a.SecondaryPhone,b.oClient.sSecondaryPhoneExtension=a.SecondaryPhoneExtension,b.oClient.sWebsite=a.Website,b.oClient.sEmail=a.Email,b.oClient.sFax=a.Fax,b.oClient.aTags=i.tagsStringToTagsArray(a.DescriptionTags),a.BillingAddress&&(b.oClient.sBillingStreet=a.BillingAddress.BillingStreet,b.oClient.sBillingCity=a.BillingAddress.BillingCity,b.oClient.sBillingPostalCode=a.BillingAddress.BillingPostalCode,b.oClient._billingCountryCode=a.BillingAddress.BillingCountry,b.oClient._billingProvinceCode=a.BillingAddress.BillingProvince),a.ShippingAddress&&(b.oClient.sShippingStreet=a.ShippingAddress.ShippingStreet,b.oClient.sShippingCity=a.ShippingAddress.ShippingCity,b.oClient.sShippingPostalCode=a.ShippingAddress.ShippingPostalCode,b.oClient._shippingCountryCode=a.ShippingAddress.ShippingCountry,b.oClient._shippingProvinceCode=a.ShippingAddress.ShippingProvince),b.oClient.sCreatedAt=i.dBDateToSting(a.CreatedAt),b.oClient.sLastModifiedAt=i.dBDateToSting(a.LastModifiedAt),b.oClient._aPhases=angular.copy(a.PhaseDetails.results);for(var d=0;d<b.oClient._aPhases.length;d++)c.push(b.oClient._aPhases[d].Guid);u(c),s.aData[0]=angular.copy(b.oClient)},w=h.getEntityDetails({sCacheProviderAttribute:"oAccountEntity",sRequestSettings:"CompanyName eq '"+h.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq falsePhaseDetails/ProjectDetails,AccountTypeDetails",sKeyName:"Guid",sKeyValue:g.sClientGuid}),x=function(a){var c=a.sParentKey,e="",f="";"billingAddress"===a.sProvincesFor?(e="aBillingProvinces",f="aBillingCountries"):(e="aShippingProvinces",f="aShippingCountries");for(var g=0;g<b[f].length;g++)if(b[f][g].ticked){for(var h=0;h<t.length;h++)if(b[f][g].CountryCode===t[h].CountryCode){d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:t[h].ProvinceDetails.results},oParentArrayWrapper:s,sNameEN:"Name",sNameFR:"Name",sDependentKey:"ProvinceCode",sParentKey:c,sTargetArrayNameInParent:e}),s.aData[0]&&(b[e]=angular.copy(s.aData[0][e]));break}break}},y=function(a){t=angular.copy(a),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:s,sNameEN:"Name",sNameFR:"Name",sDependentKey:"CountryCode",sParentKey:"_billingCountryCode",sTargetArrayNameInParent:"aBillingCountries"}),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:s,sNameEN:"Name",sNameFR:"Name",sDependentKey:"CountryCode",sParentKey:"_shippingCountryCode",sTargetArrayNameInParent:"aShippingCountries"}),s.aData[0]&&(b.aBillingCountries=angular.copy(s.aData[0].aBillingCountries),b.aShippingCountries=angular.copy(s.aData[0].aShippingCountries)),b.oClient._billingCountryCode&&x({sParentKey:"_billingProvinceCode",sProvincesFor:"billingAddress"}),b.oClient._shippingCountryCode&&x({sParentKey:"_shippingProvinceCode",sProvincesFor:"shippingAddress"})},z=function(a){v(a),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:y})},A=function(){e.getAccountWithPhases({sKey:o,bShowSpinner:!0,onSuccess:z})},B=function(a){b.sAccountTypeGuid=a[0].Guid};"create"!==b.sMode?angular.equals(w,{})?A():(v(w),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:y})):(u({aSelectedPhases:[]}),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:y}),"Client"===b.sAccountType&&e.getClientAccountType({bShowSpinner:!1,onSuccess:B}),"Client"===b.sAccountType&&e.getClientAccountType({bShowSpinner:!1,onSuccess:B})),b.onEdit=function(){c.go("app.clientDetailsWrapper.clientDetails",{sMode:"edit",sClientGuid:b.oClient._guid})};var C=function(){var a={GeneralAttributes:{IsDeleted:!0}},d=function(){m.navigateBack({oState:c})};a.Guid=b.oClient._guid,a.LastModifiedAt=b.oClient._lastModifiedAt,e.updateAccount({bShowSpinner:!0,sKey:a.Guid,oData:a,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})};b.onDelete=function(a){d.showConfirmationPopup({sHeader:f.instant("clientDetails_deletionConfirmationHeader"),sContent:f.instant("clientDetails_deletionConfirmationContent"),sOk:f.instant("global_ok"),sCancel:f.instant("global_cancel"),onOk:C,event:a})};var D=function(){for(var a=[],c=[],d="",e=0;e<b.aUserProjectsPhasesForMultiselect.length;e++)b.aUserProjectsPhasesForMultiselect[e].ticked&&(d="Phases('"+b.aUserProjectsPhasesForMultiselect[e].Guid+"')",c.push(d));return c.length&&a.push({sRelationName:"PhaseDetails",bKeepCompanyDependentLinks:!0,aUri:c}),a};b.onCloseCheckSelectedPhasesLength=function(){0==b.aSelectedPhases.length&&b.onSelectedPhasesModified()},b.onSelectedPhasesModified=function(){b.onDataModified(),b.oForms.clientDetailsForm.selectedPhases.$setDirty()},b.onDataModified=function(){q=!0},b.onBillingCountryChanged=function(){b.onDataModified(),x({sParentKey:"",sProvincesFor:"billingAddress"})},b.onShippingCountryChanged=function(){b.onDataModified(),x({sParentKey:"",sProvincesFor:"shippingAddress"})},b.onBack=function(){m.navigateBack({oState:c})},b.onSave=function(a,d){if(b.oForms.clientDetailsForm.selectedPhases&&b.oForms.clientDetailsForm.selectedPhases.$setDirty(),b.oForms.clientDetailsForm.clientName&&b.oForms.clientDetailsForm.clientName.$setDirty(),b.oForms.clientDetailsForm.$valid){var f={GeneralAttributes:{}},g=[],h=function(e){return q=!1,d?void c.go(d.toState,d.toParams):void(a?(b.oClient.sName="",b.oClient.sPhone="",b.oClient.sPhoneExtension="",b.oClient.sSecondaryPhone="",b.oClient.sSecondaryPhoneExtension="",b.oClient.sWebsite="",b.oClient.sEmail="",b.oClient.sFax="",b.oClient.aTags=[],b.oClient.sBillingStreet="",b.oClient.sBillingCity="",b.oClient.sBillingPostalCode="",b.oClient.sShippingStreet="",b.oClient.sShippingCity="",b.oClient.sShippingPostalCode="",b.oForms.clientDetailsForm.clientName.$setPristine(),f.BillingAddress={},f.ShippingAddress={},b.oClient._aPhases=[]):(b.oClient._lastModifiedAt=e.LastModifiedAt,b.oClient.sLastModifiedAt=i.dBDateToSting(e.LastModifiedAt),b.oClient.sCreatedAt=i.dBDateToSting(e.CreatedAt),b.oClient._guid=e.Guid,c.go("app.clientDetailsWrapper.clientDetails",{sMode:"display",sClientGuid:e.Guid})))},j=function(a){return q=!1,b.oClient._lastModifiedAt=a.LastModifiedAt,b.oClient.sLastModifiedAt=i.dBDateToSting(a.LastModifiedAt),d?void c.go(d.toState,d.toParams):void c.go("app.clientDetailsWrapper.clientDetails",{sMode:"display",sClientGuid:a.Guid})};f.Guid=b.oClient._guid,f.Name=b.oClient.sName,f.MainPhone=b.oClient.sPhone?b.oClient.sPhone.replace(/\D/g,""):"",f.SecondaryPhone=b.oClient.sSecondaryPhone?b.oClient.sSecondaryPhone.replace(/\D/g,""):"",f.Fax=b.oClient.sFax?b.oClient.sFax.replace(/\D/g,""):"",f.Website=b.oClient.sWebsite,f.Email=b.oClient.sEmail,f.MainPhoneExtension=b.oClient.sPhoneExtension,f.SecondaryPhoneExtension=b.oClient.sSecondaryPhoneExtension,f.DescriptionTags=i.tagsArrayToTagsString(b.oClient.aTags),f.BillingAddress={},f.BillingAddress.BillingStreet=b.oClient.sBillingStreet,f.BillingAddress.BillingCity=b.oClient.sBillingCity,f.BillingAddress.BillingPostalCode=b.oClient.sBillingPostalCode,f.ShippingAddress={},f.ShippingAddress.ShippingStreet=b.oClient.sShippingStreet,f.ShippingAddress.ShippingCity=b.oClient.sShippingCity,f.ShippingAddress.ShippingPostalCode=b.oClient.sShippingPostalCode;for(var k=0;k<b.aBillingCountries.length;k++)if(b.aBillingCountries[k].ticked){f.BillingAddress.BillingCountry=b.aBillingCountries[k].CountryCode;break}for(var k=0;k<b.aBillingProvinces.length;k++)if(b.aBillingProvinces[k].ticked){f.BillingAddress.BillingProvince=b.aBillingProvinces[k].ProvinceCode;break}for(var k=0;k<b.aShippingCountries.length;k++)if(b.aShippingCountries[k].ticked){f.ShippingAddress.ShippingCountry=b.aShippingCountries[k].CountryCode;break}for(var k=0;k<b.aShippingProvinces.length;k++)if(b.aShippingProvinces[k].ticked){f.ShippingAddress.ShippingProvince=b.aShippingProvinces[k].ProvinceCode;break}switch(f.LastModifiedAt=b.oClient._lastModifiedAt,g=D(),b.sMode){case"edit":e.updateAccount({bShowSpinner:!0,sKey:f.Guid,oData:f,aLinks:g,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:j});break;case"create":f.AccountTypeGuid=b.sAccountTypeGuid,e.createAccount({bShowSpinner:!0,oData:f,aLinks:g,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:h})}}},b.onSaveAndNew=function(){b.onSave(!0)};var E=function(){b.onSave(!1,r)},F=function(){q=!1,c.go(r.toState,r.toParams)};b.$on("$stateChangeStart",function(a,b,c){q&&(a.preventDefault(),r={toState:b,toParams:c},d.showConfirmationPopup({sHeader:f.instant("global_changesSaveConfirmationHeader"),sContent:f.instant("global_changesSaveConfirmationContent"),sOk:f.instant("global_yes"),sCancel:f.instant("global_no"),onOk:E,onCancel:F,event:a}))}),b.$on("$destroy",function(){a.aAccountPhasesGuids=[];for(var c=0;c<b.aSelectedPhases.length;c++)a.aAccountPhasesGuids.push(b.aSelectedPhases[c].Guid)})}]),viewControllers.controller("clientDetailsWrapperView",["$scope","$rootScope","$state","$stateParams","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i){a.bDisplayContactsList=!1,a.$on("$destroy",function(){i.getPreviousStateName()!==b.sCurrentStateName&&i.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:angular.copy(b.oStateParams)})})}]),viewControllers.controller("clientsListView",["$scope","$rootScope","$state","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider","$mdSidenav","$window","$filter","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l){h.removeHistory();var m=g.oUserProfile.sCurrentRole;a.bDisplayAddButton=l.getRolesSettingsForEntityAndOperation({sRole:m,sEntityName:"oClient",sOperation:"bCreate"}),a.bDisplayEditButtons=l.getRolesSettingsForEntityAndOperation({sRole:m,sEntityName:"oClient",sOperation:"bUpdate"}),b.sCurrentStateName=c.current.name,b.oStateParams={};var n={aData:[]},o=g.getTableStatusFromCache({sTableName:"clientsList",sStateName:b.sCurrentStateName}),p={sClientName:"asc"};o&&!angular.equals(o.oSorting,{})&&(p=angular.copy(o.oSorting));var q={};o&&!angular.equals(o.oFilter,{})&&(q=angular.copy(o.oFilter));var r=[];o&&!angular.equals(o.aGroups,[])&&(r=angular.copy(o.aGroups)),a.tableParams=d.createNgTable({oInitialDataArrayWrapper:n,sDisplayedDataArrayName:"aDisplayedClients",oInitialSorting:p,oInitialFilter:q,aInitialGroupsSettings:r,sGroupBy:"sProjectPhase",sGroupsSortingAttribue:"_sortingSequence"});var s=function(b){for(var c="",d="",f=!1,h=0;h<b.length;h++)if(b[h].PhaseDetails.results.length){for(var i=0;i<b[h].PhaseDetails.results.length;i++)b[h].PhaseDetails.results[i]._sortingSequence=b[h].PhaseDetails.results[i].GeneralAttributes.SortingSequence;b[h].PhaseDetails.results=k("orderBy")(b[h].PhaseDetails.results,["_sortingSequence"]);for(var i=0;i<b[h].PhaseDetails.results.length;i++){f=!1;for(var j=0;j<g.oUserProfile.aGloballySelectedPhasesGuids.length;j++)if(b[h].PhaseDetails.results[i].Guid===g.oUserProfile.aGloballySelectedPhasesGuids[j]){f=!0;break}f&&(c="en"===e.use()?b[h].PhaseDetails.results[i].ProjectDetails.NameEN:b[h].PhaseDetails.results[i].ProjectDetails.NameFR,c||(c=b[h].PhaseDetails.results[i].ProjectDetails.NameEN),d="en"===e.use()?b[h].PhaseDetails.results[i].NameEN:b[h].PhaseDetails.results[i].NameFR,d||(d=b[h].PhaseDetails.results[i].NameEN),n.aData.push({sClientName:b[h].Name,sPhone:b[h].MainPhone,sEmail:b[h].Email,_guid:b[h].Guid,sTags:b[h].DescriptionTags,sProjectPhase:c+" - "+d,_sortingSequence:b[h].PhaseDetails.results[i]._sortingSequence}))}}else n.aData.push({sClientName:b[h].Name,sPhone:b[h].MainPhone,sEmail:b[h].Email,_guid:b[h].Guid,sTags:b[h].DescriptionTags,sProjectPhase:"Not Assigned",_sortingSequence:-1});
a.tableParams.reload()},t=function(){n.aData=[],f.getClientsWithPhases({bShowSpinner:!0,onSuccess:s})};t(),a.onDisplay=function(a){c.go("app.clientDetailsWrapper.clientDetails",{sMode:"display",sClientGuid:a._guid})},a.onEdit=function(a){c.go("app.clientDetailsWrapper.clientDetails",{sMode:"edit",sClientGuid:a._guid})},a.onAddNew=function(){c.go("app.clientDetailsWrapper.clientDetails",{sMode:"create",sClientGuid:""})},a.$on("globalUserPhasesHaveBeenChanged",function(){t()}),a.$on("accountsShouldBeRefreshed",function(){t()}),a.$on("$destroy",function(){h.getPreviousStateName()!==b.sCurrentStateName&&(h.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:b.oStateParams}),g.putTableStatusToCache({sTableName:"clientsList",sStateName:b.sCurrentStateName,aGroups:a.tableParams.settings().$scope.$groups,oFilter:a.tableParams.$params.filter,oSorting:a.tableParams.$params.sorting}))})}]),viewControllers.controller("changePasswordView",["$scope","$rootScope","$state","$translate","utilsProvider","dataProvider","cacheProvider","$filter","rolesSettings","servicesProvider","apiProvider",function(a,b,c,d,e,f,g,h,i,j,k){a.oForms={};var l=!1,m={};a.oUser={},b.sCurrentStateName=c.current.name,b.oStateParams={},a.onSave=function(){a.oForms.profileSettingsPasswordResetForm.password.$setDirty(),a.oForms.profileSettingsPasswordResetForm.passwordConfirmation.$setDirty();var b=new Hashes.SHA512,c={GeneralAttributes:{}};if(!a.oUser.sPassword||!a.oUser.sPasswordConfirmation)return void e.displayMessage({sText:d.instant("global_emptyFields"),sType:"error"});if(a.oUser.sPassword!==a.oUser.sPasswordConfirmation)return void e.displayMessage({sText:d.instant("global_passwordsDontMatch"),sType:"error"});var f=function(b){l=!1,a.oUser.sPassword="",a.oUser.sPasswordConfirmation="",g.oUserProfile.sLastModifiedAt=b.LastModifiedAt};c.UserName=g.oUserProfile.sUserName,c.LastModifiedAt=g.oUserProfile.sLastModifiedAt,c.Password=k.hashPassword(b.hex(a.oUser.sPassword)),k.updateUser({bShowSpinner:!0,sKey:c.UserName,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:f})},a.onDataModified=function(){l=!0};var n=function(){a.onSave(m)},o=function(){l=!1,c.go(m.toState,m.toParams)};a.$on("$stateChangeStart",function(a,b,c){l&&(a.preventDefault(),m={toState:b,toParams:c},j.showConfirmationPopup({sHeader:d.instant("global_changesSaveConfirmationHeader"),sContent:d.instant("global_changesSaveConfirmationContent"),sOk:d.instant("global_yes"),sCancel:d.instant("global_no"),onOk:n,onCancel:o,event:a}))})}]),viewControllers.controller("profileDetailsView",["$scope","$rootScope","$state","$translate","utilsProvider","dataProvider","cacheProvider","$filter","rolesSettings","servicesProvider","apiProvider","$cookieStore","$window","$upload","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.oUserProfile.sUserName,p=g.oUserProfile.sCurrentCompany,q=!1,r={};a.oUser={},a.sMode="display",b.sCurrentStateName=c.current.name,b.oStateParams={};var s={aData:[{}]};a.aLanguages=[];var t=function(){var b=[];b.push({languageCode:"en",descriptionEN:"English",descriptionFR:"Anglais"}),b.push({languageCode:"fr",descriptionEN:"French",descriptionFR:"Français"}),j.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},oParentArrayWrapper:s,sNameEN:"descriptionEN",sNameFR:"descriptionFR",sDependentKey:"languageCode",sParentKey:"_sLanguage",sTargetArrayNameInParent:"aLanguages"}),s.aData[0]&&(a.aLanguages=angular.copy(s.aData[0].aLanguages))},u=function(b){var c="",f="";a.oUser.sUserName=b.UserName,a.oUser.sEmail=b.EMail,a.oUser._lastModifiedAt=b.LastModifiedAt,a.oUser.sCreatedAt=e.dBDateToSting(b.CreatedAt),a.oUser.sLastModifiedAt=e.dBDateToSting(b.LastModifiedAt),a.oUser._aCompanies=[],a.oUser.sCompanies="";for(var g=0;g<b.CompanyDetails.results.length;g++)b.CompanyDetails.results[g].GeneralAttributes.IsDeleted||(a.oUser._aCompanies.push(b.CompanyDetails.results[g]),a.oUser.sCompanies=a.oUser.sCompanies+b.CompanyDetails.results[g].CompanyName+", ");a.oUser.sRoles="";for(var g=0;g<b.RoleDetails.results.length;g++)b.RoleDetails.results[g].GeneralAttributes.IsDeleted||b.RoleDetails.results[g].CompanyName!==p||(a.oUser.sRoles=a.oUser.sRoles+b.RoleDetails.results[g].RoleName+", ");a.oUser.sPhases="";for(var g=0;g<b.PhaseDetails.results.length;g++)b.PhaseDetails.results[g].GeneralAttributes.IsDeleted||b.PhaseDetails.results[g].CompanyName!==p||(c="en"===d.use()?b.PhaseDetails.results[g].ProjectDetails.NameEN:b.PhaseDetails.results[g].ProjectDetails.NameFR,c||(c=b.PhaseDetails.results[g].ProjectDetails.NameEN),a.oUser.sPhases=a.oUser.sPhases+c+" - ",f="en"===d.use()?b.PhaseDetails.results[g].NameEN:b.PhaseDetails.results[g].NameFR,f||(f=b.PhaseDetails.results[g].NameEN),a.oUser.sPhases=a.oUser.sPhases+f+", ");a.oUser.sAvatarUrl=b.AvatarFileGuid?m.location.origin+m.location.pathname+"rest/file/get/"+b.AvatarFileGuid:m.location.origin+m.location.pathname+"img/noAvatar.jpg",a.oUser._sLanguage=b.Language,s.aData[0]=angular.copy(a.oUser),t()},v=function(){k.getUserWithCompaniesPhasesAndRoles({sKey:o,bShowSpinner:!0,onSuccess:u})};v(),a.onDataModified=function(){q=!0},a.onEdit=function(){a.sMode="edit"},a.onSave=function(b){var d={GeneralAttributes:{}},f=function(d){g.cleanEntitiesCache("oUserEntity"),g.oUserProfile.sLastModifiedAt=d.LastModifiedAt,q=!1,b&&c.go(b.toState,b.toParams),a.oUser._lastModifiedAt=d.LastModifiedAt,a.oUser.sLastModifiedAt=e.dBDateToSting(d.LastModifiedAt),a.sMode="display"};d.UserName=a.oUser.sUserName,d.EMail=a.oUser.sEmail,d.LastModifiedAt=a.oUser._lastModifiedAt,d.AvatarFileGuid=a.oUser._avatarFileGuid;for(var h=0;h<a.aLanguages.length;h++)if(a.aLanguages[h].ticked){d.Language=a.aLanguages[h].languageCode;break}k.updateUser({bShowSpinner:!0,sKey:d.UserName,oData:d,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:f})};var w=function(b,c){for(var d=0;d<b.length;d++){var e=b[d],c=j.costructUploadUrl({sPath:c});a.upload=n.upload({url:c,file:e}),a.upload.success(function(b){a.oUser.sAvatarUrl=m.location.origin+m.location.pathname+"rest/file/get/"+b,a.oUser._avatarFileGuid=b})}};a.onAvatarSelected=function(b,c){a.onDataModified(),w(b,"rest/file/createUploadUrl/users/users/_avatar_",c)};var x=function(){a.onSave(r)},y=function(){q=!1,c.go(r.toState,r.toParams)};a.$on("$stateChangeStart",function(a,b,c){q&&(a.preventDefault(),r={toState:b,toParams:c},j.showConfirmationPopup({sHeader:d.instant("global_changesSaveConfirmationHeader"),sContent:d.instant("global_changesSaveConfirmationContent"),sOk:d.instant("global_yes"),sCancel:d.instant("global_no"),onOk:x,onCancel:y,event:a}))})}]),viewControllers.controller("profileSettingsView",["$scope","$state","servicesProvider","$cookieStore","cacheProvider","$window","$mdSidenav","historyProvider","$translate","rolesSettings",function(a,b,c,d,e,f,g,h,i,j){h.removeHistory();var k=e.oUserProfile.sCurrentRole;a.toggleLeftSidenav=function(){g("left").toggle()};var l=function(a,c){g("left")&&g("left").close(),c?b.go(a,c):b.go(a)};a.onMenuItemSelected=function(a){l(a.sStateName,a.oStateParams)},a.aMenuItems=[],a.aMenuItems.push({bShouldBeDisplayed:j.getRolesProfileMenuItemSettings({sRole:k,sMenuItem:"bShowContactDetails"}),sStateName:"app.profileSettings.contactDetails",sMenuLabel:"profileSettings_contactDetails",oStateParams:{sMode:"display",sAccountGuid:e.oUserProfile.sUserAccountGuid,sContactGuid:e.oUserProfile.sUserContactGuid}}),a.aMenuItems.push({bShouldBeDisplayed:j.getRolesProfileMenuItemSettings({sRole:k,sMenuItem:"bShowProfileDetails"}),sStateName:"app.profileSettings.profileDetails",sMenuLabel:"profileSettings_profileDetails"}),a.aMenuItems.push({bShouldBeDisplayed:j.getRolesProfileMenuItemSettings({sRole:k,sMenuItem:"bShowChangePassword"}),sStateName:"app.profileSettings.changePassword",sMenuLabel:"profileSettings_changePassword"});var m=angular.element(f);m.bind("resize",function(){g("left")&&g("left").close()}),a.$on("$destroy",function(){m.unbind()})}]),viewControllers.controller("accountTypesListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","historyProvider",function(a,b,c,d,e,f,g,h,i){i.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var j=0,k={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:k,sDisplayedDataArrayName:"aDisplayedAccountTypes",oInitialSorting:{sortingSequence:"asc"}});var l=function(b){for(var c=0;c<b.length;c++)k.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,nameEN:b[c].NameEN,nameFR:b[c].NameFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};g.getAccountTypes({bShowSpinner:!0,onSuccess:l}),a.onAddNew=function(){k.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:j}),j++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<k.aData.length;c++)if(k.aData[c]._guid===b._guid){k.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updateAccountType({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<k.aData.length;e++)if(k.aData[e]._counter===b._counter){k.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._guid?(b.Guid=a._guid,g.updateAccountType({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):g.createAccountType({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("activityTypesListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","historyProvider",function(a,b,c,d,e,f,g,h,i){i.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var j=0,k={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:k,sDisplayedDataArrayName:"aDisplayedActivityTypes",oInitialSorting:{sortingSequence:"asc"}});var l=function(b){for(var c=0;c<b.length;c++)k.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,nameEN:b[c].NameEN,nameFR:b[c].NameFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};g.getActivityTypes({bShowSpinner:!0,onSuccess:l}),a.onAddNew=function(){k.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:j}),j++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<k.aData.length;c++)if(k.aData[c]._guid===b._guid){k.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updateActivityType({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<k.aData.length;e++)if(k.aData[e]._counter===b._counter){k.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._guid?(b.Guid=a._guid,g.updateActivityType({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):g.createActivityType({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("adminPanelView",["$scope","$state","servicesProvider","$window","CONSTANTS","cacheProvider","$mdSidenav","$window","historyProvider","rolesSettings","$translate",function(a,b,c,d,e,f,g,d,h,i){h.removeHistory();var j=f.oUserProfile.sCurrentRole;a.toggleLeftSidenav=function(){g("left").toggle()};var k=function(a){g("left").close(),b.go(a)};a.onMenuItemSelected=function(a){k(a.sStateName)},a.aMenuItems=[],a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowCompaniesManagement"}),sStateName:"app.adminPanel.companiesList",sMenuLabel:"adminPanel_companies"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowUsersManagement"}),sStateName:"app.adminPanel.usersList",sMenuLabel:"adminPanel_userManagement"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowRolesManagement"}),sStateName:"app.adminPanel.rolesList",sMenuLabel:"adminPanel_roles"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowProjectsManagement"}),sStateName:"app.adminPanel.projectsList",sMenuLabel:"adminPanel_projects"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowPhasesManagement"}),sStateName:"app.adminPanel.phasesList",sMenuLabel:"adminPanel_phases"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowDeficiencyStatusesManagement"}),sStateName:"app.adminPanel.deficiencyStatusesList",sMenuLabel:"adminPanel_deficiencyStatuses"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowDeficiencyPrioritiesManagement"}),sStateName:"app.adminPanel.deficiencyPrioritiesList",sMenuLabel:"adminPanel_deficiencyPriorities"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowSystemFilesManagement"}),sStateName:"app.adminPanel.systemFiles",sMenuLabel:"adminPanel_systemFiles"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowOperationLogs"}),sStateName:"app.adminPanel.operationLogsList",sMenuLabel:"adminPanel_operationLogs"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowAccountTypesManagement"}),sStateName:"app.adminPanel.accountTypesList",sMenuLabel:"adminPanel_accountTypes"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowContactTypesManagement"}),sStateName:"app.adminPanel.contactTypesList",sMenuLabel:"adminPanel_contactTypes"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowUnitOptionSetManagement"}),sStateName:"app.adminPanel.unitOptionSetList",sMenuLabel:"adminPanel_unitOptionSet"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowUnitOptionValueManagement"}),sStateName:"app.adminPanel.unitOptionValueList",sMenuLabel:"adminPanel_unitOptionValue"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowTaskTypeManagement"}),sStateName:"app.adminPanel.taskTypeList",sMenuLabel:"adminPanel_taskType"}),a.aMenuItems.push({bShouldBeDisplayed:i.getRolesAdminPanelMenuItemSettings({sRole:j,sMenuItem:"bShowActivityTypesManagement"}),sStateName:"app.adminPanel.activityTypesList",sMenuLabel:"adminPanel_activityTypes"});var l=angular.element(d);l.bind("resize",function(){g("left")&&g("left").close()}),a.$on("$destroy",function(){l.unbind()})}]),viewControllers.controller("companiesListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","CONSTANTS","cacheProvider","dataProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j,k,l){l.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var m={aData:[]},n=0;a.tableParams=d.createNgTable({oInitialDataArrayWrapper:m,sDisplayedDataArrayName:"aDisplayedCompanies",oInitialSorting:{sortingSequence:"asc"}});var o=function(b){for(var c=0;c<b.length;c++)m.aData.push({_editMode:!1,_companyName:b[c].CompanyName,_lastModifiedAt:b[c].LastModifiedAt,companyName:b[c].CompanyName,descriptionEN:b[c].DescriptionEN,descriptionFR:b[c].DescriptionFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};g.getCompanies({bShowSpinner:!0,onSuccess:o}),a.onAddNew=function(){m.aData.push({_createMode:!0,_editMode:!0,sortingSequence:0,descriptionEN:"",descriptionFR:"",_counter:n}),n++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<m.aData.length;c++)if(m.aData[c]._companyName===b._companyName){m.aData.splice(c,1);break}a.tableParams.reload()};if(b._companyName)c.CompanyName=b._companyName,c.LastModifiedAt=b._lastModifiedAt,g.updateCompany({bShowSpinner:!0,sKey:c.CompanyName,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<m.aData.length;e++)if(m.aData[e]._counter===b._counter){m.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._companyName=b[0].__changeResponses[0].data.CompanyName,a._lastModifiedAt=b[0].__changeResponses[0].data.LastModifiedAt,a._editMode=!1,a._createMode=!1,d.refreshUserProfile()},e=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt,d.refreshUserProfile()};b.DescriptionEN=a.descriptionEN,b.DescriptionFR=a.descriptionFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._companyName?(b.CompanyName=a._companyName,g.updateCompany({bShowSpinner:!0,sKey:b.CompanyName,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:e})):(b.CompanyName=a.companyName,g.createCompany({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c}))}}]),viewControllers.controller("contactTypesListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","historyProvider",function(a,b,c,d,e,f,g,h,i){i.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var j=0,k={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:k,sDisplayedDataArrayName:"aDisplayedContactTypes",oInitialSorting:{sortingSequence:"asc"}});var l=function(b){for(var c=0;c<b.length;c++)k.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,nameEN:b[c].NameEN,nameFR:b[c].NameFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};g.getContactTypes({bShowSpinner:!0,onSuccess:l}),a.onAddNew=function(){k.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:j}),j++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<k.aData.length;c++)if(k.aData[c]._guid===b._guid){k.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updateContactType({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<k.aData.length;e++)if(k.aData[e]._counter===b._counter){k.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._guid?(b.Guid=a._guid,g.updateContactType({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):g.createContactType({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("deficiencyPrioritiesListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","$window","historyProvider",function(a,b,c,d,e,f,g,h,i,j){j.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var k=0,l={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:l,sDisplayedDataArrayName:"aDisplayedDeficiencyPriorities",oInitialSorting:{sortingSequence:"asc"}});var m=function(b){for(var c=0;c<b.length;c++)l.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,nameEN:b[c].NameEN,nameFR:b[c].NameFR,associatedColor:b[c].AssociatedColor,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};g.getDeficiencyPriorities({bShowSpinner:!0,onSuccess:m}),a.onAddNew=function(){l.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",associatedColor:"",_counter:k}),k++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<l.aData.length;c++)if(l.aData[c]._guid===b._guid){l.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updateDeficiencyPriority({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<l.aData.length;e++)if(l.aData[e]._counter===b._counter){l.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.AssociatedColor=a.associatedColor,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._guid?(b.Guid=a._guid,g.updateDeficiencyPriority({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):g.createDeficiencyPriority({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("deficiencyStatusesListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","$window","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j,k){k.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var l={aData:[]},m=0,n={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:n,sDisplayedDataArrayName:"aDisplayedDeficiencyStatuses",oInitialSorting:{sortingSequence:"asc"}});var o=function(a){d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:n,oNewParentItemArrayWrapper:l,sDependentKey:"guid",sParentKey:"_associatedIconFileGuid",sDependentIconKey:"guid",sTargetArrayNameInParent:"aStatusIcons"})},p=function(b){for(var c=0;c<b.length;c++)n.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,_associatedIconFileGuid:b[c].AssociatedIconFileGuid,sUrl:i.location.origin+i.location.pathname+"rest/file/get/"+b[c].AssociatedIconFileGuid,nameEN:b[c].NameEN,nameFR:b[c].NameFR,associatedColor:b[c].AssociatedColor,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload(),g.getAttachments({sPath:"rest/file/list/companyDependentSettings/"+j.oUserProfile.sCurrentCompany+"/_deficiencyStatuses_",onSuccess:o})};g.getDeficiencyStatuses({bShowSpinner:!0,onSuccess:p}),a.onAddNew=function(){n.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:m,aStatusIcons:angular.copy(l.aData)}),m++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<n.aData.length;c++)if(n.aData[c]._guid===b._guid){n.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updateDeficiencyStatus({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<n.aData.length;e++)if(n.aData[e]._counter===b._counter){n.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1,a._associatedIconFileGuid=b.AssociatedIconFileGuid,a.sUrl=i.location.origin+i.location.pathname+"rest/file/get/"+b.AssociatedIconFileGuid},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt,a._associatedIconFileGuid=b.AssociatedIconFileGuid,a.sUrl=i.location.origin+i.location.pathname+"rest/file/get/"+b.AssociatedIconFileGuid};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.AssociatedColor=a.associatedColor,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt;for(var e=0;e<a.aStatusIcons.length;e++)if(a.aStatusIcons[e].ticked){b.AssociatedIconFileGuid=a.aStatusIcons[e].guid;break}a._guid?(b.Guid=a._guid,g.updateDeficiencyStatus({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):g.createDeficiencyStatus({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("operationLogsListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","utilsProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j){j.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var k={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:k,sDisplayedDataArrayName:"aDisplayedOperationLogs",oInitialSorting:{createdAt:"desc"}});var l=function(b){for(var c={},d={},e=0;e<b.length;e++)c={},d={},c.operationName=b[e].OperationName,c.createdBy=b[e].GeneralAttributes.CreatedBy,c.createdAt=i.dBDateToSting(b[e].CreatedAt),d=i.stringToJson(b[e].OperationContent),c.operationContent=h.instant("global_role")+": "+d.sRole+", ",c.operationContent=c.operationContent+h.instant("global_company")+": "+d.sCompany,k.aData.push(c);a.tableParams.reload()};g.getOperationLogs({sPath:"OperationLogs",bShowSpinner:!0,onSuccess:l})}]),viewControllers.controller("phasesListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j){j.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var k={aData:[]},l=0,m={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:m,sDisplayedDataArrayName:"aDisplayedPhases",oInitialSorting:{sortingSequence:"asc"}});var n=function(a){for(var b=0;b<a.length;b++)a[b]._sortingSequence=a[b].GeneralAttributes.SortingSequence;a=f("orderBy")(a,["_sortingSequence"]),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:m,oNewParentItemArrayWrapper:k,sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",sParentKey:"_projectGuid",sTargetArrayNameInParent:"aProjects"})},o=function(b){for(var c=0;c<b.length;c++){var d={};d._editMode=!1,d._guid=b[c].Guid,d._lastModifiedAt=b[c].LastModifiedAt,d.nameEN=b[c].NameEN,d.nameFR=b[c].NameFR,d.sortingSequence=b[c].GeneralAttributes.SortingSequence,b[c].ProjectDetails&&(d._projectGuid=b[c].ProjectDetails.Guid,d.projectName="en"===h.use()?b[c].ProjectDetails.NameEN:b[c].ProjectDetails.NameFR,d.projectName||(d.projectName=b[c].ProjectDetails.NameEN)),m.aData.push(d)}a.tableParams.reload(),g.getProjects({bShowSpinner:!1,onSuccess:n})};g.getPhases({bShowSpinner:!0,onSuccess:o}),a.onAddNew=function(){m.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:l,aProjects:angular.copy(k.aData)}),l++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<m.aData.length;c++)if(m.aData[c]._guid===b._guid){m.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updatePhase({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<m.aData.length;e++)if(m.aData[e]._counter===b._counter){m.aData.splice(e,1),a.tableParams.reload();break}};var p="";a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1,a.projectName=p,p="",i.cleanEntitiesCache("oProjectEntity")},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt,a.projectName=p,p="",i.cleanEntitiesCache("oProjectEntity")};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt;for(var e=0;e<a.aProjects.length;e++)if(a.aProjects[e].ticked){b.ProjectGuid=a.aProjects[e].Guid,p=a.aProjects[e].name;break}a._guid?(b.Guid=a._guid,g.updatePhase({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):g.createPhase({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("projectsListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","historyProvider",function(a,b,c,d,e,f,g,h,i){i.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var j=0,k={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:k,sDisplayedDataArrayName:"aDisplayedProjects",oInitialSorting:{sortingSequence:"asc"}});var l=function(b){for(var c=0;c<b.length;c++)k.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,nameEN:b[c].NameEN,nameFR:b[c].NameFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};g.getProjects({bShowSpinner:!0,onSuccess:l}),a.onAddNew=function(){k.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:j}),j++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<k.aData.length;c++)if(k.aData[c]._guid===b._guid){k.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updateProject({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<k.aData.length;e++)if(k.aData[e]._counter===b._counter){k.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._guid?(b.Guid=a._guid,g.updateProject({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):g.createProject({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("rolesListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","historyProvider",function(a,b,c,d,e,f,g,h,i){i.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var j={aData:[]},k=0;a.tableParams=d.createNgTable({oInitialDataArrayWrapper:j,sDisplayedDataArrayName:"aDisplayedRoles",oInitialSorting:{sortingSequence:"asc"}});var l=function(b){for(var c=0;c<b.length;c++)j.aData.push({_editMode:!1,_guid:b[c].Guid,_roleName:b[c].RoleName,_lastModifiedAt:b[c].LastModifiedAt,roleName:b[c].RoleName,descriptionEN:b[c].DescriptionEN,descriptionFR:b[c].DescriptionFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};g.getRoles({bShowSpinner:!0,onSuccess:l}),a.onAddNew=function(){j.aData.push({_createMode:!0,_editMode:!0,sortingSequence:0,descriptionEN:"",descriptionFR:"",_counter:k}),k++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<j.aData.length;c++)if(j.aData[c]._guid===b._guid){j.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updateRole({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});
else for(var e=0;e<j.aData.length;e++)if(j.aData[e]._counter===b._counter){j.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1,a._createMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.DescriptionEN=a.descriptionEN,b.DescriptionFR=a.descriptionFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,b.RoleName=a.roleName,a._guid?(b.Guid=a._guid,g.updateRole({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):g.createRole({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("systemFilesView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","$upload","$window","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j,k,l){l.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var m={aData:[]},n={aData:[]};a.logosTableParams=d.createNgTable({oInitialDataArrayWrapper:m,sDisplayedDataArrayName:"aDisplayedLogos"}),a.deficiencyStatusesTableParams=d.createNgTable({oInitialDataArrayWrapper:n,sDisplayedDataArrayName:"aDisplayedDeficiencyStatuses"});var o=function(a,b,c){for(var d=0;d<a.length;d++){var e={};e.sUrl=j.location.origin+j.location.pathname+"rest/file/get/"+a[d].guid,e._createMode=!1,e._editMode=!1,e._guid=a[d].guid,b.push(e)}c.reload()},p=function(a,b){var c={};c._createMode=!0,c._editMode=!0,a.push(c),b.reload()};a.onEditImg=function(a){a._editMode=!0};var q=function(a,b,c,e){c._guid&&d.deleteFileAttachment(c._guid),a.splice(e,1),b.reload()},r=function(a,b,c,d){c._guid||q(a,b,c,d),c._editMode=!1,c._createMode=!1},s=function(b,c,e,f,g){for(var h=0;h<b.length;h++){var k=b[h],c=d.costructUploadUrl({sPath:c});a.upload=i.upload({url:c,file:k}),a.upload.success(function(a){e[g]._createMode=!1,e[g]._editMode=!1,e[g].sUrl=j.location.origin+j.location.pathname+"rest/file/get/"+a,e[g]._guid=a})}};onLogoImgsLoaded=function(b){o(b,m.aData,a.logosTableParams)},onDeficienciesStatusesImgsLoaded=function(b){o(b,n.aData,a.deficiencyStatusesTableParams)},g.getAttachments({sPath:"rest/file/list/companyDependentSettings/"+k.oUserProfile.sCurrentCompany+"/_logo_",onSuccess:onLogoImgsLoaded}),g.getAttachments({sPath:"rest/file/list/companyDependentSettings/"+k.oUserProfile.sCurrentCompany+"/_deficiencyStatuses_",onSuccess:onDeficienciesStatusesImgsLoaded}),a.onAddNewLogo=function(){p(m.aData,a.logosTableParams)},a.onDeleteLogo=function(b,c){q(m.aData,a.logosTableParams,b,c)},a.onCancelLogo=function(b,c){r(m.aData,a.logosTableParams,b,c)},a.onLogoSelected=function(a,b,c){s(a,"rest/file/createUploadUrl/companyDependentSettings/"+k.oUserProfile.sCurrentCompany+"/_logo_",m.aData,b,c)},a.onAddNewDeficiencyStatus=function(){p(n.aData,a.deficiencyStatusesTableParams)},a.onDeleteDeficiencyStatus=function(b,c){q(n.aData,a.deficiencyStatusesTableParams,b,c)},a.onCancelDeficiencyStatus=function(b,c){r(n.aData,a.deficiencyStatusesTableParams,b,c)},a.onDeficiencyStatusSelected=function(a,b,c){s(a,"rest/file/createUploadUrl/companyDependentSettings/"+k.oUserProfile.sCurrentCompany+"/_deficiencyStatuses_",n.aData,b,c)}}]),viewControllers.controller("taskTypeListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j){j.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var k={aData:[]},l=0,m={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:m,sDisplayedDataArrayName:"aDisplayedTaskTypes",oInitialSorting:{sortingSequence:"asc"}});var n=function(a){for(var b=0;b<a.length;b++)a[b]._sortingSequence=a[b].GeneralAttributes.SortingSequence;a=f("orderBy")(a,["_sortingSequence"]),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:m,oNewParentItemArrayWrapper:k,sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",sParentKey:"_unitOptionSetGuid",sTargetArrayNameInParent:"aUnitOptionSets"})},o=function(b){for(var c=0;c<b.length;c++){var d={};d._editMode=!1,d._guid=b[c].Guid,d._lastModifiedAt=b[c].LastModifiedAt,d.nameEN=b[c].NameEN,d.nameFR=b[c].NameFR,d.sortingSequence=b[c].GeneralAttributes.SortingSequence,b[c].UnitOptionSetDetails&&(d._unitOptionSetGuid=b[c].UnitOptionSetDetails.Guid),m.aData.push(d)}a.tableParams.reload(),g.getUnitOptionSets({bShowSpinner:!1,onSuccess:n})};g.getTaskTypes({bShowSpinner:!0,onSuccess:o}),a.onAddNew=function(){m.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:l,aUnitOptionSets:angular.copy(k.aData)}),l++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<m.aData.length;c++)if(m.aData[c]._guid===b._guid){m.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updateTaskType({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<m.aData.length;e++)if(m.aData[e]._counter===b._counter){m.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt;for(var e=0;e<a.aUnitOptionSets.length;e++)if(a.aUnitOptionSets[e].ticked){b.UnitOptionSetGuid=a.aUnitOptionSets[e].Guid;break}a._guid?(b.Guid=a._guid,g.updateTaskType({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):g.createTaskType({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("unitOptionSetListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j){j.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var k={aData:[]},l=0,m={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:m,sDisplayedDataArrayName:"aDisplayedUnitOptionSets",oInitialSorting:{sortingSequence:"asc"}});var n=function(a){for(var b=0;b<a.length;b++){a[b]._sortingSequence=a[b].GeneralAttributes.SortingSequence;for(var c=0;c<a[b].PhaseDetails.results.length;c++){if(a[b].PhaseDetails.results[c].GeneralAttributes.IsDeleted){a[b].PhaseDetails.results.splice(c,1);break}a[b].PhaseDetails.results[c]._sortingSequence=a[b].PhaseDetails.results[c].GeneralAttributes.SortingSequence}a[b].PhaseDetails.results=f("orderBy")(a[b].PhaseDetails.results,["_sortingSequence"])}a=f("orderBy")(a,["_sortingSequence"]),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:m,oNewParentItemArrayWrapper:k,sSecondLevelAttribute:"PhaseDetails",sSecondLevelNameEN:"NameEN",sSecondLevelNameFR:"NameFR",sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",sParentKeys:"_unitOptionSetGuids",sTargetArrayNameInParent:"aPhases"})},o=function(b){for(var c=0;c<b.length;c++){var d={};if(d._editMode=!1,d._guid=b[c].Guid,d._lastModifiedAt=b[c].LastModifiedAt,d.nameEN=b[c].NameEN,d.nameFR=b[c].NameFR,d.sortingSequence=b[c].GeneralAttributes.SortingSequence,d._unitOptionSetGuids=[],b[c].PhaseDetails&&b[c].PhaseDetails.results)for(var e=0;e<b[c].PhaseDetails.results.length;e++)d._unitOptionSetGuids.push(b[c].PhaseDetails.results[e].Guid);m.aData.push(d)}a.tableParams.reload(),g.getProjectsWithPhases({bShowSpinner:!1,onSuccess:n})};g.getUnitOptionSets({bShowSpinner:!0,onSuccess:o}),a.onAddNew=function(){m.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:l,aPhases:angular.copy(k.aData)}),l++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<m.aData.length;c++)if(m.aData[c]._guid===b._guid){m.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updateUnitOptionSet({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<m.aData.length;e++)if(m.aData[e]._counter===b._counter){m.aData.splice(e,1),a.tableParams.reload();break}};var p=function(a){for(var b=[],c=[],d="",e=0;e<a.aPhases.length;e++)a.aPhases[e].ticked&&(d="Phases('"+a.aPhases[e].Guid+"')",c.push(d));return c.length&&b.push({sRelationName:"PhaseDetails",aUri:c}),b};a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt;var e=p(a);a._guid?(b.Guid=a._guid,g.updateUnitOptionSet({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d,aLinks:e})):g.createUnitOptionSet({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c,aLinks:e})}}]),viewControllers.controller("unitOptionValueListView",["$scope","$rootScope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h,i,j){j.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={};var k={aData:[]},l=0,m={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:m,sDisplayedDataArrayName:"aDisplayedUnitOptionValues",oInitialSorting:{sortingSequence:"asc"}});var n=function(a){for(var b=0;b<a.length;b++)a[b]._sortingSequence=a[b].GeneralAttributes.SortingSequence;a=f("orderBy")(a,["_sortingSequence"]),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:m,oNewParentItemArrayWrapper:k,sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",sParentKey:"_unitOptionSetGuid",sTargetArrayNameInParent:"aUnitOptionSets"})},o=function(b){for(var c=0;c<b.length;c++){var d={};d._editMode=!1,d._guid=b[c].Guid,d._lastModifiedAt=b[c].LastModifiedAt,d.nameEN=b[c].NameEN,d.nameFR=b[c].NameFR,d.sortingSequence=b[c].GeneralAttributes.SortingSequence,b[c].UnitOptionSetDetails&&(d._unitOptionSetGuid=b[c].UnitOptionSetDetails.Guid),m.aData.push(d)}a.tableParams.reload(),g.getUnitOptionSets({bShowSpinner:!1,onSuccess:n})};g.getUnitOptionValues({bShowSpinner:!0,onSuccess:o}),a.onAddNew=function(){m.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:l,aUnitOptionSets:angular.copy(k.aData)}),l++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<m.aData.length;c++)if(m.aData[c]._guid===b._guid){m.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,g.updateUnitOptionValue({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<m.aData.length;e++)if(m.aData[e]._counter===b._counter){m.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt;for(var e=0;e<a.aUnitOptionSets.length;e++)if(a.aUnitOptionSets[e].ticked){b.UnitOptionSetGuid=a.aUnitOptionSets[e].Guid;break}a._guid?(b.Guid=a._guid,g.updateUnitOptionValue({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):g.createUnitOptionValue({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("userDetailsView",["$scope","$rootScope","$state","$stateParams","servicesProvider","apiProvider","$translate","cacheProvider","utilsProvider","$filter","dataProvider","$window","$upload","CONSTANTS","historyProvider","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.oForms={};var q=d.sUserName,r=!1,s={};a.bShowBackButton=o.aHistoryStates.length>0?!0:!1;var t=h.oUserProfile.sCurrentRole;a.bIsGlobalUserAdministrator=p[t].bIsGlobalUserAdministrator,a.bDisplayEditButton=p.getRolesSettingsForEntityAndOperation({sRole:t,sEntityName:"oUser",sOperation:"bUpdate"}),a.bDisplayDeleteButton=p.getRolesSettingsForEntityAndOperation({sRole:t,sEntityName:"oUser",sOperation:"bDelete"}),b.sCurrentStateName=c.current.name,b.oStateParams=angular.copy(d),a.sMode=d.sMode,a.oUser={_aCompanies:[],_aPhases:[],_aRoles:[]};var u={aData:[{}]};a.aCompanies=[],a.aRoles=[],a.aPhases=[],a.aContacts=[],a.aLanguages=[];var v=function(){var b=[];b.push({languageCode:"en",descriptionEN:"English",descriptionFR:"Anglais"}),b.push({languageCode:"fr",descriptionEN:"French",descriptionFR:"Français"}),e.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},oParentArrayWrapper:u,sNameEN:"descriptionEN",sNameFR:"descriptionFR",sDependentKey:"languageCode",sParentKey:"_sLanguage",sTargetArrayNameInParent:"aLanguages"}),u.aData[0]&&(a.aLanguages=angular.copy(u.aData[0].aLanguages))},w=function(b){a.oUser.sUserName=b.UserName,a.oUser.sEmail=b.EMail,a.oUser._lastModifiedAt=b.LastModifiedAt,a.oUser.sCreatedAt=i.dBDateToSting(b.CreatedAt),a.oUser.sLastModifiedAt=i.dBDateToSting(b.LastModifiedAt),a.oUser._aCompanies=angular.copy(b.CompanyDetails.results),a.oUser._aPhases=angular.copy(b.PhaseDetails.results),a.oUser._aRoles=angular.copy(b.RoleDetails.results),a.oUser._contactGuid=b.ContactGuid,a.oUser._sLanguage=b.Language,a.oUser.sAvatarUrl=b.AvatarFileGuid?l.location.origin+l.location.pathname+"rest/file/get/"+b.AvatarFileGuid:l.location.origin+l.location.pathname+"img/noAvatar.jpg",u.aData[0]=angular.copy(a.oUser)},x=h.getEntityDetails({sCacheProviderAttribute:"oUserEntity",sRequestSettings:"GeneralAttributes/IsDeleted eq falseCompanyDetails,PhaseDetails,RoleDetails",sKeyName:"UserName",sKeyValue:d.sUserName}),y=function(b){for(var c=0;c<b.length;c++)b[c]._sortingSequence=b[c].GeneralAttributes.SortingSequence;b=j("orderBy")(b,["_sortingSequence"]);for(var d=[],c=0;c<a.oUser._aCompanies.length;c++)d.push(a.oUser._aCompanies[c].CompanyName);e.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},oParentArrayWrapper:u,sNameEN:"CompanyName",sNameFR:"CompanyName",sDependentKey:"CompanyName",aParentKeys:d,sTargetArrayNameInParent:"aCompanies"}),u.aData[0]&&(a.aCompanies=angular.copy(u.aData[0].aCompanies))},z=function(b){for(var c=0;c<b.length;c++)b[c]._sortingSequence=b[c].GeneralAttributes.SortingSequence;b=j("orderBy")(b,["_sortingSequence"]);for(var d=[],c=0;c<a.oUser._aRoles.length;c++)d.push(a.oUser._aRoles[c].Guid);e.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},oParentArrayWrapper:u,sNameEN:"RoleName",sNameFR:"RoleName",sDependentKey:"Guid",aParentKeys:d,sTargetArrayNameInParent:"aRoles"}),u.aData[0]&&(a.aRoles=angular.copy(u.aData[0].aRoles))},A=function(b){for(var c=0;c<b.length;c++){b[c]._sortingSequence=b[c].GeneralAttributes.SortingSequence;for(var d=0;d<b[c].PhaseDetails.results.length;d++){if(b[c].PhaseDetails.results[d].GeneralAttributes.IsDeleted){b[c].PhaseDetails.results.splice(d,1);break}b[c].PhaseDetails.results[d]._sortingSequence=b[c].PhaseDetails.results[d].GeneralAttributes.SortingSequence}b[c].PhaseDetails.results=j("orderBy")(b[c].PhaseDetails.results,["_sortingSequence"])}b=j("orderBy")(b,["_sortingSequence"]);for(var f=[],c=0;c<a.oUser._aPhases.length;c++)f.push(a.oUser._aPhases[c].Guid);e.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},sSecondLevelAttribute:"PhaseDetails",sSecondLevelNameEN:"NameEN",sSecondLevelNameFR:"NameFR",oParentArrayWrapper:u,sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",aParentKeys:f,sTargetArrayNameInParent:"aPhases"}),u.aData[0]&&(a.aPhases=angular.copy(u.aData[0].aPhases))},B=function(b){for(var c=0;c<b.length;c++)b[c].FirstName&&(b[c].sName=b[c].FirstName),b[c].LastName&&(b[c].FirstName&&(b[c].sName=b[c].sName+" "),b[c].sName=b[c].sName+b[c].LastName+", "+b[c].AccountDetails.Name);b=j("orderBy")(b,["sName"]),e.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:b},oParentArrayWrapper:u,sNameEN:"sName",sNameFR:"sName",sDependentKey:"Guid",sParentKey:"_contactGuid",sTargetArrayNameInParent:"aContacts"}),u.aData[0]&&(a.aContacts=angular.copy(u.aData[0].aContacts))},C=function(a){w(a),f.getCompanies({bShowSpinner:!1,onSuccess:y}),f.getProjectsWithPhases({bShowSpinner:!1,onSuccess:A}),f.getRoles({bShowSpinner:!1,onSuccess:z}),f.getContacts({bShowSpinner:!1,onSuccess:B}),v()},D=function(){f.getUserWithCompaniesPhasesAndRoles({sKey:q,bShowSpinner:!0,onSuccess:C})};"create"!==a.sMode?angular.equals(x,{})?D():(w(x),f.getCompanies({bShowSpinner:!1,onSuccess:y}),f.getProjectsWithPhases({bShowSpinner:!1,onSuccess:A}),f.getRoles({bShowSpinner:!1,onSuccess:z}),f.getContacts({bShowSpinner:!1,onSuccess:B}),v()):(a.oUser.sAvatarUrl=l.location.origin+l.location.pathname+"img/noAvatar.jpg",f.getCompanies({bShowSpinner:!1,onSuccess:y}),f.getProjectsWithPhases({bShowSpinner:!1,onSuccess:A}),f.getRoles({bShowSpinner:!1,onSuccess:z}),f.getContacts({bShowSpinner:!1,onSuccess:B}),v()),a.onBack=function(){o.navigateBack({oState:c})},a.onEdit=function(){c.go("app.adminPanel.userDetails",{sMode:"edit",sUserName:a.oUser.sUserName})};var E=function(){var b={GeneralAttributes:{IsDeleted:!0}},d=function(){o.navigateBack({oState:c})};b.UserName=a.oUser.sUserName,b.LastModifiedAt=a.oUser._lastModifiedAt,f.updateUser({bShowSpinner:!0,sKey:b.UserName,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})};a.onDelete=function(a){e.showConfirmationPopup({sHeader:g.instant("userDetails_deletionConfirmationHeader"),sContent:g.instant("userDetails_deletionConfirmationContent"),sOk:g.instant("global_ok"),sCancel:g.instant("global_cancel"),onOk:E,event:a})};var F=function(){for(var b=[],c=[],d="",e=0;e<a.aCompanies.length;e++)a.aCompanies[e].ticked&&(d="Companys('"+a.aCompanies[e].CompanyName+"')",c.push(d));c.length&&b.push({sRelationName:"CompanyDetails",aUri:c}),c=[];for(var e=0;e<a.aRoles.length;e++)a.aRoles[e].ticked&&(d="Roles('"+a.aRoles[e].Guid+"')",c.push(d));c.length&&b.push({sRelationName:"RoleDetails",bKeepCompanyDependentLinks:!0,aUri:c}),c=[];for(var e=0;e<a.aPhases.length;e++)a.aPhases[e].ticked&&(d="Phases('"+a.aPhases[e].Guid+"')",c.push(d));return c.length&&b.push({sRelationName:"PhaseDetails",bKeepCompanyDependentLinks:!0,aUri:c}),b};a.onDataModified=function(){r=!0},a.onSave=function(b,d){if(a.oForms.userDetailsForm.selectedCompanies&&a.oForms.userDetailsForm.selectedCompanies.$setDirty(),a.oForms.userDetailsForm.username&&a.oForms.userDetailsForm.username.$setDirty(),a.oForms.userDetailsForm.email&&a.oForms.userDetailsForm.email.$setDirty(),a.oForms.userDetailsForm.password&&a.oForms.userDetailsForm.password.$setDirty(),a.oForms.userDetailsForm.passwordConfirmation&&a.oForms.userDetailsForm.passwordConfirmation.$setDirty(),a.oForms.userDetailsForm.$valid){var j=new Hashes.SHA512,k={GeneralAttributes:{}},m=[],n=function(e){return r=!1,d?void c.go(d.toState,d.toParams):void(b?(a.oUser.sUserName="",a.oUser.sEmail="",a.oUser._aCompanies=[],a.oUser._aPhases=[],a.oUser._aRoles=[],a.oUser.sPassword="",a.oUser.sPasswordConfirmation="",a.oUser.sAvatarUrl=l.location.origin+l.location.pathname+"img/noAvatar.jpg"):(c.go("app.adminPanel.userDetails",{sMode:"display",sUserName:e.UserName}),a.oUser._lastModifiedAt=e.LastModifiedAt,a.oUser.sLastModifiedAt=i.dBDateToSting(e.LastModifiedAt),a.oUser.sCreatedAt=i.dBDateToSting(e.CreatedAt),a.oUser.sPassword="",a.oUser.sPasswordConfirmation=""))},o=function(b){return b.UserName===h.oUserProfile.sUserName&&e.refreshUserProfile(),r=!1,d?void c.go(d.toState,d.toParams):(a.oUser._lastModifiedAt=b.LastModifiedAt,a.oUser.sLastModifiedAt=i.dBDateToSting(b.LastModifiedAt),a.oUser.sPassword="",a.oUser.sPasswordConfirmation="",void c.go("app.adminPanel.userDetails",{sMode:"display",sUserName:b.UserName}))};if(k.UserName=a.oUser.sUserName,k.EMail=a.oUser.sEmail,k.LastModifiedAt=a.oUser._lastModifiedAt,k.AvatarFileGuid=a.oUser._avatarFileGuid,a.oUser.sPassword&&a.oUser.sPassword===a.oUser.sPasswordConfirmation&&(k.Password=f.hashPassword(j.hex(a.oUser.sPassword)),k.IsPasswordInitial=!0),a.oUser.sPassword!==a.oUser.sPasswordConfirmation)return void i.displayMessage({sText:g.instant("global_passwordsDontMatch"),sType:"error"});for(var p=0;p<a.aContacts.length;p++)if(a.aContacts[p].ticked){k.ContactGuid=a.aContacts[p].Guid;break}for(var p=0;p<a.aLanguages.length;p++)if(a.aLanguages[p].ticked){k.Language=a.aLanguages[p].languageCode;break}switch(m=F(),a.sMode){case"edit":f.updateUser({bShowSpinner:!0,sKey:k.UserName,oData:k,aLinks:m,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:o});break;case"create":if(!k.Password)return void i.displayMessage({sText:g.instant("global_noInitialPasswordProvided"),sType:"error"});f.createUser({bShowSpinner:!0,oData:k,aLinks:m,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:n})}}},a.onSaveAndNew=function(){a.onSave(!0)};var G=function(b,c){for(var d=0;d<b.length;d++){var f=b[d],c=e.costructUploadUrl({sPath:c});a.upload=m.upload({url:c,file:f}),a.upload.success(function(b){a.oUser.sAvatarUrl=l.location.origin+l.location.pathname+"rest/file/get/"+b,a.oUser._avatarFileGuid=b})}};a.onAvatarSelected=function(b,c){a.onDataModified(),G(b,"rest/file/createUploadUrl/users/users/_avatar_",c)};var H=function(){a.onSave(!1,s)},I=function(){r=!1,c.go(s.toState,s.toParams)};a.$on("$stateChangeStart",function(a,b,c){r&&(a.preventDefault(),s={toState:b,toParams:c},e.showConfirmationPopup({sHeader:g.instant("global_changesSaveConfirmationHeader"),sContent:g.instant("global_changesSaveConfirmationContent"),sOk:g.instant("global_yes"),sCancel:g.instant("global_no"),onOk:H,onCancel:I,event:a}))}),a.$on("$destroy",function(){o.getPreviousStateName()!==b.sCurrentStateName&&o.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:angular.copy(b.oStateParams)})})}]),viewControllers.controller("usersListView",["$scope","$rootScope","$state","servicesProvider","apiProvider","$translate","$window","cacheProvider","CONSTANTS","historyProvider","rolesSettings",function(a,b,c,d,e,f,g,h,i,j,k){j.removeHistory(),b.sCurrentStateName=c.current.name,b.oStateParams={},a.sCurrentRole=h.oUserProfile.sCurrentRole,a.bIsGlobalUserAdministrator=k[a.sCurrentRole].bIsGlobalUserAdministrator,a.bDisplayAddButton=k.getRolesSettingsForEntityAndOperation({sRole:a.sCurrentRole,sEntityName:"oUser",sOperation:"bCreate"}),a.bDisplayEditButtons=k.getRolesSettingsForEntityAndOperation({sRole:a.sCurrentRole,sEntityName:"oUser",sOperation:"bUpdate"});var l={aData:[]};a.tableParams=d.createNgTable({oInitialDataArrayWrapper:l,sDisplayedDataArrayName:"aDisplayedUsers",oInitialSorting:{userName:"asc"}});var m=function(a){for(var b=0;b<l.aData.length;b++){l.aData[b].sCompanies="";for(var c=0;c<l.aData[b]._companyDetails.results.length;c++)for(var d=0;d<a.length;d++)if(l.aData[b]._companyDetails.results[c].CompanyName===a[d].CompanyName){l.aData[b].sCompanies=l.aData[b].sCompanies+a[d].CompanyName+"; ";break}}},n=function(a){for(var b=0;b<l.aData.length;b++){l.aData[b].sRoles="";for(var c=0;c<l.aData[b]._roleDetails.results.length;c++)for(var d=0;d<a.length;d++)if(l.aData[b]._roleDetails.results[c].Guid===a[d].Guid){l.aData[b].sRoles=l.aData[b].sRoles+a[d].RoleName+"; ";break}}},o=function(b){for(var c=!1,d=0;d<b.length;d++){if(!k[h.oUserProfile.sCurrentRole].bIsGlobalUserAdministrator){c=!1;for(var f=0;f<b[d].CompanyDetails.results.length;f++)if(b[d].CompanyDetails.results[f].CompanyName===h.oUserProfile.sCurrentCompany){c=!0;break}if(!c)continue;c=!1;for(var f=0;f<b[d].RoleDetails.results.length;f++)if(k[b[d].RoleDetails.results[f].RoleName]&&k[b[d].RoleDetails.results[f].RoleName].bIsGlobalUserAdministrator&&b[d].UserName!==h.oUserProfile.sUserName){c=!0;break}if(c)continue}l.aData.push({userName:b[d].UserName,email:b[d].EMail,_roleDetails:b[d].RoleDetails,_companyDetails:b[d].CompanyDetails,_lastModifiedAt:b[d].LastModifiedAt,roles:""})}a.tableParams.reload(),e.getCompanies({bShowSpinner:!1,onSuccess:m}),e.getRoles({bShowSpinner:!1,onSuccess:n})};e.getUsersWithCompaniesPhasesAndRoles({bShowSpinner:!0,onSuccess:o}),a.onDisplay=function(a){c.go("app.adminPanel.userDetails",{sMode:"display",sUserName:a.userName})},a.onEdit=function(a){c.go("app.adminPanel.userDetails",{sMode:"edit",sUserName:a.userName})},a.onAddNew=function(){c.go("app.adminPanel.userDetails",{sMode:"create",sUserName:""})},a.$on("$destroy",function(){j.getPreviousStateName()!==b.sCurrentStateName&&j.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:b.oStateParams})})}]);
//# sourceMappingURL=conspector.min.js.map