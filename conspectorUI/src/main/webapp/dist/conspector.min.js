/*! conspector 27-01-2015 */

var app=angular.module("conspector",["ui.router","viewControllers","pascalprecht.translate","ngCookies","ngTable","ngResource","ngMaterial","multi-select","angularFileUpload","colorpicker.module","pubnub.angular.service","ngTagsInput","ngAnimate","filtersProvider"]),viewControllers=angular.module("viewControllers",[]);app.config(function(a){a.definePalette("conspectorColorPalette",{50:"55b0d0",100:"44a8cb",200:"33a0c6",300:"2298c1",400:"1190bd",500:"0088b8",600:"007da9",700:"00729b",800:"00678c",900:"005c7d",A100:"0088b8",A200:"0088b8",A400:"0088b8",A700:"0088b8",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),a.theme("default").primaryColor("conspectorColorPalette").accentColor("conspectorColorPalette"),a.definePalette("conspectorColorPaletteNavbar",{50:"8e9192",100:"838687",200:"787b7d",300:"6d7072",400:"616567",500:"565a5c",600:"4f5355",700:"484c4d",800:"414446",900:"3a3d3f",A100:"565a5c",A200:"565a5c",A400:"565a5c",A700:"565a5c",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:void 0}),a.theme("conspectorColorPaletteNavbar").primaryColor("conspectorColorPaletteNavbar").accentColor("conspectorColorPaletteNavbar")}),app.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/signIn"),a.state("signIn",{url:"/signIn",templateUrl:"apps/conspector/components/userManagement/templates/signInView.html",controller:"signInView"}),a.state("forgotPassword",{url:"/forgotPassword",templateUrl:"apps/conspector/components/userManagement/templates/forgotPasswordView.html",controller:"forgotPasswordView"}),a.state("initialPasswordReset",{url:"/initialPasswordReset",templateUrl:"apps/conspector/components/userManagement/templates/initialPasswordResetView.html",controller:"initialPasswordResetView"}),a.state("companySelection",{url:"/companySelection",templateUrl:"apps/conspector/components/userManagement/templates/companySelectionView.html",controller:"companySelectionView"}),a.state("roleSelection",{url:"/roleSelection",templateUrl:"apps/conspector/components/userManagement/templates/roleSelectionView.html",controller:"roleSelectionView"}),a.state("resetPassword",{url:"/resetPassword/:pr",templateUrl:"apps/conspector/components/userManagement/templates/passwordResetView.html",controller:"passwordResetView"}),a.state("app",{url:"/app",templateUrl:"apps/conspector/components/generalLayout/templates/appView.html",controller:"appView"}),a.state("app.deficienciesList",{url:"/deficienciesList",templateUrl:"apps/conspector/components/deficiencies/templates/deficienciesListView.html",controller:"deficienciesListView"}),a.state("app.unitsList",{url:"/unitsList",templateUrl:"apps/conspector/components/units/templates/unitsListView.html",controller:"unitsListView"}),a.state("app.contractorsList",{url:"/contractorsList",templateUrl:"apps/conspector/components/contractors/templates/contractorsListView.html",controller:"contractorsListView"}),a.state("app.contractorDetailsWrapper",{templateUrl:"apps/conspector/components/contractors/templates/contractorDetailsWrapperView.html",controller:"contractorDetailsWrapperView"}),a.state("app.contractorDetailsWrapper.contractorDetails",{url:"/contractorDetails/:sContractorGuid/:sMode",views:{contractorDetails:{templateUrl:"apps/conspector/components/contractors/templates/contractorDetailsView.html",controller:"contractorDetailsView"},contractorContacts:{templateUrl:"apps/conspector/components/contacts/templates/contactsListView.html",controller:"contactsListView"}}}),a.state("app.clientsList",{url:"/clientsList",templateUrl:"apps/conspector/components/clients/templates/clientsListView.html",controller:"clientsListView"}),a.state("app.clientDetailsWrapper",{templateUrl:"apps/conspector/components/clients/templates/clientDetailsWrapperView.html",controller:"clientDetailsWrapperView"}),a.state("app.clientDetailsWrapper.clientDetails",{url:"/clientDetails/:sClientGuid/:sMode",views:{clientDetails:{templateUrl:"apps/conspector/components/clients/templates/clientDetailsView.html",controller:"clientDetailsView"},clientContacts:{templateUrl:"apps/conspector/components/contacts/templates/contactsListView.html",controller:"contactsListView"}}}),a.state("app.contactsList",{url:"/contactsList",templateUrl:"apps/conspector/components/contacts/templates/contactsListView.html",controller:"contactsListView"}),a.state("app.contactDetailsWrapper",{templateUrl:"apps/conspector/components/contacts/templates/contactDetailsWrapperView.html",controller:"contactDetailsWrapperView"}),a.state("app.contactDetailsWrapper.contactDetails",{url:"/contactDetails/:sAccountGuid/:sContactGuid/:sMode",views:{contactDetails:{templateUrl:"apps/conspector/components/contacts/templates/contactDetailsView.html",controller:"contactDetailsView"}}}),a.state("app.adminPanel",{url:"/adminPanel",templateUrl:"apps/conspector/components/adminPanel/templates/adminPanelView.html",controller:"adminPanelView"}),a.state("app.adminPanel.companiesList",{url:"/companiesList",templateUrl:"apps/conspector/components/adminPanel/templates/companiesListView.html",controller:"companiesListView"}),a.state("app.adminPanel.usersList",{url:"/usersList",templateUrl:"apps/conspector/components/adminPanel/templates/usersListView.html",controller:"usersListView"}),a.state("app.adminPanel.userDetails",{url:"/userDetails/:sUserName/:sMode",templateUrl:"apps/conspector/components/adminPanel/templates/userDetailsView.html",controller:"userDetailsView"}),a.state("app.adminPanel.rolesList",{url:"/rolesList",templateUrl:"apps/conspector/components/adminPanel/templates/rolesListView.html",controller:"rolesListView"}),a.state("app.adminPanel.projectsList",{url:"/projectsList",templateUrl:"apps/conspector/components/adminPanel/templates/projectsListView.html",controller:"projectsListView"}),a.state("app.adminPanel.phasesList",{url:"/phasesList",templateUrl:"apps/conspector/components/adminPanel/templates/phasesListView.html",controller:"phasesListView"}),a.state("app.adminPanel.deficiencyStatusesList",{url:"/deficiencyStatusesList",templateUrl:"apps/conspector/components/adminPanel/templates/deficiencyStatusesListView.html",controller:"deficiencyStatusesListView"}),a.state("app.adminPanel.systemFiles",{url:"/systemFiles",templateUrl:"apps/conspector/components/adminPanel/templates/systemFilesView.html",controller:"systemFilesView"}),a.state("app.adminPanel.operationLogsList",{url:"/operationLogsList",templateUrl:"apps/conspector/components/adminPanel/templates/operationLogsListView.html",controller:"operationLogsListView"}),a.state("app.adminPanel.accountTypesList",{url:"/accountTypesList",templateUrl:"apps/conspector/components/adminPanel/templates/accountTypesListView.html",controller:"accountTypesListView"}),a.state("app.adminPanel.contactTypesList",{url:"/contactTypesList",templateUrl:"apps/conspector/components/adminPanel/templates/contactTypesListView.html",controller:"contactTypesListView"}),a.state("app.adminPanel.deficiencyPrioritiesList",{url:"/deficiencyPrioritiesList",templateUrl:"apps/conspector/components/adminPanel/templates/deficiencyPrioritiesListView.html",controller:"deficiencyPrioritiesListView"}),a.state("app.profileSettings",{url:"/profileSettings",templateUrl:"apps/conspector/components/profileSettings/templates/profileSettingsView.html",controller:"profileSettingsView"}),a.state("app.profileSettings.profileDetails",{url:"/profileDetails",templateUrl:"apps/conspector/components/profileSettings/templates/profileDetailsView.html",controller:"profileDetailsView"}),a.state("app.profileSettings.changePassword",{url:"/changePassword",templateUrl:"apps/conspector/components/profileSettings/templates/changePasswordView.html",controller:"changePasswordView"})}]),app.factory("CONSTANTS",[function(){return{messageDisplayTime:5e3,messageDisplayLayout:"topCenter",currentProject:"conspector",appPathname:"",sServicePath:"odata.svc/",sDefaultRoleNameForNewCompany:"systemAdministrator",sGlobalAdministatorRole:"globalAdministrator"}}]),app.factory("TYPES",[function(){return{oEntityCacheStructure:{aCachedRequests:[],sListSearchFilter:"",oListColumnFilters:{},oListSelectCriterias:{}}}}]),app.factory("rolesSettings",[function(){return{oInitialViews:{globalAdministrator:"app.deficienciesList",systemAdministrator:"app.deficienciesList",managementUser:"app.deficienciesList",contactManagementUser:"app.contactsList"},oDisplayedSections:{globalAdministrator:{deficiencies:!0,units:!0,contractors:!0,clients:!0,contacts:!0,adminPanel:!0,profileSettings:!0},systemAdministrator:{deficiencies:!0,units:!0,contractors:!0,clients:!0,contacts:!0,adminPanel:!0,profileSettings:!0},managementUser:{deficiencies:!0,units:!0,contractors:!0,clients:!0,contacts:!0,adminPanel:!1,profileSettings:!0},contactManagementUser:{deficiencies:!1,units:!1,contractors:!0,clients:!0,contacts:!0,adminPanel:!1,profileSettings:!0}}}}]),app.factory("cacheProvider",["TYPES",function(a){return{oEntitiesCache:{oDeficiencyEntity:angular.copy(a.oEntityCacheStructure),oAccountEntity:angular.copy(a.oEntityCacheStructure),oUnitEntity:angular.copy(a.oEntityCacheStructure),oCompanyEntity:angular.copy(a.oEntityCacheStructure),oUserEntity:angular.copy(a.oEntityCacheStructure),oRoleEntity:angular.copy(a.oEntityCacheStructure),oProjectEntity:angular.copy(a.oEntityCacheStructure),oPhaseEntity:angular.copy(a.oEntityCacheStructure),oRoleEntity:angular.copy(a.oEntityCacheStructure),oOperationLogEntity:angular.copy(a.oEntityCacheStructure),oTaskStatusEntity:angular.copy(a.oEntityCacheStructure),oTaskPriorityEntity:angular.copy(a.oEntityCacheStructure),oPriorityEntity:angular.copy(a.oEntityCacheStructure),oAccountTypeEntity:angular.copy(a.oEntityCacheStructure),oContactTypeEntity:angular.copy(a.oEntityCacheStructure),oCountryEntity:angular.copy(a.oEntityCacheStructure),oContactEntity:angular.copy(a.oEntityCacheStructure)},oUserProfile:{},getFromCache:function(a,b){for(var c=0;c<this.oEntitiesCache[a].aCachedRequests.length;c++)if(this.oEntitiesCache[a].aCachedRequests[c].sRequestSettings===b)return this.oEntitiesCache[a].aCachedRequests[c].aEntitiesArray;return[]},putToCache:function(a,b,c){this.oEntitiesCache[a].aCachedRequests.push({sRequestSettings:b,aEntitiesArray:c})},cleanEntitiesCache:function(b,c){if(b&&!c)return void(this.oEntitiesCache[b]=angular.copy(a.oEntityCacheStructure));if(b&&c){for(var d=0;d<this.oEntitiesCache[b].aCachedRequests.length;d++)if(this.oEntitiesCache[b].aCachedRequests[d].sRequestSettings===c){this.oEntitiesCache[b].aCachedRequests.splice(d,1);break}}else for(var e in this.oEntitiesCache)this.oEntitiesCache[e]=angular.copy(a.oEntityCacheStructure)},cleanProfileCache:function(){this.oUserProfile={}},cleanAllCache:function(){this.cleanEntitiesCache(),this.cleanProfileCache()},getEntityDetails:function(a){for(var b={},c=0;c<this.oEntitiesCache[a.sCacheProviderAttribute].aCachedRequests.length;c++)if(this.oEntitiesCache[a.sCacheProviderAttribute].aCachedRequests[c].sRequestSettings===a.sRequestSettings){for(var d=0;d<this.oEntitiesCache[a.sCacheProviderAttribute].aCachedRequests[c].aEntitiesArray.length;d++)if(this.oEntitiesCache[a.sCacheProviderAttribute].aCachedRequests[c].aEntitiesArray[d][a.sKeyName]===a.sKeyValue){b=angular.copy(this.oEntitiesCache[a.sCacheProviderAttribute].aCachedRequests[c].aEntitiesArray[d]),console.log("Entitiy: "+a.sCacheProviderAttribute+" retrieved from cache...");break}break}return b}}}]),app.factory("utilsProvider",["$mdToast",function(a){return{displayMessage:function(b){var c=a.simple();c.content(b.sText),c.hideDelay(2e3),c.position("top right"),a.show(c)},generateGUID:function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:7&c|8).toString(16)});return b},dateToDBDate:function(a){var b=a.getTime()-a.getTime()%1e3;return"/Date("+b.toString()+")/"},dateToString:function(a){var b="",c=a.getDate().toString(),d=(a.getMonth()+1).toString(),e=a.getFullYear(),f=a.getHours();1===f.toString().length&&(f="0"+f);var g=a.getMinutes();1===g.toString().length&&(g="0"+g);var h=a.getSeconds();return 1===h.toString().length&&(h="0"+h),1===c.length&&(c="0"+c),1===d.length&&(d="0"+d),b=d+"."+c+"."+e+" "+f+":"+g+":"+h},dBDateToDate:function(a){if(null===a||void 0===a||""===a)return a;var b=a.substring(6,a.length-2),c=new Date(parseInt(b));return c},dBDateToSting:function(a){return null===a||void 0===a||""===a?a:this.dateToString(this.dBDateToDate(a))},stringToJson:function(a){var b=$.parseJSON(a);return b},setCookieFromJson:function(a,b){$.removeCookie(a),$.cookie(a,JSON.stringify(b))},getJsonCookie:function(a){return $.cookie(a)?JSON.parse($.cookie(a)):void 0},removeCookie:function(a){$.removeCookie(a)},convertJsonArrayToString:function(a){sReturn="[";for(var b=0;b<a.length;b++){sReturn+="{";var c=[];for(var d in a[b])c.push(d);for(var e=0;e<c.length;e++)sReturn=e!=c.length-1?sReturn+'"'+c[e]+'":"'+a[b][c[e]]+'", ':sReturn+'"'+c[e]+'":"'+a[b][c[e]]+'"';sReturn+=b!=a.length-1?"}, ":"}"}return sReturn+="]",sReturn},getParameterByName:function(a){var b=window.location.href.replace("#","");a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))},tagsStringToTagsArray:function(a){var b=[],c=[];if(null===a||void 0===a||""===a)return b;a=a.substring(0,a.length-1),c=a.split(";");for(var d=0;d<c.length;d++)b.push({text:c[d]});return b},tagsArrayToTagsString:function(a){for(var b="",c=0;c<a.length;c++)b=0!==c?b+" "+a[c].text+";":b+a[c].text+";";return b}}}]),app.config(["$translateProvider",function(a){a.translations("en",{global_addNew:"Add New",global_actions:"Actions",global_descriptionEN:"Description EN",global_descriptionFR:"Description FR",global_sortingSequence:"Sorting sequence",global_successOperation:"Operation finished successfully.",global_errorOperation:"Operation failed.",global_noDefaultViewForTheRole:"Contact your system administrator (No default view assignment to the role)",global_noCompanyAssignment:"Contact your system administrator (No company assignment to the user)",global_noRoleAssignment:"Contact your system administrator (No role assignment to the user)",global_noInitialPasswordProvided:"No initial password has been provided. User creation is not possible",global_changesSaveConfirmationHeader:"Do you want to save changes before leaving the view?",global_changesSaveConfirmationContent:"Not saved changes will be lost...",global_emptyFields:"Please make sure that all the fields are filled",global_companies:"Assigned Companies:",global_authorizedPhases:"Authorized projects and phases:",global_avatar:"Avatar:",global_noTableData:"No data selected",global_createdBy:"Created By",global_createdAt:"Created At",global_role:"Role",global_company:"Company",global_roles:"Role(s)",global_companies:"Company(s)",global_project:"Project",global_upload:"Upload",global_icon:"Icon",global_userName:"Username",global_email:"Email",global_emailPlaceholder:"e.g. sara@conspector.com",global_back:"Back",global_edit:"Edit",global_save:"Save",global_delete:"Delete",global_saveAndNew:"Save and new",global_creationDate:"Creation Date",global_lastModificationDate:"Last Modification Date",global_associatedIconFileGuid:"Associated Icon File Guid",global_associatedColor:"Associated Color",global_password:"Password",global_passwordConfirmation:"Password Confirmation",global_continue:"Continue",global_ok:"Ok",global_yes:"Yes",global_no:"No",global_cancel:"Cancel",global_passwordsDontMatch:"Provided passwords don't match.",global_contractorName:"Contractor",global_clientName:"Client",global_phone:"Phone",global_phonePlaceholder:"e.g. 514-123-1234",global_tags:"Tags",global_name:"Name",global_title:"Title",global_secondaryPhone:"Secondary Phone",global_website:"Website",global_websitePlaceholder:"e.g. www.website.com",global_fax:"Fax",global_associatedPhases:"Associated projects and phases:",global_selectedProjectsAndPhases:"Select Project(s) - Phase(s)",global_billingStreet:"Billing street",global_billingStreetPlaceholder:"e.g. 1010 Brian #213",global_billingCity:"Billing city",global_billingCityPlaceholder:"e.g. Nassau",global_billingPostalCode:"Billing postal code",global_billingPostalCodePlaceholder:"e.g. J01 E24",global_billingCountry:"Billing country:",global_billingProvince:"Billing state/province:",global_shippingStreet:"Shipping street",global_shippingStreetPlaceholder:"e.g. 1010 Brian #213 A",global_shippingCity:"Shipping city",global_shippingCityPlaceholder:"e.g. Nassau",global_shippingPostalCode:"Shipping postal code",global_shippingPostalCodePlaceholder:"e.g. J01 E24",global_shippingCountry:"Shipping country:",global_shippingProvince:"Shipping state/province:",global_tags:"Tags",global_addTag:"Add a tag",global_contactType:"Contact Type:",global_account:"Account",global_selectCountry:"Select Country",global_selectState:"Select Province/State",m100:"Operation finished successfully.",m101:"Email with instructions to recover your password was successfully sent.",m102:"Your password was successfully changed.",m200:"Username already exists",m201:"User with provided email already exists",m203:"Can not login. Check your Username and Password.",m204:"Email not found.",m205:"Provided Old Password is not correct",m206:"Username not found",app_switchCompanies:"Switch Company",app_switchRoles:"Switch Role",app_logOut:"Log Out",app_adminPanel:"Admin Panel",app_profileSettings:"Profile Settings",app_deficienciesTab:"Deficiencies",app_unitsTab:"Units",app_contractorsTab:"Contractors",app_clientsTab:"Clients",app_contactsTab:"Contacts",profileSettings_menuHeader:"User Menu",profileSettings_profileDetails:"User Profile",profileSettings_changePassword:"Change Password",profileSettings_hideSidenav:"Open User Menu",profileDetails_title:"User Profile",changePassword_title:"Change Password",changePassword_resetPassword:"Change Password",changePassword_newPassword:"New Password",changePassword_newPasswordConfirmation:"New Password Confirmation",adminPanel_menuHeader:"Admin Panel Menu",adminPanel_companies:"Companies",adminPanel_userManagement:"User Management",adminPanel_roles:"User Roles",adminPanel_projects:"Projects",adminPanel_projectDefaultLabel:"Select Project",adminPanel_phases:"Phases",adminPanel_deficiencyStatuses:"Deficiency Statuses",adminPanel_deficiencyStatusIconDefaultLabel:"Select Icon",adminPanel_deficiencyPriorities:"Deficiency Priorities",adminPanel_systemFiles:"System Files",adminPanel_operationLogs:"Operation Logs",adminPanel_accountTypes:"Account Types",adminPanel_contactTypes:"Contact Types",adminPanel_hideSidenav:"Open Admin Panel Menu",companiesList_title:"Companies",companiesList_companyName:"Company Name",usersList_title:"Users List",userDetails_title:"User Details",userDetails_deletionConfirmationHeader:"Are you sure that you want to delete current user?",userDetails_deletionConfirmationContent:"Current user will be deleted...",userDetails_username:"Username:",userDetails_password:"Password:",userDetails_passwordConfirmation:"Password Confirmation:",userDetails_email:"Email:",userDetails_associatedCompanies:"Associated Companies:",userDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",userDetails_associatedRoles:"Roles:",userDetails_avatar:"Profile Picture:",rolesList_title:"User Roles",rolesList_roleName:"Role Name",projectsList_title:"Projects",phasesList_title:"Phases",deficiencyStatuses_title:"Deficiency Statuses",deficiencyPriorities_title:"Deficiency Priorities",operationLogsList_title:"Operation Logs",operationLogsList_operationName:"Operation Name",operationLogsList_operationContent:"Operation Content",accountTypesList_title:"Account Types",contactTypesList_title:"Contact Types",systemFiles_title:"System Files",systemFiles_logos:"Logos",systemFiles_logo:"Logo",systemFiles_deficiencyStatusIcon:"Deficiency Status Icons",systemFiles_Icon:"Icon",signIn_userName:"Username",signIn_password:"Password",signIn_logIn:"Log In to Conspector",signIn_languageCode:"FR",signIn_forgotPassword:"Forgot your password?",signIn_rememberUserName:"Remember Username",initialPasswordReset_headerLabel:"This is the first time you login. Please enter a new password:",initialPasswordReset_newPassword:"New password",initialPasswordReset_newPasswordConfirmation:"New password confirmation",initialPasswordReset_reset:"Set new password",passwordReset_headerLabel:"Please enter a new password:",passwordReset_newPassword:"New password",passwordReset_newPasswordConfirmation:"New password confirmation",passwordReset_reset:"Set new password",passwordReset_passwordsDontMatch:"Provided passwords don't match.",companySelection_heagerLabel:"Please choose a company:",roleSelection_heagerLabel:"Please choose a role:",forgotPassword_heagerLabel:"Please select what you remember:",forgotPassword_userName:"Username",forgotPassword_email:"Email",forgotPassword_reset:"Reset password",forgotPassword_footerLabel:"Having issues logging in?\nEmail us at ",contractorsList_title:"Contractors List",contractorsList_addNew:"Add Contractor",contractorDetails_title:"Contractor Details",contractorDetails_deletionConfirmationHeader:"You are about to delete a contractor account.",contractorDetails_deletionConfirmationContent:"Are you sure you want to proceed ? All related contacts will be erased.",contractorDetails_name:"Name:",contractorDetails_namePlaceholder:"e.g. ABC Construction",contractorDetails_phone:"Phone:",contractorDetails_secondaryPhone:"Secondary Phone:",contractorDetails_website:"Website:",contractorDetails_email:"Email:",contractorDetails_fax:"Fax:",contractorDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",contractorDetails_descriptionTags:"Description Tags:",contractorDetails_billingStreet:"Billing Street:",contractorDetails_billingCity:"Billing City:",contractorDetails_billingPostalCode:"Postal Code/ZIP:",contractorDetails_billingCountry:"Billing Country:",contractorDetails_billingState:"Billing State/Province:",contractorDetails_shippingStreet:"Shipping Street:",contractorDetails_shippingCity:"Shipping City:",contractorDetails_shippingPostalCode:"Postal Code/ZIP:",contractorDetails_shippingCountry:"Shipping Country:",contractorDetails_shippingState:"Shipping State/Province:",contactsList_title:"Contacts List",contactDetails_title:"Contact Details",contactsList_addNew:"Add Contact",contactDetails_title:"Contact Details",contactDetails_deletionConfirmationHeader:"You are about to delete a contact.",contactDetails_deletionConfirmationContent:"Are you sure you want to proceed ?",contactDetails_name:"Name:",contactDetails_namePlaceholder:"e.g. Sara",contactDetails_lastName:"Last Name:",contactDetails_lastNamePlaceholder:"e.g. Smith",contactDetails_personTitle:"Title:",contactDetails_personTitlePlaceholder:"e.g. Ms, Director",contactDetails_homePhone:"Home Phone:",contactDetails_workPhone:"Work Phone:",contactDetails_mobilePhone:"Mobile Phone:",contactDetails_email:"Email:",contactDetails_fax:"Fax:",contactDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",contactDetails_associatedParentAccount:"Parent Account:",contactDetails_selectParentAccount:"Select Parent Account:",contactDetails_contactType:"Contact Type:",contactDetails_selectContactType:"Select Contact Type:",contactDetails_descriptionTags:"Description Tags:",contactDetails_billingStreet:"Billing Street:",contactDetails_billingCity:"Billing City:",contactDetails_billingPostalCode:"Postal Code/ZIP:",contactDetails_billingCountry:"Billing Country:",contactDetails_billingState:"Billing State/Province:",contactDetails_shippingStreet:"Shipping Street:",contactDetails_shippingCity:"Shipping City:",contactDetails_shippingPostalCode:"Postal Code/ZIP:",contactDetails_shippingCountry:"Shipping Country:",contactDetails_shippingState:"Shipping State/Province:",clientsList_title:"Clients List",clientsList_addNew:"Add Client Account",clientDetails_title:"Client Details",clientDetails_deletionConfirmationHeader:"You are about to delete a client account.",clientDetails_deletionConfirmationContent:"Are you sure you want to proceed ? All related contacts will be erased.",clientDetails_name:"Name:",clientDetails_namePlaceholder:"e.g. Sara Conspector",clientDetails_phone:"Phone:",clientDetails_secondaryPhone:"Secondary Phone:",clientDetails_website:"Website:",clientDetails_email:"Email:",clientDetails_fax:"Fax:",clientDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",clientDetails_descriptionTags:"Description Tags:",clientDetails_billingStreet:"Billing Street:",clientDetails_billingCity:"Billing City:",clientDetails_billingPostalCode:"Postal Code/ZIP:",clientDetails_billingCountry:"Billing Country:",clientDetails_billingState:"Billing State/Province:",clientDetails_shippingStreet:"Shipping Street:",clientDetails_shippingCity:"Shipping City:",clientDetails_shippingPostalCode:"Postal Code/ZIP:",clientDetails_shippingCountry:"Shipping Country:",clientDetails_shippingState:"Shipping State/Province:"}),a.translations("fr",{global_addNew:"Add New",global_actions:"Actions",global_descriptionEN:"Description EN",global_descriptionFR:"Description FR",global_sortingSequence:"Sorting sequence",global_successOperation:"Operation finished successfully.",global_errorOperation:"Operation failed.",global_noDefaultViewForTheRole:"Contact your system administrator (No default view assignment to the role)",global_noCompanyAssignment:"Contact your system administrator (No company assignment to the user)",global_noRoleAssignment:"Contact your system administrator (No role assignment to the user)",global_noInitialPasswordProvided:"No initial password has been provided. User creation is not possible",global_changesSaveConfirmationHeader:"Do you want to save changes before leaving the view?",global_changesSaveConfirmationContent:"Not saved changes will be lost...",global_emptyFields:"Please make sure that all the fields are filled",global_companies:"Assigned Companies:",global_authorizedPhases:"Authorized projects and phases:",global_avatar:"Avatar:",global_noTableData:"No data selected",global_createdBy:"Created By",global_createdAt:"Created At",global_role:"Role",global_company:"Company",global_roles:"Role(s)",global_companies:"Company(s)",global_project:"Project",global_upload:"Upload",global_icon:"Icon",global_userName:"Username",global_email:"Email",global_emailPlaceholder:"e.g. sara@conspector.com",global_back:"Back",global_edit:"Edit",global_save:"Save",global_delete:"Delete",global_saveAndNew:"Save and new",global_creationDate:"Creation Date",global_lastModificationDate:"Last Modification Date",global_associatedIconFileGuid:"Associated Icon File Guid",global_associatedColor:"Associated Color",global_password:"Password",global_passwordConfirmation:"Password Confirmation",global_continue:"Continue",global_ok:"Ok",global_yes:"Yes",global_no:"No",global_cancel:"Cancel",global_passwordsDontMatch:"Provided passwords don't match.",global_contractorName:"Contractor",global_clientName:"Client",global_phone:"Phone",global_phonePlaceholder:"e.g. 514-123-1234",global_tags:"Tags",global_name:"Name",global_title:"Title",global_secondaryPhone:"Secondary Phone",global_website:"Website",global_websitePlaceholder:"e.g. www.website.com",global_fax:"Fax",global_associatedPhases:"Associated projects and phases:",global_selectedProjectsAndPhases:"Select Project(s) - Phase(s)",global_billingStreet:"Billing street",global_billingStreetPlaceholder:"e.g. 1010 Brian #213",global_billingCity:"Billing city",global_billingCityPlaceholder:"e.g. Nassau",global_billingPostalCode:"Billing postal code",global_billingPostalCodePlaceholder:"e.g. J01 E24",global_billingCountry:"Billing country:",global_billingProvince:"Billing state/province:",global_shippingStreet:"Shipping street",global_shippingStreetPlaceholder:"e.g. 1010 Brian #213 A",global_shippingCity:"Shipping city",global_shippingCityPlaceholder:"e.g. Nassau",global_shippingPostalCode:"Shipping postal code",global_shippingPostalCodePlaceholder:"e.g. J01 E24",global_shippingCountry:"Shipping country:",global_shippingProvince:"Shipping state/province:",global_tags:"Tags",global_addTag:"Add a tag",global_contactType:"Contact Type:",global_account:"Account",global_selectCountry:"Select Country",global_selectState:"Select Province/State",m100:"Operation finished successfully.",m101:"Email with instructions to recover your password was successfully sent.",m102:"Your password was successfully changed.",m200:"Username already exists",m201:"User with provided email already exists",m203:"Can not login. Check your Username and Password.",m204:"Email not found.",m205:"Provided Old Password is not correct",m206:"Username not found",app_switchCompanies:"Switch Company",app_switchRoles:"Switch Role",app_logOut:"Log Out",app_adminPanel:"Admin Panel",app_profileSettings:"Profile Settings",app_deficienciesTab:"Deficiencies",app_unitsTab:"Units",app_contractorsTab:"Contractors",app_clientsTab:"Clients",app_contactsTab:"Contacts",profileSettings_menuHeader:"User Menu",profileSettings_profileDetails:"User Profile",profileSettings_changePassword:"Change Password",profileSettings_hideSidenav:"Open User Menu",profileDetails_title:"User Profile",changePassword_title:"Change Password",changePassword_resetPassword:"Change Password",changePassword_newPassword:"New Password",changePassword_newPasswordConfirmation:"New Password Confirmation",adminPanel_menuHeader:"Admin Panel Menu",adminPanel_companies:"Companies",adminPanel_userManagement:"User Management",adminPanel_roles:"User Roles",adminPanel_projects:"Projects",adminPanel_projectDefaultLabel:"Select Project",adminPanel_phases:"Phases",adminPanel_deficiencyStatuses:"Deficiency Statuses",adminPanel_deficiencyStatusIconDefaultLabel:"Select Icon",adminPanel_deficiencyPriorities:"Deficiency Priorities",adminPanel_systemFiles:"System Files",adminPanel_operationLogs:"Operation Logs",adminPanel_accountTypes:"Account Types",adminPanel_contactTypes:"Contact Types",adminPanel_hideSidenav:"Open Admin Panel Menu",companiesList_title:"Companies",companiesList_companyName:"Company Name",usersList_title:"Users List",userDetails_title:"User Details",userDetails_deletionConfirmationHeader:"Are you sure that you want to delete current user?",userDetails_deletionConfirmationContent:"Current user will be deleted...",userDetails_username:"Username:",userDetails_password:"Password:",userDetails_passwordConfirmation:"Password Confirmation:",userDetails_email:"Email:",userDetails_associatedCompanies:"Associated Companies:",userDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",userDetails_associatedRoles:"Roles:",userDetails_avatar:"Profile Picture:",rolesList_title:"User Roles",rolesList_roleName:"Role Name",projectsList_title:"Projects",phasesList_title:"Phases",deficiencyStatuses_title:"Deficiency Statuses",deficiencyPriorities_title:"Deficiency Priorities",operationLogsList_title:"Operation Logs",operationLogsList_operationName:"Operation Name",operationLogsList_operationContent:"Operation Content",accountTypesList_title:"Account Types",contactTypesList_title:"Contact Types",systemFiles_title:"System Files",systemFiles_logos:"Logos",systemFiles_logo:"Logo",systemFiles_deficiencyStatusIcon:"Deficiency Status Icons",systemFiles_Icon:"Icon",signIn_userName:"Username",signIn_password:"Password",signIn_logIn:"Connexion à Conspector",signIn_languageCode:"EN",signIn_forgotPassword:"Forgot your password?",signIn_rememberUserName:"Remember Username",initialPasswordReset_headerLabel:"This is the first time you login. Please enter a new password:",initialPasswordReset_newPassword:"New password",initialPasswordReset_newPasswordConfirmation:"New password confirmation",initialPasswordReset_reset:"Set new password",passwordReset_headerLabel:"Please enter a new password:",passwordReset_newPassword:"New password",passwordReset_newPasswordConfirmation:"New password confirmation",passwordReset_reset:"Set new password",passwordReset_passwordsDontMatch:"Provided passwords don't match.",companySelection_heagerLabel:"Please choose a company:",roleSelection_heagerLabel:"Please choose a role:",forgotPassword_heagerLabel:"Please select what you remember:",forgotPassword_userName:"Username",forgotPassword_email:"Email",forgotPassword_reset:"Reset password",forgotPassword_footerLabel:"Un problème de connexion?\nÉcrivez à ",contractorsList_title:"Contractors List",contractorsList_addNew:"Add Contractor",contractorDetails_title:"Contractor Details",contractorDetails_deletionConfirmationHeader:"You are about to delete a client account.",contractorDetails_deletionConfirmationContent:"Are you sure you want to proceed ? All related contacts will be erased.",contractorDetails_name:"Name:",contractorDetails_namePlaceholder:"e.g. ABC Construction",contractorDetails_phone:"Phone:",contractorDetails_secondaryPhone:"Secondary Phone:",contractorDetails_website:"Website:",contractorDetails_email:"Email:",contractorDetails_fax:"Fax:",contractorDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",contractorDetails_descriptionTags:"Description Tags:",contractorDetails_billingStreet:"Billing Street:",contractorDetails_billingCity:"Billing City:",contractorDetails_billingPostalCode:"Postal Code/ZIP:",contractorDetails_billingCountry:"Billing Country:",contractorDetails_billingState:"Billing State/Province:",contractorDetails_shippingStreet:"Shipping Street:",contractorDetails_shippingCity:"Shipping City:",contractorDetails_shippingPostalCode:"Postal Code/ZIP:",contractorDetails_shippingCountry:"Shipping Country:",contractorDetails_shippingState:"Shipping State/Province:",contactsList_title:"Contacts List",contactsList_addNew:"Add Contact",contactDetails_title:"Contact Details",contactDetails_deletionConfirmationHeader:"You are about to delete a contact.",contactDetails_deletionConfirmationContent:"Are you sure you want to proceed ?",contactDetails_name:"Name:",contactDetails_namePlaceholder:"e.g. Sara",contactDetails_lastName:"Last Name:",contactDetails_lastNamePlaceholder:"e.g. Smith",contactDetails_personTitle:"Title:",contactDetails_personTitlePlaceholder:"e.g. Ms, Director",contactDetails_homePhone:"Home Phone:",contactDetails_workPhone:"Work Phone:",contactDetails_mobilePhone:"Mobile Phone:",contactDetails_email:"Email:",contactDetails_fax:"Fax:",contactDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",contactDetails_associatedParentAccount:"Parent Account:",contactDetails_selectParentAccount:"Select Parent Account:",contactDetails_contactType:"Contact Type:",contactDetails_selectContactType:"Select Contact Type:",contactDetails_descriptionTags:"Description Tags:",contactDetails_billingStreet:"Billing Street:",contactDetails_billingCity:"Billing City:",contactDetails_billingPostalCode:"Postal Code/ZIP:",contactDetails_billingCountry:"Billing Country:",contactDetails_billingState:"Billing State/Province:",contactDetails_shippingStreet:"Shipping Street:",contactDetails_shippingCity:"Shipping City:",contactDetails_shippingPostalCode:"Postal Code/ZIP:",contactDetails_shippingCountry:"Shipping Country:",contactDetails_shippingState:"Shipping State/Province:",clientsList_title:"Clients List",clientsList_addNew:"Add Client Account",clientDetails_title:"Client Details",clientDetails_deletionConfirmationHeader:"You are about to delete a client account.",clientDetails_deletionConfirmationContent:"Are you sure you want to proceed ? All related contacts will be erased.",clientDetails_name:"Name:",clientDetails_namePlaceholder:"e.g. Sara Conspector",clientDetails_phone:"Phone:",clientDetails_secondaryPhone:"Secondary Phone:",clientDetails_website:"Website:",clientDetails_email:"Email:",clientDetails_fax:"Fax:",clientDetails_associatedProjectsAndPhases:"Associated Projects and Phases:",clientDetails_descriptionTags:"Description Tags:",clientDetails_billingStreet:"Billing Street:",clientDetails_billingCity:"Billing City:",clientDetails_billingPostalCode:"Postal Code/ZIP:",clientDetails_billingCountry:"Billing Country:",clientDetails_billingState:"Billing State/Province:",clientDetails_shippingStreet:"Shipping Street:",clientDetails_shippingCity:"Shipping City:",clientDetails_shippingPostalCode:"Postal Code/ZIP:",clientDetails_shippingCountry:"Shipping Country:",clientDetails_shippingState:"Shipping State/Province:"}),a.preferredLanguage("en"),a.useCookieStorage()
}]),app.factory("genericODataFactory",["$resource","CONSTANTS",function(a,b){var c=b.sServicePath;return a("",{},{getEntitySetWithFilterAndExpand:{method:"GET",url:c+":path?$filter=:filter&$expand=:expand&$format=json"},getEntitySetWithFilter:{method:"GET",url:c+":path?$filter=:filter&$format=json"},getEntitySetWithExpand:{method:"GET",url:c+":path?$expand=:expand&$format=json"},getEntitySet:{method:"GET",url:c+":path?$format=json"},getLinks:{method:"GET",url:c+":sParentEntityWithKey/$links/:sRelationName"},post:{method:"POST",url:c+":path"},put:{method:"PUT",params:{key:"@key"},url:c+":path(':key')"},getEntity:{method:"GET",params:{key:"@key"},url:c+":path(':key')?$format=json"},getEntityWithFilter:{method:"GET",params:{key:"@key"},url:c+":path(':key')?$filter=:filter&$format=json"},getEntityWithExpand:{method:"GET",params:{key:"@key"},url:c+":path(':key')?$expand=:expand&$format=json"},getEntityWithFilterAndExpand:{method:"GET",params:{key:"@key"},url:c+":path(':key')?$filter=:filter&$expand=:expand&$format=json"},"delete":{method:"DELETE",params:{key:"@key"},url:c+":path(':key')"}})}]),app.factory("dataProvider",["genericODataFactory","utilsProvider","$q","$rootScope","$http","$translate","cacheProvider","$window","CONSTANTS",function(a,b,c,d,e,f,g,h,i){return{commonOnSuccess:function(a){a.bShowSpinner&&d.$emit("UNLOAD"),a.bShowSuccessMessage&&b.displayMessage({sText:f.instant("global_successOperation"),sType:"success"})},commonOnError:function(a,c){a.bShowSpinner&&d.$emit("UNLOAD"),a.bShowErrorMessage&&b.displayMessage({sText:f.instant("global_errorOperation"),sType:"error"}),c&&c.reject()},getEntitySet:function(b){var e={},f=c.defer(),g=[],h="";return b.sKey&&(h=b.sKey),b.sFilter&&(h+=b.sFilter),b.sExpand&&(h+=b.sExpand),h||(h=""),b.oCacheProvider&&b.sCacheProviderAttribute&&(g=b.oCacheProvider.getFromCache(b.sCacheProviderAttribute,h),g.length)?(console.log("Entities: "+b.sCacheProviderAttribute+" retrieved from cache..."),g):(b.bShowSpinner&&d.$emit("LOAD"),b.sFilter&&b.sExpand&&(e=(new a).$getEntitySetWithFilterAndExpand({path:b.sPath,expand:b.sExpand,filter:b.sFilter})),b.sFilter&&!b.sExpand&&(e=(new a).$getEntitySetWithFilter({path:b.sPath,filter:b.sFilter})),!b.sFilter&&b.sExpand&&(e=(new a).$getEntitySetWithExpand({path:b.sPath,expand:b.sExpand})),b.sFilter||b.sExpand||(e=(new a).$getEntitySet({path:b.sPath})),e.then($.proxy(function(a){b.oCacheProvider&&b.sCacheProviderAttribute&&a.d.results.length&&b.oCacheProvider.putToCache(b.sCacheProviderAttribute,h,a.d.results),this.commonOnSuccess(b),f.resolve(a.d.results)},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise)},getEntity:function(b){var e={},f=c.defer();return b.bShowSpinner&&d.$emit("LOAD"),b.sFilter&&!b.sExpand&&(e=(new a).$getEntityWithFilter({path:b.sPath,key:b.sKey,expand:b.sExpand})),!b.sFilter&&b.sExpand&&(e=(new a).$getEntityWithExpand({path:b.sPath,key:b.sKey,expand:b.sExpand})),b.sFilter&&b.sExpand&&(e=(new a).$getEntityWithFilterAndExpand({path:b.sPath,filter:b.sFilter,key:b.sKey,expand:b.sExpand})),b.sFilter||b.sExpand||(e=(new a).$getEntity({path:b.sPath,key:b.sKey})),e.then($.proxy(function(a){this.commonOnSuccess(b),f.resolve(a.d)},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise},getLinks:function(b){var d={},e=c.defer(),f="";return f=b.sParentEntity+"('"+b.sParentKey+"')",d=(new a).$getLinks({path:b.sParentEntity,sParentEntity:f,sRelationName:b.sRelationName}),d.then(function(a){e.resolve(a.d)}),e.promise},updateLinks:function(a){for(var b={__batchRequests:[]},c={},d={},e=[],f="",h="",j=!1,k=function(a){a.d.CompanyName===g.oUserProfile.sCurrentCompany&&g.oUserProfile.sCurrentCompany&&a.d.CompanyName||(j=!0)},l=0;l<a.aLinks.length;l++)c={},c.requestUri=a.sParentEntityWithKey+"/$links/"+a.aLinks[l].sRelationName,c.method="GET",b.__batchRequests.push(c);d=this.batchRequest({oRequestData:b}),d.then($.proxy(function(g){b={__batchRequests:[]};for(var l=0;l<g.length;l++){e=[];for(var m=0;m<g[l].data.results.length;m++)j=!1,c={},h=g[l].data.results[m].uri.substring(g[l].data.results[m].uri.indexOf("'")+1,g[l].data.results[m].uri.lastIndexOf("'")),a.aLinks[l].bKeepCompanyDependentLinks&&this.ajaxRequest({bAsync:!1,oData:{},sRequestType:"GET",sDataType:"json",sPath:i.sServicePath+a.aLinks[l].sRelationName.substring(0,a.aLinks[l].sRelationName.length-7)+"s('"+h+"')",oEventHandlers:{onSuccess:k}}),j||(f=a.aLinks[l].sRelationName+"('"+h+"')",c.requestUri=a.sParentEntityWithKey+"/$links/"+f,c.method="DELETE",e.push(c));e.length&&this.constructChangeBlockForBatch({oRequestData:b,aData:e})}b.__batchRequests.length?(d=this.batchRequest({oRequestData:b}),d.then($.proxy(function(){this.createLinks(a)},this))):this.createLinks(a)},this))},updateEntity:function(e){var f={},h={},i=c.defer();e.bShowSpinner&&d.$emit("LOAD");var h=this.getEntity({sKey:e.sKey,sPath:e.sPath});return h.then($.proxy(function(c){var d={};d=angular.copy(e.oData),c.LastModifiedAt===d.LastModifiedAt?(d.LastModifiedAt=b.dateToDBDate(new Date),d.GeneralAttributes||(d.GeneralAttributes={}),d.GeneralAttributes.LastModifiedBy=g.oUserProfile.sUserName,d.GeneralAttributes.IsDeleted||(d.GeneralAttributes.IsDeleted=!1),d.GeneralAttributes.IsArchived||(d.GeneralAttributes.IsArchived=!1),d.GeneralAttributes.SortingSequence||(d.GeneralAttributes.SortingSequence=0),f=new a(d).$put({path:e.sPath,key:e.sKey}),f.then($.proxy(function(a){if(e.aLinks&&e.aLinks.length){var b=e.sPath+"('"+a[e.sKeyAttribute]+"')";this.updateLinks({aLinks:e.aLinks,sParentEntityWithKey:b,onSuccess:$.proxy(function(){this.commonOnSuccess(e),i.resolve(a)},this)})}else this.commonOnSuccess(e),i.resolve(a)},this),$.proxy(function(){this.commonOnError(e,i)},this))):this.commonOnError(e,i)},this)),i.promise},createLinks:function(a){for(var b={__batchRequests:[]},c=[],d={},e={},f=0;f<a.aLinks.length;f++){c=[];for(var g=0;g<a.aLinks[f].aUri.length;g++)d={},d.requestUri=a.sParentEntityWithKey+"/$links/"+a.aLinks[f].sRelationName,d.method="POST",d.data={uri:a.aLinks[f].aUri[g]},c.push(d);c.length&&this.constructChangeBlockForBatch({oRequestData:b,aData:c})}e=this.batchRequest({oRequestData:b}),e.then(function(){a.onSuccess&&a.onSuccess()})},createEntity:function(e){var f={},h={},i=c.defer();return e.bShowSpinner&&d.$emit("LOAD"),h=angular.copy(e.oData),e.bGuidNeeded&&(h.Guid=b.generateGUID()),e.bCompanyNeeded&&!h.CompanyName&&(h.CompanyName=g.oUserProfile.sCurrentCompany),h.CreatedAt=b.dateToDBDate(new Date),h.LastModifiedAt=h.CreatedAt,h.GeneralAttributes||(h.GeneralAttributes={}),h.GeneralAttributes.CreatedBy=g.oUserProfile.sUserName,h.GeneralAttributes.LastModifiedBy=g.oUserProfile.sUserName,h.GeneralAttributes.IsDeleted=!1,h.GeneralAttributes.IsArchived=!1,h.GeneralAttributes.SortingSequence||(h.GeneralAttributes.SortingSequence=0),f=new a(h).$post({path:e.sPath}),f.then($.proxy(function(a){if(e.aLinks&&e.aLinks.length){var b=e.sPath+"('"+a.d[e.sKeyAttribute]+"')";this.createLinks({aLinks:e.aLinks,sParentEntityWithKey:b,onSuccess:$.proxy(function(){this.commonOnSuccess(e),i.resolve(a.d)},this)})}else this.commonOnSuccess(e),i.resolve(a.d)},this),$.proxy(function(){this.commonOnError(e,i)},this)),i.promise},deleteEntity:function(b){var e={},f=c.defer();return b.bShowSpinner&&d.$emit("LOAD"),e=(new a).$delete({path:b.sPath,key:b.sKey}),e.then($.proxy(function(){this.commonOnSuccess(b),f.resolve()},this),$.proxy(function(){this.commonOnError(b,f)},this)),f.promise},httpRequest:function(a){var b="",f="application/x-www-form-urlencoded",g=[],h={},i={};a.sRequestType||(a.sRequestType="GET");for(var j in a.oUrlParameters)g.push(j+"="+a.oUrlParameters[j]);for(var k=0;k<g.length;k++)b+=g[k],k!==g.length-1&&(b+="&");return h=c.defer(),a.bShowSpinner&&d.$emit("LOAD"),i=e({url:a.sPath,method:a.sRequestType,headers:{"Content-Type":f},data:b}),i.success($.proxy(function(b){this.commonOnSuccess(a),h.resolve(b)},this)),i.error($.proxy(function(){this.commonOnError(a,h)},this)),h.promise},constructChangeBlockForBatch:function(a){for(var b={__changeRequests:[]},c=0;c<a.aData.length;c++)b.__changeRequests.push(a.aData[c]);a.oRequestData.__batchRequests.push(b)},batchRequest:function(a){var b=c.defer();return a.oRequestData.__batchRequests.length&&OData.request({requestUri:h.location.origin+h.location.pathname+"odata.svc/$batch",method:"POST",data:a.oRequestData},function(a){b.resolve(a.__batchResponses)},function(){},OData.batchHandler),b.promise},ajaxRequest:function(a){a.sRequestType||(a.sRequestType="POST"),a.bShowSpinner&&d.$emit("LOAD"),$.ajax({type:a.sRequestType,async:a.bAsync,url:a.sPath,data:a.oData,dataType:a.sDataType,beforeSend:function(){},success:$.proxy(function(b){this.commonOnSuccess(a),a.oEventHandlers&&a.oEventHandlers.onSuccess&&a.oEventHandlers.onSuccess(b)},this),error:$.proxy(function(b){this.commonOnError(a),a.oEventHandlers&&a.oEventHandlers.onError&&a.oEventHandlers.onError(b)},this)})}}}]),app.factory("apiProvider",["dataProvider","CONSTANTS","$q","utilsProvider","cacheProvider","PubNub",function(a,b,c,d,e,f){return{getUserProfile:function(c){var d=b.sServicePath+"Users('"+c+"')?$expand=CompanyDetails,RoleDetails,PhaseDetails/ProjectDetails&$format=json",e=[],f=[],g=[],h="",i=!1,j=function(a){i=a.d.IsPasswordInitial,h=a.d.LastModifiedAt;for(var b=0;b<a.d.CompanyDetails.results.length;b++)a.d.CompanyDetails.results[b].GeneralAttributes.IsDeleted||e.push(a.d.CompanyDetails.results[b]);for(var b=0;b<a.d.RoleDetails.results.length;b++)a.d.RoleDetails.results[b].GeneralAttributes.IsDeleted||f.push(a.d.RoleDetails.results[b]);for(var b=0;b<a.d.PhaseDetails.results.length;b++)a.d.PhaseDetails.results[b].GeneralAttributes.IsDeleted||(a.d.PhaseDetails.results[b]._sortingSequence=a.d.PhaseDetails.results[b].GeneralAttributes.SortingSequence,a.d.PhaseDetails.results[b].ProjectDetails._sortingSequence=a.d.PhaseDetails.results[b].ProjectDetails.GeneralAttributes.SortingSequence,g.push(a.d.PhaseDetails.results[b]))};return a.ajaxRequest({sPath:d,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:j}}),{sUserName:c,aUserRoles:f,aAllUserRoles:f,aUserPhases:g,aAllUserPhases:g,aUserCompanies:e,bIsInitialPassword:i,sLastModifiedAt:h,aGloballySelectedPhasesGuids:[]}},getCurrentUserName:function(){var b,c="rest/account/getCurrentUserName",d=function(a){b=a};return a.ajaxRequest({sPath:c,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:d}}),b},getCurrentCompany:function(){var b,c="rest/account/getCurrentCompany",d=function(a){b=a};return a.ajaxRequest({sPath:c,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:d}}),b},setCurrentCompany:function(b){a.ajaxRequest({sPath:"rest/account/setCurrentCompany/"+b,bAsync:!1,sRequestType:"GET"})},getCurrentRole:function(){var b,c="rest/account/getCurrentRole",d=function(a){b=a};return a.ajaxRequest({sPath:c,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:d}}),b},setCurrentRole:function(b){a.ajaxRequest({sPath:"rest/account/setCurrentRole/"+b,bAsync:!1,sRequestType:"GET"})},resetPasswordWithPRCode:function(b){var c=a.httpRequest({sPath:"rest/account/passwordRecoveryWithPRCode/"+b.oData.passwordRecoveryCode+"/"+b.oData.newPassword,sRequestType:"GET",bShowSpinner:!0});c.then(function(a){b.onSuccess(a)})},resetPassword:function(b){var c={},d="";d=b.oData.userName?"rest/account/passwordRecovery/userName/"+b.oData.userName:"rest/account/passwordRecovery/email/"+b.oData.email,c=a.httpRequest({sPath:d,sRequestType:"GET",bShowSpinner:!0}),c.then(function(a){b.onSuccess(a)})},hashPassword:function(b){var c="",d="rest/account/hashPassword/"+b,e=function(a){c=a};return a.ajaxRequest({sPath:d,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:e}}),c},getAttachments:function(b){var c=b.sPath,d=a.httpRequest({sPath:c});d.then(function(a){b.onSuccess(a)})},getUsersWithCompaniesPhasesAndRoles:function(b){var c=a.getEntitySet({sPath:"Users",sExpand:"CompanyDetails,PhaseDetails,RoleDetails",sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oUserEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getUserWithCompaniesPhasesAndRoles:function(b){var c=a.getEntity({sPath:"Users",sKey:b.sKey,sExpand:"CompanyDetails,PhaseDetails/ProjectDetails,RoleDetails",sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner});c.then(b.onSuccess)},createUser:function(b){var c=function(a){e.cleanEntitiesCache("oUserEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"Users",sKeyAttribute:"UserName",oData:b.oData,aLinks:b.aLinks,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!1});d.then(c)},updateUser:function(b){var c=function(a){e.cleanEntitiesCache("oUserEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Users",sKeyAttribute:"UserName",sKey:b.sKey,oData:b.oData,aLinks:b.aLinks,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},logEvent:function(b){var c=b.oData,d=function(){e.cleanEntitiesCache("oOperationLogEntity")};c.OperationContent=JSON.stringify(b.oData.OperationContent);var f=a.createEntity({sPath:"OperationLogs",oData:c,bGuidNeeded:!0,bCompanyNeeded:!0});f.then(d)},getOperationLogs:function(b){var c=a.getEntitySet({sPath:"OperationLogs",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oOperationLogEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getProjects:function(b){var c=a.getEntitySet({sPath:"Projects",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oProjectEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getProjectsWithPhases:function(b){var c=a.getEntitySet({sPath:"Projects",sExpand:"PhaseDetails",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oProjectEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createProject:function(b){var c=function(a){e.cleanEntitiesCache("oProjectEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"Projects",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateProject:function(b){var c=function(a){e.cleanEntitiesCache("oProjectEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Projects",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getPhases:function(b){var c=a.getEntitySet({sPath:"Phases",sExpand:"ProjectDetails",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oPhaseEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createPhase:function(b){var c=function(a){e.cleanEntitiesCache("oPhaseEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"Phases",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updatePhase:function(b){var c=function(a){e.cleanEntitiesCache("oPhaseEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Phases",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getCompanies:function(b){var c=a.getEntitySet({sPath:"Companys",sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oCompanyEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createCompany:function(b){var c=function(a){e.cleanEntitiesCache("oCompanyEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"Companys",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!1});d.then(c)},updateCompany:function(b){var c=function(a){e.cleanEntitiesCache("oCompanyEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Companys",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getRoles:function(b){var c=a.getEntitySet({sPath:"Roles",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oRoleEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createRole:function(b){var c=function(a){e.cleanEntitiesCache("oRoleEntity"),b.onSuccess(a)},d=a.createEntity({sPath:"Roles",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateRole:function(b){var c=function(a){e.cleanEntitiesCache("oRoleEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Roles",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getDeficiencyStatuses:function(b){var c=a.getEntitySet({sPath:"TaskStatuss",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oTaskStatusEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createDeficiencyStatus:function(b){var c=function(a){e.cleanEntitiesCache("oTaskStatusEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"TaskStatuss",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateDeficiencyStatus:function(b){var c=function(a){e.cleanEntitiesCache("oTaskStatusEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"TaskStatuss",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getContractorAccountType:function(b){var c=a.getEntitySet({sPath:"AccountTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false and NameEN eq 'Contractor'",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getClientAccountType:function(b){var c=a.getEntitySet({sPath:"AccountTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false and NameEN eq 'Client'",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getAccountTypes:function(b){var c=a.getEntitySet({sPath:"AccountTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getAccountTypesWithAccounts:function(b){var c=a.getEntitySet({sPath:"AccountTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",sExpand:"AccountDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(function(a){for(var c=[],d=0;d<a.length;d++){c=[];for(var e=0;e<a[d].AccountDetails.results.length;e++)a[d].AccountDetails.results[e].GeneralAttributes.IsDeleted||c.push(a[d].AccountDetails.results[e]);a[d].AccountDetails.results=angular.copy(c)}b.onSuccess(a)})},createAccountType:function(b){var c=function(a){e.cleanEntitiesCache("oAccountTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"AccountTypes",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateAccountType:function(b){var c=function(a){e.cleanEntitiesCache("oAccountTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"AccountTypes",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getContactTypes:function(b){var c=a.getEntitySet({sPath:"ContactTypes",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oContactTypeEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createContactType:function(b){var c=function(a){e.cleanEntitiesCache("oContactTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"ContactTypes",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateContactType:function(b){var c=function(a){e.cleanEntitiesCache("oContactTypeEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"ContactTypes",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getDeficiencyPriorities:function(b){var c=a.getEntitySet({sPath:"TaskPrioritys",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oTaskPriorityEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},createDeficiencyPriority:function(b){var c=function(a){e.cleanEntitiesCache("oTaskPriorityEntity"),b.onSuccess&&b.onSuccess(a)},d=a.createEntity({sPath:"TaskPrioritys",oData:b.oData,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateDeficiencyPriority:function(b){var c=function(a){e.cleanEntitiesCache("oTaskPriorityEntity"),b.onSuccess&&b.onSuccess(a)},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"TaskPrioritys",sKey:b.sKey,oData:b.oData,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getContractorsWithPhases:function(b){var c=a.getEntitySet({sPath:"Accounts",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",sExpand:"PhaseDetails/ProjectDetails,AccountTypeDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountEntity"});if(c instanceof Array){for(var d=[],f=0;f<c.length;f++)"Contractor"===c[f].AccountTypeDetails.NameEN&&d.push(c[f]);b.onSuccess(d)}else c.then(function(a){for(var c=[],d=0;d<a.length;d++)"Contractor"===a[d].AccountTypeDetails.NameEN&&c.push(a[d]);b.onSuccess(c)})},getClientsWithPhases:function(b){var c=a.getEntitySet({sPath:"Accounts",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",sExpand:"PhaseDetails/ProjectDetails,AccountTypeDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oAccountEntity"});if(c instanceof Array){for(var d=[],f=0;f<c.length;f++)"Client"===c[f].AccountTypeDetails.NameEN&&d.push(c[f]);b.onSuccess(d)}else c.then(function(a){for(var c=[],d=0;d<a.length;d++)"Client"===a[d].AccountTypeDetails.NameEN&&c.push(a[d]);b.onSuccess(c)})},getAccountWithPhases:function(b){var c=a.getEntity({sPath:"Accounts",sKey:b.sKey,sExpand:"PhaseDetails/ProjectDetails,AccountTypeDetails",sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner});c.then(b.onSuccess)},createAccount:function(b){var c=function(a){e.cleanEntitiesCache("oAccountEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oAccountEntity",sText:"Account has been created...",sUserName:e.oUserProfile.sUserName}})},d=a.createEntity({sPath:"Accounts",sKeyAttribute:"Guid",oData:b.oData,aLinks:b.aLinks,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},updateAccount:function(b){var c=function(a){e.cleanEntitiesCache("oAccountEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oAccountEntity",sText:"Account has been updated...",sUserName:e.oUserProfile.sUserName}})},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Accounts",sKeyAttribute:"Guid",sKey:b.sKey,oData:b.oData,aLinks:b.aLinks,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},getCountriesWithProvinces:function(b){var c=a.getEntitySet({sPath:"Countrys",sFilter:"GeneralAttributes/IsDeleted eq false",sExpand:"ProvinceDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oCountryEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getContacts:function(b){var c=a.getEntitySet({sPath:"Contacts",sExpand:"UserDetails,ContactTypeDetails,AccountDetails,PhaseDetails/ProjectDetails",sFilter:"CompanyName eq '"+e.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oContactEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},getContact:function(b){var c=a.getEntity({sPath:"Contacts",sKey:b.sKey,sExpand:"UserDetails,ContactTypeDetails,AccountDetails,PhaseDetails/ProjectDetails",sFilter:"GeneralAttributes/IsDeleted eq false",bShowSpinner:b.bShowSpinner});c.then(b.onSuccess)},updateContact:function(b){var c=function(a){e.cleanEntitiesCache("oContactEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oContactEntity",sText:"Contact has been updated...",sUserName:e.oUserProfile.sUserName}})},d=a.updateEntity({bShowSpinner:b.bShowSpinner,sPath:"Contacts",sKeyAttribute:"Guid",sKey:b.sKey,oData:b.oData,aLinks:b.aLinks,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage});d.then(c)},createContact:function(b){var c=function(a){e.cleanEntitiesCache("oContactEntity"),b.onSuccess&&b.onSuccess(a),f.ngPublish({channel:"conspectorPubNub"+e.oUserProfile.sCurrentCompany,message:{sEntityName:"oContactEntity",sText:"Contact has been created...",sUserName:e.oUserProfile.sUserName}})},d=a.createEntity({sPath:"Contacts",sKeyAttribute:"Guid",oData:b.oData,aLinks:b.aLinks,bShowSpinner:b.bShowSpinner,bShowSuccessMessage:b.bShowSuccessMessage,bShowErrorMessage:b.bShowErrorMessage,bGuidNeeded:!0,bCompanyNeeded:!0});d.then(c)},getContactsForAccount:function(b){var c=a.getEntitySet({sPath:"Contacts",sFilter:"GeneralAttributes/IsDeleted eq false and AccountGuid eq '"+b.sAccountGuid+"'",sExpand:"UserDetails,ContactTypeDetails,AccountDetails,PhaseDetails/ProjectDetails",bShowSpinner:b.bShowSpinner,oCacheProvider:e,sCacheProviderAttribute:"oContactEntity"});c instanceof Array?b.onSuccess(c):c.then(b.onSuccess)},generateReport:function(){var a={reportId:"DocxProjectWithVelocityList.docx",fileGuid:"d38da805-e027-464a-b098-7926c86209cd",converter:"",processState:"generated",dispatch:"download",entryName:""};$.download("/conspector/xdocReportsService",a,"post")}}}]),app.factory("servicesProvider",["$rootScope","$state","ngTableParams","$translate","utilsProvider","cacheProvider","apiProvider","dataProvider","rolesSettings","$cookieStore","$window","$filter","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l,m){return{changeLanguage:function(){var b=d.use();switch(b){case"en":d.use("fr");break;case"fr":d.use("en")}a.$emit("languageChanged")},logIn:function(a,b){var c={},d=new Hashes.SHA512;a.password=d.hex(a.password);var e="rest/account/login/"+a.userName+"/"+a.password,f=$.proxy(function(c){var d=this.messagesHandler(c.messages);d&&(b?j.put("userName",{sUserName:a.userName}):j.remove("userName"),this.onLogInSuccessHandler(a.userName))},this);c=h.httpRequest({sPath:e,bShowSpinner:!0,sRequestType:"GET"}),c.then(function(a){f(a)})},logOut:function(){var a="rest/system/initializeSessionVariables",c=$.proxy(function(){f.oUserProfile.sUserName&&this.logLogOut(),f.cleanAllCache(),b.go("signIn")},this);h.ajaxRequest({sPath:a,bAsync:!1,sRequestType:"GET",oEventHandlers:{onSuccess:c}})},logSuccessLogIn:function(){g.logEvent({oData:{GeneralAttributes:{},OperationName:"login_success",OperationContent:{sUserName:f.oUserProfile.sUserName,sCompany:f.oUserProfile.sCurrentCompany,sRole:f.oUserProfile.sCurrentRole}}})},logLogOut:function(){g.logEvent({oData:{GeneralAttributes:{},OperationName:"log_out",OperationContent:{sUserName:f.oUserProfile.sUserName,sCompany:f.oUserProfile.sCurrentCompany,sRole:f.oUserProfile.sCurrentRole}}})},onNoDefaultViewForTheRole:function(){this.logOut(),e.displayMessage({sText:d.instant("global_noDefaultViewForTheRole"),sType:"error"})},setUserPhasesForCurrentCompany:function(a){var b=[];f.oUserProfile.aUserPhases=angular.copy(f.oUserProfile.aAllUserPhases);for(var c=0;c<f.oUserProfile.aUserPhases.length;c++)f.oUserProfile.aUserPhases[c].ProjectDetails.CompanyName===a&&b.push(f.oUserProfile.aUserPhases[c]);f.oUserProfile.aAllUserPhases=angular.copy(f.oUserProfile.aUserPhases),f.oUserProfile.aUserPhases=angular.copy(b)},checkUserRolesAssignment:function(c){var h=[];f.oUserProfile.aUserRoles=angular.copy(f.oUserProfile.aAllUserRoles);for(var j=0;j<f.oUserProfile.aUserRoles.length;j++)f.oUserProfile.aUserRoles[j].CompanyName===c&&h.push(f.oUserProfile.aUserRoles[j]);return f.oUserProfile.aAllUserRoles=angular.copy(f.oUserProfile.aUserRoles),f.oUserProfile.aUserRoles=angular.copy(h),f.oUserProfile.aUserRoles.length?1===f.oUserProfile.aUserRoles.length?(sCurrentRole=f.oUserProfile.aUserRoles[0].RoleName,i.oInitialViews[sCurrentRole]?(f.oUserProfile.sCurrentRole=sCurrentRole,a.sCurrentRole=sCurrentRole,g.setCurrentRole(sCurrentRole),this.logSuccessLogIn(),void b.go(i.oInitialViews[sCurrentRole])):void this.onNoDefaultViewForTheRole()):void b.go("roleSelection"):(this.logOut(),void e.displayMessage({sText:d.instant("global_noRoleAssignment"),sType:"error"}))},onLogInSuccessHandler:function(a){var c="";return f.oUserProfile=g.getUserProfile(a),f.oUserProfile.bIsInitialPassword?void b.go("initialPasswordReset"):(f.oUserProfile.sPassword="",f.oUserProfile.aUserCompanies.length?1!==f.oUserProfile.aUserCompanies.length?void b.go("companySelection"):(c=f.oUserProfile.aUserCompanies[0].CompanyName,f.oUserProfile.sCurrentCompany=c,g.setCurrentCompany(c),this.setUserPhasesForCurrentCompany(c),this.checkUserRolesAssignment(c),void 0):(this.logOut(),void e.displayMessage({sText:d.instant("global_noCompanyAssignment"),sType:"error"})))},onF5WithCurrentUserHandler:function(a){var c="",h="";return f.oUserProfile=g.getUserProfile(a),f.oUserProfile.bIsInitialPassword?void b.go("signIn"):f.oUserProfile.aUserCompanies.length?(c=g.getCurrentCompany())?(f.oUserProfile.sCurrentCompany=c,this.setUserPhasesForCurrentCompany(c),(h=g.getCurrentRole())?void(f.oUserProfile.sCurrentRole=h):void b.go("roleSelection")):void b.go("companySelection"):(this.logOut(),void e.displayMessage({sText:d.instant("global_noCompanyAssignment"),sType:"error"}))},messagesHandler:function(a){for(var b=!0,c=0;c<a.length;c++){var f=a[c].messageCode.toString(),g=d.instant("m"+a[c].messageCode);switch(f[c].substring(0,1)){case"1":e.displayMessage({sText:g,sType:"success"});break;case"2":e.displayMessage({sText:g,sType:"error"}),b=!1;break;case"3":e.displayMessage({sText:g,sType:"warning"})}}return b},costructUploadUrl:function(a){var b="",c=function(a){b=a
};return h.ajaxRequest({sPath:a.sPath,sRequestType:"GET",bAsync:!1,oData:{},oEventHandlers:{onSuccess:function(a){c(a)}}}),b},deleteFileAttachment:function(a){var b="rest/file/delete/"+a;h.ajaxRequest({sPath:b,sRequestType:"GET",bAsync:!1,oData:{},oEventHandlers:{onSuccess:function(){e.displayMessage({sText:d.instant("global_successOperation"),sType:"success"})}}})},getUserPhasesGuids:function(){for(var a=[],b=0;b<f.oUserProfile.aUserPhases.length;b++)a.push(f.oUserProfile.aUserPhases[b].Guid);return a},constructUserProjectsPhases:function(){for(var a=[],b=!1,c=0,d=angular.copy(f.oUserProfile.aUserPhases),e=0;e<d.length;e++){b=!1,c=0;for(var g=0;g<a.length;g++)if(a[g].Guid===d[e].ProjectDetails.Guid){b=!0,c=g;break}b?a[c].PhaseDetails.results.push(d[e]):(d[e].ProjectDetails.PhaseDetails={results:[]},d[e].ProjectDetails.PhaseDetails.results.push(d[e]),a.push(d[e].ProjectDetails))}a=l("orderBy")(a,["_sortingSequence"]);for(var e=0;e<a.length;e++)a[e].PhaseDetails.results=l("orderBy")(a[e].PhaseDetails.results,["_sortingSequence"]);return a},constructUserProjectsPhasesForMultiSelect:function(a){var b=[];b=angular.copy(f.oUserProfile.aUserPhases);var c={aData:b,aPhases:[]},d=[];d=this.constructUserProjectsPhases();var e=a.aSelectedPhases;return this.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:d},sSecondLevelAttribute:"PhaseDetails",sSecondLevelNameEN:"NameEN",sSecondLevelNameFR:"NameFR",oParentArrayWrapper:c,oNewParentItemArrayWrapper:{aData:[]},sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",aParentKeys:e,sTargetArrayNameInParent:"aPhases"}),c.aData[0]?c.aData[0].aPhases:[]},constructLogoUrl:function(){var b="rest/file/list/companyDependentSettings/"+f.oUserProfile.sCurrentCompany+"/_logo_",c=h.httpRequest({sPath:b});c.then(function(b){a.sLogoUrl=b[0]?k.location.origin+k.location.pathname+"rest/file/get/"+b[0].guid:k.location.origin+k.location.pathname+"img/logo_conspector.png"})},getSeletedItemsKeysInMultiSelect:function(a){for(var b=[],c=0;c<a.aData.length;c++)a.aData[c].ticked===!0&&b.push(a.aData[c][a.sKey]);return b},constructDependentMultiSelectArray:function(a){for(var b=[],c={},e=0;e<a.oDependentArrayWrapper.aData.length;e++)if(a.sSecondLevelAttribute){c={},c.multiSelectGroup=!0;var f="";(a.oDependentArrayWrapper.aData[e][a.sNameEN]||a.oDependentArrayWrapper.aData[e][a.sNameFR])&&(f="en"===d.use()?a.oDependentArrayWrapper.aData[e][a.sNameEN]:a.oDependentArrayWrapper.aData[e][a.sNameFR],f||(f=a.oDependentArrayWrapper.aData[e][a.sNameEN])),c.name='<div class="cnpButtonLabelChild">'+f+"</div>",b.push(c);for(var g=0;g<a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results.length;g++)c={},(a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sSecondLevelNameEN]||a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sSecondLevelNameFR])&&(c.name="en"===d.use()?a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sSecondLevelNameEN]:a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sSecondLevelNameFR],c.name||(c.name=a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sSecondLevelNameEN]),c.fullName='<div class="cnpButtonLabelParent">'+f+'</div><div class="cnpButtonLabelSeparator">&nbsp;-&nbsp;</div><div class="cnpButtonLabelChild">'+c.name+"</div>"),c[a.sDependentKey]=a.oDependentArrayWrapper.aData[e][a.sSecondLevelAttribute].results[g][a.sDependentKey],b.push(c);c={},c.multiSelectGroup=!1,b.push(c)}else c={},(a.oDependentArrayWrapper.aData[e][a.sNameEN]||a.oDependentArrayWrapper.aData[e][a.sNameFR])&&(c.name="en"===d.use()?a.oDependentArrayWrapper.aData[e][a.sNameEN]:a.oDependentArrayWrapper.aData[e][a.sNameFR],c.name||(c.name=a.oDependentArrayWrapper.aData[e][a.sNameEN])),a.oDependentArrayWrapper.aData[e][a.sDependentIconKey]&&(c.icon="<img src='"+k.location.origin+k.location.pathname+"rest/file/get/",c.icon=c.icon+a.oDependentArrayWrapper.aData[e][a.sDependentIconKey]+"' class='cnpMultiSelectIcon;'/>"),c[a.sDependentKey]=a.oDependentArrayWrapper.aData[e][a.sDependentKey],b.push(c);a.oNewParentItemArrayWrapper&&(a.oNewParentItemArrayWrapper.aData=angular.copy(b));for(var e=0;e<a.oParentArrayWrapper.aData.length;e++){for(var h=[],i={},j=!1,g=0;g<b.length;g++){if(i={},angular.copy(b[g],i),a.sParentKey&&a.oParentArrayWrapper.aData[e][a.sParentKey]===b[g][a.sDependentKey]&&(i.ticked=!0,j=!0),a.aParentKeys)for(var l=0;l<a.aParentKeys.length;l++)b[g][a.sDependentKey]===a.aParentKeys[l]&&(i.ticked=!0,j=!0);h.push(i)}a.oParentArrayWrapper.aData[e][a.sTargetArrayNameInParent]=h}},createNgTable:function(a){var b=new c({page:1,count:1e4,filterDelay:250,sorting:a.oInitialSorting},{groupBy:a.sGroupBy,total:a.oInitialDataArrayWrapper.aData.length,sDisplayedDataArrayName:a.sDisplayedDataArrayName,getData:function(b,c){var d=a.oInitialDataArrayWrapper.aData,e=c.sorting()?l("orderBy")(d,c.orderBy()):d,f=c.filter()?l("filter")(e,c.filter()):e;b.resolve(f.slice((c.page()-1)*c.count(),c.page()*c.count()))},counts:[]});return b},showConfirmationPopup:function(a){var b=m.confirm().title(a.sHeader).content(a.sContent).ok(a.sOk).cancel(a.sCancel).targetEvent(a.event);m.show(b).then(function(){a.onOk()},function(){a.onCancel&&a.onCancel()})}}}]),app.controller("mainController",["$scope","$rootScope","$state","apiProvider","servicesProvider","PubNub","cacheProvider",function(a,b,c,d,e,f,g){var h=d.getCurrentUserName();if(h){e.onF5WithCurrentUserHandler(h);var i="";f.init({publish_key:"pub-c-59bd66cf-9992-42d5-af04-87ec537c73bb",subscribe_key:"sub-c-7606f63c-9908-11e4-a626-02ee2ddab7fe"}),i="conspectorPubNub"+g.oUserProfile.sCurrentCompany,f.ngSubscribe({channel:i}),b.$on(f.ngMsgEv(i),function(a,c){switch(c.message.sUserName!==g.oUserProfile.sUserName&&g.cleanEntitiesCache(c.message.sEntityName),c.message.sEntityName){case"oAccountEntity":c.message.sUserName!==g.oUserProfile.sUserName&&b.$broadcast("accountsShouldBeRefreshed");break;case"oContactEntity":c.message.sUserName!==g.oUserProfile.sUserName&&b.$broadcast("contactsShouldBeRefreshed")}})}b.$on("LOAD",function(){b.showSpinner=!0}),b.$on("UNLOAD",function(){b.showSpinner=!1}),b.$on("$stateChangeSuccess",function(a,c,d,e,f){b.sFromState=e.name,b.oFromStateParams=f})}]),viewControllers.controller("companySelectionView",["$scope","$rootScope","$state","$translate","utilsProvider","dataProvider","cacheProvider","$filter","rolesSettings","servicesProvider","apiProvider",function(a,b,c,d,e,f,g,h,i,j,k){var l=[];a.sLanguage=d.use(),b.$on("languageChanged",function(){a.sLanguage=d.use()});for(var m=0;m<g.oUserProfile.aUserCompanies.length;m++){var n={};n.CompanyName=g.oUserProfile.aUserCompanies[m].CompanyName,n.DescriptionEN=g.oUserProfile.aUserCompanies[m].DescriptionEN,n.DescriptionFR=g.oUserProfile.aUserCompanies[m].DescriptionFR,n.DescriptionFR||(n.DescriptionFR=n.DescriptionEN),n._sortingSequence=g.oUserProfile.aUserCompanies[m].GeneralAttributes.SortingSequence,l.push(n)}a.aUserCompanies=h("orderBy")(l,["_sortingSequence"]),a.sSelectedCompanyName=a.aUserCompanies[0].CompanyName,a.onContinue=function(){var b=a.sSelectedCompanyName;g.oUserProfile.sCurrentCompany=b,k.setCurrentCompany(b),g.oUserProfile.aUserRoles=angular.copy(g.oUserProfile.aAllUserRoles),j.checkUserRolesAssignment(b),j.setUserPhasesForCurrentCompany(b)},a.onChangeLanguage=function(){j.changeLanguage()},a.onBack=function(){return b.sFromState?void c.go(b.sFromState,b.oFromStateParams):void c.go("signIn")}}]),viewControllers.controller("forgotPasswordView",["$scope","$rootScope","$state","$stateParams","utilsProvider","dataProvider","servicesProvider","apiProvider","$translate",function(a,b,c,d,e,f,g,h,i){a.sSelectedResetType="userName",a.resetData={sUserName:"",sEmail:""},a.onChangeLanguage=function(){g.changeLanguage()},a.onReset=function(){var b={userName:"",email:""};if("userName"===a.sSelectedResetType?b.userName=a.resetData.sUserName:b.email=a.resetData.sEmail,!b.userName&&!b.email)return void e.displayMessage({sText:i.instant("global_emptyFields"),sType:"error"});var c=function(a){g.messagesHandler(a.messages)};h.resetPassword({oData:b,onSuccess:c})},a.onResetTypeChange=function(){"userName"===a.sSelectedResetType?a.resetData.sEmail="":a.resetData.sUserName=""},a.onBack=function(){return b.sFromState?void c.go(b.sFromState,b.oFromStateParams):void c.go("signIn")}}]),viewControllers.controller("initialPasswordResetView",["$scope","$rootScope","$state","dataProvider","$translate","servicesProvider","cacheProvider","apiProvider",function(a,b,c,d,e,f,g,h){a.resetPasswordData={sNewPassword:"",sNewPasswordConfirmation:""},a.onChangeLanguage=function(){f.changeLanguage()};var i=function(a){g.oUserProfile.sLastModifiedAt=a.LastModifiedAt,f.onLogInSuccessHandler(g.oUserProfile.sUserName,"")};a.resetPassword=function(){var b=new Hashes.SHA512,c={};return a.resetPasswordData.sNewPassword&&a.resetPasswordData.sNewPasswordConfirmation?a.resetPasswordData.sNewPassword!==a.resetPasswordData.sNewPasswordConfirmation?void utilsProvider.displayMessage({sText:e.instant("global_passwordsDontMatch"),sType:"error"}):(c.UserName=g.oUserProfile.sUserName,c.Password=h.hashPassword(b.hex(a.resetPasswordData.sNewPassword)),c.IsPasswordInitial=!1,c.LastModifiedAt=g.oUserProfile.sLastModifiedAt,void h.updateUser({bShowSpinner:!0,sKey:c.UserName,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:i})):void utilsProvider.displayMessage({sText:e.instant("global_emptyFields"),sType:"error"})},a.onBack=function(){return b.sFromState?void c.go(b.sFromState,b.oFromStateParams):void c.go("signIn")}}]),viewControllers.controller("passwordResetView",["$scope","$rootScope","$state","dataProvider","$translate","servicesProvider","cacheProvider","apiProvider","$stateParams",function(a,b,c,d,e,f,g,h,i){a.resetPasswordData={sNewPassword:"",sNewPasswordConfirmation:""},a.onChangeLanguage=function(){f.changeLanguage()},a.resetPassword=function(){var b=new Hashes.SHA512,d={};if(!a.resetPasswordData.sNewPassword||!a.resetPasswordData.sNewPasswordConfirmation)return void utilsProvider.displayMessage({sText:e.instant("global_emptyFields"),sType:"error"});if(a.resetPasswordData.sNewPassword!==a.resetPasswordData.sNewPasswordConfirmation)return void f.displayMessage({sText:e.instant("passwordReset_passwordsDontMatch"),sType:"error"});d.newPassword=b.hex(a.resetPasswordData.sNewPassword),d.passwordRecoveryCode=i.pr;{var g=function(a){var b=f.messagesHandler(a.messages);b&&c.go("signIn")};h.resetPasswordWithPRCode({oData:d,onSuccess:g})}},a.onBack=function(){return b.sFromState?void c.go(b.sFromState,b.oFromStateParams):void c.go("signIn")}}]),viewControllers.controller("roleSelectionView",["$scope","$rootScope","$state","$translate","utilsProvider","dataProvider","cacheProvider","$filter","rolesSettings","servicesProvider","apiProvider",function(a,b,c,d,e,f,g,h,i,j,k){var l=[];a.sLanguage=d.use(),b.$on("languageChanged",function(){a.sLanguage=d.use()});for(var m=0;m<g.oUserProfile.aUserRoles.length;m++){var n={};n.RoleName=g.oUserProfile.aUserRoles[m].RoleName,n.DescriptionEN=g.oUserProfile.aUserRoles[m].DescriptionEN,n.DescriptionFR=g.oUserProfile.aUserRoles[m].DescriptionFR,n.CompanyName=g.oUserProfile.aUserRoles[m].CompanyName,n.DescriptionFR||(n.DescriptionFR=n.DescriptionEN),n._sortingSequence=g.oUserProfile.aUserRoles[m].GeneralAttributes.SortingSequence,n.CompanyName===g.oUserProfile.sCurrentCompany&&l.push(n)}a.aUserRoles=h("orderBy")(l,["_sortingSequence"]),a.sSelectedRoleName=a.aUserRoles[0].RoleName,a.onContinue=function(){var d=a.sSelectedRoleName;return i.oInitialViews[d]?(g.oUserProfile.sCurrentRole=d,b.sCurrentRole=d,k.setCurrentRole(d),j.logSuccessLogIn(),void c.go(i.oInitialViews[d])):void j.onNoDefaultViewForTheRole()},a.onChangeLanguage=function(){j.changeLanguage()},a.onBack=function(){return b.sFromState?void c.go(b.sFromState,b.oFromStateParams):void c.go("signIn")}}]),viewControllers.controller("signInView",["$scope","$state","servicesProvider","dataProvider","$cookieStore","utilsProvider","$translate",function(a,b,c,d,e,f,g){var h="";e.get("userName")&&(h=e.get("userName").sUserName),a.logInData={sUserName:h,sPassword:"",bRememberUserName:!0},a.onChangeLanguage=function(){c.changeLanguage()},a.login=function(){if(!a.logInData.sUserName||!a.logInData.sPassword)return void f.displayMessage({sText:g.instant("global_emptyFields"),sType:"error"});var b={userName:a.logInData.sUserName,password:a.logInData.sPassword};c.logIn(b,a.logInData.bRememberUserName)},a.passwordFldKeyDown=function(a){13===a.keyCode&&this.login()},a.onSignInClick=function(){this.login()},a.onSwitchLanguage=function(){f.switchLanguage()},a.onForgotPassword=function(){b.go("forgotPassword")}}]),viewControllers.controller("unitsListView",["$scope","$state","servicesProvider","historyProvider","apiProvider",function(a,b,c,d){d.removeHistory()}]),viewControllers.controller("changePasswordView",["$scope","$rootScope","$state","$translate","utilsProvider","dataProvider","cacheProvider","$filter","rolesSettings","servicesProvider","apiProvider",function(a,b,c,d,e,f,g,h,i,j,k){var l=!1,m={};a.oUser={},a.onSave=function(){var b=new Hashes.SHA512,c={GeneralAttributes:{}};if(!a.oUser.sPassword||!a.oUser.sPasswordConfirmation)return void e.displayMessage({sText:d.instant("global_emptyFields"),sType:"error"});if(a.oUser.sPassword!==a.oUser.sPasswordConfirmation)return void e.displayMessage({sText:d.instant("global_passwordsDontMatch"),sType:"error"});var f=function(b){l=!1,a.oUser.sPassword="",a.oUser.sPasswordConfirmation="",g.oUserProfile.sLastModifiedAt=b.LastModifiedAt};c.UserName=g.oUserProfile.sUserName,c.LastModifiedAt=g.oUserProfile.sLastModifiedAt,c.Password=k.hashPassword(b.hex(a.oUser.sPassword)),k.updateUser({bShowSpinner:!0,sKey:c.UserName,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:f})},a.onDataModified=function(){l=!0};var n=function(){a.onSave(m)},o=function(){l=!1,c.go(m.toState,m.toParams)};a.$on("$stateChangeStart",function(a,b,c){l&&(a.preventDefault(),m={toState:b,toParams:c},j.showConfirmationPopup({sHeader:d.instant("global_changesSaveConfirmationHeader"),sContent:d.instant("global_changesSaveConfirmationContent"),sOk:d.instant("global_yes"),sCancel:d.instant("global_no"),onOk:n,onCancel:o,event:a}))})}]),viewControllers.controller("profileDetailsView",["$scope","$rootScope","$state","$translate","utilsProvider","dataProvider","cacheProvider","$filter","rolesSettings","servicesProvider","apiProvider","$cookieStore","$window","$upload",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=g.oUserProfile.sUserName,p=g.oUserProfile.sCurrentCompany,q=!1,r={};a.oUser={},a.sMode="display";var s=function(b){var c="",f="";a.oUser.sUserName=b.UserName,a.oUser.sEmail=b.EMail,a.oUser._lastModifiedAt=b.LastModifiedAt,a.oUser.sCreatedAt=e.dBDateToSting(b.CreatedAt),a.oUser.sLastModifiedAt=e.dBDateToSting(b.LastModifiedAt),a.oUser._aCompanies=[],a.oUser.sCompanies="";for(var g=0;g<b.CompanyDetails.results.length;g++)b.CompanyDetails.results[g].GeneralAttributes.IsDeleted||(a.oUser._aCompanies.push(b.CompanyDetails.results[g]),a.oUser.sCompanies=a.oUser.sCompanies+b.CompanyDetails.results[g].CompanyName+"; ");a.oUser.sRoles="";for(var g=0;g<b.RoleDetails.results.length;g++)b.RoleDetails.results[g].GeneralAttributes.IsDeleted||b.RoleDetails.results[g].CompanyName!==p||(a.oUser.sRoles=a.oUser.sRoles+b.RoleDetails.results[g].RoleName+"; ");a.oUser.sPhases="";for(var g=0;g<b.PhaseDetails.results.length;g++)b.PhaseDetails.results[g].GeneralAttributes.IsDeleted||b.PhaseDetails.results[g].CompanyName!==p||(c="en"===d.use()?b.PhaseDetails.results[g].ProjectDetails.NameEN:b.PhaseDetails.results[g].ProjectDetails.NameFR,c||(c=b.PhaseDetails.results[g].ProjectDetails.NameEN),a.oUser.sPhases=a.oUser.sPhases+c+" - ",f="en"===d.use()?b.PhaseDetails.results[g].NameEN:b.PhaseDetails.results[g].NameFR,f||(f=b.PhaseDetails.results[g].NameEN),a.oUser.sPhases=a.oUser.sPhases+f+"; ");a.oUser.sAvatarUrl=b.AvatarFileGuid?m.location.origin+m.location.pathname+"rest/file/get/"+b.AvatarFileGuid:m.location.origin+m.location.pathname+"img/noAvatar.jpg"},t=function(){k.getUserWithCompaniesPhasesAndRoles({sKey:o,bShowSpinner:!0,onSuccess:s})};t(),a.onDataModified=function(){q=!0},a.onEdit=function(){a.sMode="edit"},a.onSave=function(b){var d={GeneralAttributes:{}},f=function(d){g.cleanEntitiesCache("oUserEntity"),g.oUserProfile.sLastModifiedAt=d.LastModifiedAt,q=!1,b&&c.go(b.toState,b.toParams),a.oUser._lastModifiedAt=d.LastModifiedAt,a.oUser.sLastModifiedAt=e.dBDateToSting(d.LastModifiedAt),a.sMode="display"};d.UserName=a.oUser.sUserName,d.EMail=a.oUser.sEmail,d.LastModifiedAt=a.oUser._lastModifiedAt,d.AvatarFileGuid=a.oUser._avatarFileGuid,k.updateUser({bShowSpinner:!0,sKey:d.UserName,oData:d,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:f})};var u=function(b,c){for(var d=0;d<b.length;d++){var e=b[d],c=j.costructUploadUrl({sPath:c});a.upload=n.upload({url:c,file:e}),a.upload.success(function(b){a.oUser.sAvatarUrl=m.location.origin+m.location.pathname+"rest/file/get/"+b,a.oUser._avatarFileGuid=b})}};a.onAvatarSelected=function(b,c){a.onDataModified(),u(b,"rest/file/createUploadUrl/users/users/_avatar_",c)};var v=function(){a.onSave(r)},w=function(){q=!1,c.go(r.toState,r.toParams)};a.$on("$stateChangeStart",function(a,b,c){q&&(a.preventDefault(),r={toState:b,toParams:c},j.showConfirmationPopup({sHeader:d.instant("global_changesSaveConfirmationHeader"),sContent:d.instant("global_changesSaveConfirmationContent"),sOk:d.instant("global_yes"),sCancel:d.instant("global_no"),onOk:v,onCancel:w,event:a}))})}]),viewControllers.controller("profileSettingsView",["$scope","$state","servicesProvider","$cookieStore","cacheProvider","$window","$mdSidenav","historyProvider",function(a,b,c,d,e,f,g,h){h.removeHistory(),a.toggleLeftSidenav=function(){g("left").toggle()};var i=function(a){g("left").close(),b.go(a)};a.onProfileDetails=function(){i("app.profileSettings.profileDetails")},a.onChangePassword=function(){i("app.profileSettings.changePassword")};var j=angular.element(d);j.bind("resize",function(){g("left").close()})}]),viewControllers.controller("appView",["$scope","$rootScope","$state","$window","servicesProvider","$translate","$timeout","cacheProvider","rolesSettings","$cookieStore",function(a,b,c,d,e,f,g,h,i,j){var k=h.oUserProfile.sUserName,l=h.oUserProfile.sCurrentCompany,m=[];a.sCurrentUser=k,k||e.logOut(),e.constructLogoUrl(),m=j.get("globallySelectedPhasesGuids"+k+l)&&j.get("globallySelectedPhasesGuids"+k+l).aPhasesGuids?angular.copy(j.get("globallySelectedPhasesGuids"+k+l).aPhasesGuids):e.getUserPhasesGuids(),h.oUserProfile.aGloballySelectedPhasesGuids=m,a.globalProjectsWithPhases=e.constructUserProjectsPhasesForMultiSelect({aSelectedPhases:m}),a.onGlobalUserPhasesChanged=function(){var b=[];b=e.getSeletedItemsKeysInMultiSelect({sKey:"Guid",aData:a.globalProjectsWithPhases}),j.put("globallySelectedPhasesGuids"+k+l,{aPhasesGuids:b}),h.oUserProfile.aGloballySelectedPhasesGuids=b,a.$broadcast("globalUserPhasesHaveBeenChanged")},h.oUserProfile.sCurrentRole&&i.oDisplayedSections[h.oUserProfile.sCurrentRole].adminPanel&&(a.bDisplayAdminPanel=!0),h.oUserProfile.sCurrentRole&&i.oDisplayedSections[h.oUserProfile.sCurrentRole].profileSettings&&(a.bDisplayProfileSettings=!0),h.oUserProfile.aUserCompanies&&h.oUserProfile.aUserCompanies.length>1&&(a.bDisplaySwitchCompanies=!0),h.oUserProfile.aUserRoles&&h.oUserProfile.aUserRoles.length>1&&(a.bDisplaySwitchRoles=!0),a.aTabs=[],h.oUserProfile.sCurrentRole&&i.oDisplayedSections[h.oUserProfile.sCurrentRole].deficiencies&&a.aTabs.push({sTitle:f.instant("app_deficienciesTab"),sState:"app.deficienciesList"}),h.oUserProfile.sCurrentRole&&i.oDisplayedSections[h.oUserProfile.sCurrentRole].units&&a.aTabs.push({sTitle:f.instant("app_unitsTab"),sState:"app.unitsList"}),h.oUserProfile.sCurrentRole&&i.oDisplayedSections[h.oUserProfile.sCurrentRole].contractors&&a.aTabs.push({sTitle:f.instant("app_contractorsTab"),sState:"app.contractorsList"}),h.oUserProfile.sCurrentRole&&i.oDisplayedSections[h.oUserProfile.sCurrentRole].clients&&a.aTabs.push({sTitle:f.instant("app_clientsTab"),sState:"app.clientsList"}),h.oUserProfile.sCurrentRole&&i.oDisplayedSections[h.oUserProfile.sCurrentRole].contacts&&a.aTabs.push({sTitle:f.instant("app_contactsTab"),sState:"app.contactsList"}),a.onSwitchCompanies=function(){c.go("companySelection")},a.onSwitchRoles=function(){c.go("roleSelection")},a.onLogOut=function(){e.logOut()};var n=function(b){for(var c=0;c<a.aTabs.length;c++)if(a.aTabs[c].sState===b)return c},o=function(){return d.location.hash.indexOf("#/app/adminPanel")>-1||d.location.hash.indexOf("#/app/profileSettings")>-1||d.location.hash.indexOf("#/app/clientDetails")>-1||d.location.hash.indexOf("#/app/contractorDetails")>-1||d.location.hash.indexOf("#/app/contactDetails")>-1?(a.selectedTabIndex=-1,void a.$broadcast("$mdTabsPaginationChanged")):d.location.hash.indexOf("deficienc")>-1?void(a.selectedTabIndex=n("app.deficienciesList")):d.location.hash.indexOf("unit")>-1?void(a.selectedTabIndex=n("app.unitsList")):d.location.hash.indexOf("contractor")>-1?void(a.selectedTabIndex=n("app.contractorsList")):d.location.hash.indexOf("client")>-1?void(a.selectedTabIndex=n("app.clientsList")):d.location.hash.indexOf("contact")>-1?void(a.selectedTabIndex=n("app.contactsList")):void 0};g(o,100),a.onTabSelect=function(b){var e="";d.location.hash.indexOf("unit")>-1&&(e="Units"),d.location.hash.indexOf("contractor")>-1&&(e="Contractors"),d.location.hash.indexOf("client")>-1&&(e="Clients"),d.location.hash.indexOf("contact")>-1&&(e="Contacts"),void 0!==a.selectedTabIndex&&c.go(b.sState)},a.onAdminPanel=function(){a.selectedTabIndex=-1,a.$broadcast("$mdTabsPaginationChanged"),c.go("app.adminPanel.usersList")},a.onProfileSettings=function(){a.selectedTabIndex=-1,a.$broadcast("$mdTabsPaginationChanged"),c.go("app.profileSettings.profileDetails")},a.onChangeLanguage=function(){e.changeLanguage()},a.$on("$stateChangeSuccess",function(){g(o,100)})}]),viewControllers.controller("deficienciesListView",["$scope","$state","servicesProvider","historyProvider",function(a,b,c,d){d.removeHistory()}]),viewControllers.controller("contractorDetailsView",["$rootScope","$scope","$state","servicesProvider","apiProvider","$translate","$stateParams","cacheProvider","utilsProvider","$filter","dataProvider","CONSTANTS","historyProvider",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=g.sContractorGuid;b.sAccountType="",b.bShowBackButton=m.aHistoryStates.length>0?!0:!1,b.$parent&&"contractorDetailsWrapperView"===b.$parent.sViewName&&(b.$parent.oStateParams=angular.copy(g),b.sAccountType="Contractor"),b.sAccountTypeGuid="";var o=!1,p={};b.sMode=g.sMode,b.oContractor={_aPhases:[]};var q={aData:[{}]},r=[];b.aBillingCountries=[],b.aBillingProvinces=[],b.aShippingCountries=[],b.aShippingProvinces=[];var s=function(a){b.aUserProjectsPhasesForMultiselect=d.constructUserProjectsPhasesForMultiSelect({aSelectedPhases:a})},t=function(a){var c=[];b.oContractor._guid=a.Guid,b.oContractor._lastModifiedAt=a.LastModifiedAt,b.oContractor.sName=a.Name,b.oContractor.sPhone=a.MainPhone,b.oContractor.sSecondaryPhone=a.SecondaryPhone,b.oContractor.sWebsite=a.Website,b.oContractor.sEmail=a.Email,b.oContractor.sFax=a.Fax,b.oContractor.aTags=i.tagsStringToTagsArray(a.DescriptionTags),a.BillingAddress&&(b.oContractor.sBillingStreet=a.BillingAddress.BillingStreet,b.oContractor.sBillingCity=a.BillingAddress.BillingCity,b.oContractor.sBillingPostalCode=a.BillingAddress.BillingPostalCode,b.oContractor._billingCountryCode=a.BillingAddress.BillingCountry,b.oContractor._billingProvinceCode=a.BillingAddress.BillingProvince),a.ShippingAddress&&(b.oContractor.sShippingStreet=a.ShippingAddress.ShippingStreet,b.oContractor.sShippingCity=a.ShippingAddress.ShippingCity,b.oContractor.sShippingPostalCode=a.ShippingAddress.ShippingPostalCode,b.oContractor._shippingCountryCode=a.ShippingAddress.ShippingCountry,b.oContractor._shippingProvinceCode=a.ShippingAddress.ShippingProvince),b.oContractor.sCreatedAt=i.dBDateToSting(a.CreatedAt),b.oContractor.sLastModifiedAt=i.dBDateToSting(a.LastModifiedAt),b.oContractor._aPhases=angular.copy(a.PhaseDetails.results);for(var d=0;d<b.oContractor._aPhases.length;d++)c.push(b.oContractor._aPhases[d].Guid);s(c),q.aData[0]=angular.copy(b.oContractor)},u=h.getEntityDetails({sCacheProviderAttribute:"oAccountEntity",sRequestSettings:"CompanyName eq '"+h.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq falsePhaseDetails/ProjectDetails,AccountTypeDetails",sKeyName:"Guid",sKeyValue:g.sContractorGuid}),v=function(a){var c=a.sParentKey,e="",f="";"billingAddress"===a.sProvincesFor?(e="aBillingProvinces",f="aBillingCountries"):(e="aShippingProvinces",f="aShippingCountries");for(var g=0;g<b[f].length;g++)if(b[f][g].ticked){for(var h=0;h<r.length;h++)if(b[f][g].CountryCode===r[h].CountryCode){d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:r[h].ProvinceDetails.results},oParentArrayWrapper:q,sNameEN:"Name",sNameFR:"Name",sDependentKey:"ProvinceCode",sParentKey:c,sTargetArrayNameInParent:e}),q.aData[0]&&(b[e]=angular.copy(q.aData[0][e]));break}break}},w=function(a){r=angular.copy(a),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:q,sNameEN:"Name",sNameFR:"Name",sDependentKey:"CountryCode",sParentKey:"_billingCountryCode",sTargetArrayNameInParent:"aBillingCountries"}),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:q,sNameEN:"Name",sNameFR:"Name",sDependentKey:"CountryCode",sParentKey:"_shippingCountryCode",sTargetArrayNameInParent:"aShippingCountries"}),q.aData[0]&&(b.aBillingCountries=angular.copy(q.aData[0].aBillingCountries),b.aShippingCountries=angular.copy(q.aData[0].aShippingCountries)),b.oContractor._billingCountryCode&&v({sParentKey:"_billingProvinceCode",sProvincesFor:"billingAddress"}),b.oContractor._shippingCountryCode&&v({sParentKey:"_shippingProvinceCode",sProvincesFor:"shippingAddress"})},x=function(a){t(a),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:w})},y=function(){e.getAccountWithPhases({sKey:n,bShowSpinner:!0,onSuccess:x})},z=function(a){b.sAccountTypeGuid=a[0].Guid};"create"!==b.sMode?angular.equals(u,{})?y():(t(u),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:w})):(s({aSelectedPhases:[]}),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:w}),"Contractor"===b.sAccountType&&e.getContractorAccountType({bShowSpinner:!1,onSuccess:z}),"Client"===b.sAccountType&&e.getClientAccountType({bShowSpinner:!1,onSuccess:z})),b.onEdit=function(){c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"edit",sContractorGuid:b.oContractor._guid})};var A=function(){var a={GeneralAttributes:{IsDeleted:!0}},d=function(){m.navigateBack({oState:c})};a.Guid=b.oContractor._guid,a.LastModifiedAt=b.oContractor._lastModifiedAt,e.updateAccount({bShowSpinner:!0,sKey:a.Guid,oData:a,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})};b.onDelete=function(a){d.showConfirmationPopup({sHeader:f.instant("contractorDetails_deletionConfirmationHeader"),sContent:f.instant("contractorDetails_deletionConfirmationContent"),sOk:f.instant("global_ok"),sCancel:f.instant("global_cancel"),onOk:A,event:a})};var B=function(){for(var a=[],c=[],d="",e=0;e<b.aUserProjectsPhasesForMultiselect.length;e++)b.aUserProjectsPhasesForMultiselect[e].ticked&&(d="Phases('"+b.aUserProjectsPhasesForMultiselect[e].Guid+"')",c.push(d));return c.length&&a.push({sRelationName:"PhaseDetails",bKeepCompanyDependentLinks:!0,aUri:c}),a};b.onDataModified=function(){o=!0},b.onBillingCountryChanged=function(){b.onDataModified(),v({sParentKey:"",sProvincesFor:"billingAddress"})},b.onShippingCountryChanged=function(){b.onDataModified(),v({sParentKey:"",sProvincesFor:"shippingAddress"})},b.onBack=function(){m.navigateBack({oState:c})},b.onSave=function(a,d){var f={GeneralAttributes:{}},g=[],h=function(e){return o=!1,d?void c.go(d.toState,d.toParams):void(a?(b.oContractor.sName="",b.oContractor.sPhone="",b.oContractor.sSecondaryPhone="",b.oContractor.sWebsite="",b.oContractor.sEmail="",b.oContractor.sFax="",f.BillingAddress={},f.ShippingAddress={},b.oContractor._aPhases=[]):(b.oContractor._lastModifiedAt=e.LastModifiedAt,b.oContractor.sLastModifiedAt=i.dBDateToSting(e.LastModifiedAt),b.oContractor.sCreatedAt=i.dBDateToSting(e.CreatedAt),b.oContractor._guid=e.Guid,b.$parent&&"contractorDetailsWrapperView"===b.$parent.sViewName&&(b.$parent.oStateParams.sMode="display"),c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"display",sContractorGuid:e.Guid})))},j=function(a){return o=!1,b.oContractor._lastModifiedAt=a.LastModifiedAt,b.oContractor.sLastModifiedAt=i.dBDateToSting(a.LastModifiedAt),d?void c.go(d.toState,d.toParams):(b.$parent&&"contractorDetailsWrapperView"===b.$parent.sViewName&&(b.$parent.oStateParams.sMode="display"),void c.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"display",sContractorGuid:a.Guid}))};f.Guid=b.oContractor._guid,f.Name=b.oContractor.sName,f.MainPhone=b.oContractor.sPhone?b.oContractor.sPhone.replace(/\D/g,""):"",f.SecondaryPhone=b.oContractor.sSecondaryPhone?b.oContractor.sSecondaryPhone.replace(/\D/g,""):"",f.Fax=b.oContractor.sFax?b.oContractor.sFax.replace(/\D/g,""):"",f.Website=b.oContractor.sWebsite,f.Email=b.oContractor.sEmail,f.DescriptionTags=i.tagsArrayToTagsString(b.oContractor.aTags),f.BillingAddress={},f.BillingAddress.BillingStreet=b.oContractor.sBillingStreet,f.BillingAddress.BillingCity=b.oContractor.sBillingCity,f.BillingAddress.BillingPostalCode=b.oContractor.sBillingPostalCode,f.ShippingAddress={},f.ShippingAddress.ShippingStreet=b.oContractor.sShippingStreet,f.ShippingAddress.ShippingCity=b.oContractor.sShippingCity,f.ShippingAddress.ShippingPostalCode=b.oContractor.sShippingPostalCode;for(var k=0;k<b.aBillingCountries.length;k++)if(b.aBillingCountries[k].ticked){f.BillingAddress.BillingCountry=b.aBillingCountries[k].CountryCode;break}for(var k=0;k<b.aBillingProvinces.length;k++)if(b.aBillingProvinces[k].ticked){f.BillingAddress.BillingProvince=b.aBillingProvinces[k].ProvinceCode;break}for(var k=0;k<b.aShippingCountries.length;k++)if(b.aShippingCountries[k].ticked){f.ShippingAddress.ShippingCountry=b.aShippingCountries[k].CountryCode;break}for(var k=0;k<b.aShippingProvinces.length;k++)if(b.aShippingProvinces[k].ticked){f.ShippingAddress.ShippingProvince=b.aShippingProvinces[k].ProvinceCode;break}switch(f.LastModifiedAt=b.oContractor._lastModifiedAt,g=B(),b.sMode){case"edit":e.updateAccount({bShowSpinner:!0,sKey:f.Guid,oData:f,aLinks:g,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:j});break;case"create":f.AccountTypeGuid=b.sAccountTypeGuid,e.createAccount({bShowSpinner:!0,oData:f,aLinks:g,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:h})}},b.onSaveAndNew=function(){b.onSave(!0)};var C=function(){b.onSave(!1,p)},D=function(){o=!1,c.go(p.toState,p.toParams)};b.$on("$stateChangeStart",function(a,b,c){o&&(a.preventDefault(),p={toState:b,toParams:c},d.showConfirmationPopup({sHeader:f.instant("global_changesSaveConfirmationHeader"),sContent:f.instant("global_changesSaveConfirmationContent"),sOk:f.instant("global_yes"),sCancel:f.instant("global_no"),onOk:C,onCancel:D,event:a}))})}]),viewControllers.controller("contractorDetailsWrapperView",["$scope","$state","$stateParams","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h){a.sViewName="contractorDetailsWrapperView",a.sCurrentStateName=b.current.name,a.oStateParams=angular.copy(c),a.$on("$destroy",function(){h.addStateToHistory({sStateName:a.sCurrentStateName,oStateParams:angular.copy(a.oStateParams)})})}]),viewControllers.controller("contractorsListView",["$scope","$state","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider","$mdSidenav","$window","$filter",function(a,b,c,d,e,f,g,h,i,j){g.removeHistory(),a.actionsTE=d.instant("global_actions"),a.contractorNameTE=d.instant("global_contractorName"),a.phoneTE=d.instant("global_phone"),a.emailTE=d.instant("global_email"),a.tagsTE=d.instant("global_tags"),a.sCurrentStateName=b.current.name,a.oStateParams={};
var k={aData:[]};a.tableParams=c.createNgTable({oInitialDataArrayWrapper:k,sDisplayedDataArrayName:"aDisplayedContractors",oInitialSorting:{sContractorName:"asc"},sGroupBy:"sProjectPhase"});var l=function(b){for(var c="",e="",g=!1,h=0;h<b.length;h++){for(var i=0;i<b[h].PhaseDetails.results.length;i++)b[h].PhaseDetails.results[i]._sortingSequence=b[h].PhaseDetails.results[i].GeneralAttributes.SortingSequence;b[h].PhaseDetails.results=j("orderBy")(b[h].PhaseDetails.results,["_sortingSequence"]);for(var i=0;i<b[h].PhaseDetails.results.length;i++){g=!1;for(var l=0;l<f.oUserProfile.aGloballySelectedPhasesGuids.length;l++)if(b[h].PhaseDetails.results[i].Guid===f.oUserProfile.aGloballySelectedPhasesGuids[l]){g=!0;break}g&&(c="en"===d.use()?b[h].PhaseDetails.results[i].ProjectDetails.NameEN:b[h].PhaseDetails.results[i].ProjectDetails.NameFR,c||(c=b[h].PhaseDetails.results[i].ProjectDetails.NameEN),e="en"===d.use()?b[h].PhaseDetails.results[i].NameEN:b[h].PhaseDetails.results[i].NameFR,e||(e=b[h].PhaseDetails.results[i].NameEN),k.aData.push({sContractorName:b[h].Name,sPhone:b[h].MainPhone,sEmail:b[h].Email,_guid:b[h].Guid,sTags:b[h].DescriptionTags,sProjectPhase:c+" - "+e}))}}a.tableParams.reload()},m=function(){k.aData=[],e.getContractorsWithPhases({bShowSpinner:!0,onSuccess:l})};m(),a.onDisplay=function(a){b.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"display",sContractorGuid:a._guid})},a.onEdit=function(a){b.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"edit",sContractorGuid:a._guid})},a.onAddNew=function(){b.go("app.contractorDetailsWrapper.contractorDetails",{sMode:"create",sContractorGuid:""})},a.onGenerateReport=function(){e.generateReport({})},a.$on("globalUserPhasesHaveBeenChanged",function(){m()}),a.$on("accountsShouldBeRefreshed",function(){m()}),a.$on("$destroy",function(){g.addStateToHistory({sStateName:a.sCurrentStateName,oStateParams:a.oStateParams})})}]),viewControllers.controller("clientDetailsView",["$rootScope","$scope","$state","servicesProvider","apiProvider","$translate","$stateParams","cacheProvider","utilsProvider","$filter","dataProvider","CONSTANTS","historyProvider",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=g.sClientGuid;b.sAccountType="",b.bShowBackButton=m.aHistoryStates.length>0?!0:!1,b.$parent&&"clientDetailsWrapperView"===b.$parent.sViewName&&(b.$parent.oStateParams=angular.copy(g),b.sAccountType="Client"),b.sAccountTypeGuid="";var o=!1,p={};b.sMode=g.sMode,b.oClient={_aPhases:[]};var q={aData:[{}]},r=[];b.aBillingCountries=[],b.aBillingProvinces=[],b.aShippingCountries=[],b.aShippingProvinces=[];var s=function(a){b.aUserProjectsPhasesForMultiselect=d.constructUserProjectsPhasesForMultiSelect({aSelectedPhases:a})},t=function(a){var c=[];b.oClient._guid=a.Guid,b.oClient._lastModifiedAt=a.LastModifiedAt,b.oClient.sName=a.Name,b.oClient.sPhone=a.MainPhone,b.oClient.sSecondaryPhone=a.SecondaryPhone,b.oClient.sWebsite=a.Website,b.oClient.sEmail=a.Email,b.oClient.sFax=a.Fax,b.oClient.aTags=i.tagsStringToTagsArray(a.DescriptionTags),a.BillingAddress&&(b.oClient.sBillingStreet=a.BillingAddress.BillingStreet,b.oClient.sBillingCity=a.BillingAddress.BillingCity,b.oClient.sBillingPostalCode=a.BillingAddress.BillingPostalCode,b.oClient._billingCountryCode=a.BillingAddress.BillingCountry,b.oClient._billingProvinceCode=a.BillingAddress.BillingProvince),a.ShippingAddress&&(b.oClient.sShippingStreet=a.ShippingAddress.ShippingStreet,b.oClient.sShippingCity=a.ShippingAddress.ShippingCity,b.oClient.sShippingPostalCode=a.ShippingAddress.ShippingPostalCode,b.oClient._shippingCountryCode=a.ShippingAddress.ShippingCountry,b.oClient._shippingProvinceCode=a.ShippingAddress.ShippingProvince),b.oClient.sCreatedAt=i.dBDateToSting(a.CreatedAt),b.oClient.sLastModifiedAt=i.dBDateToSting(a.LastModifiedAt),b.oClient._aPhases=angular.copy(a.PhaseDetails.results);for(var d=0;d<b.oClient._aPhases.length;d++)c.push(b.oClient._aPhases[d].Guid);s(c),q.aData[0]=angular.copy(b.oClient)},u=h.getEntityDetails({sCacheProviderAttribute:"oAccountEntity",sRequestSettings:"CompanyName eq '"+h.oUserProfile.sCurrentCompany+"' and GeneralAttributes/IsDeleted eq falsePhaseDetails/ProjectDetails,AccountTypeDetails",sKeyName:"Guid",sKeyValue:g.sClientGuid}),v=function(a){var c=a.sParentKey,e="",f="";"billingAddress"===a.sProvincesFor?(e="aBillingProvinces",f="aBillingCountries"):(e="aShippingProvinces",f="aShippingCountries");for(var g=0;g<b[f].length;g++)if(b[f][g].ticked){for(var h=0;h<r.length;h++)if(b[f][g].CountryCode===r[h].CountryCode){d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:r[h].ProvinceDetails.results},oParentArrayWrapper:q,sNameEN:"Name",sNameFR:"Name",sDependentKey:"ProvinceCode",sParentKey:c,sTargetArrayNameInParent:e}),q.aData[0]&&(b[e]=angular.copy(q.aData[0][e]));break}break}},w=function(a){r=angular.copy(a),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:q,sNameEN:"Name",sNameFR:"Name",sDependentKey:"CountryCode",sParentKey:"_billingCountryCode",sTargetArrayNameInParent:"aBillingCountries"}),d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:q,sNameEN:"Name",sNameFR:"Name",sDependentKey:"CountryCode",sParentKey:"_shippingCountryCode",sTargetArrayNameInParent:"aShippingCountries"}),q.aData[0]&&(b.aBillingCountries=angular.copy(q.aData[0].aBillingCountries),b.aShippingCountries=angular.copy(q.aData[0].aShippingCountries)),b.oClient._billingCountryCode&&v({sParentKey:"_billingProvinceCode",sProvincesFor:"billingAddress"}),b.oClient._shippingCountryCode&&v({sParentKey:"_shippingProvinceCode",sProvincesFor:"shippingAddress"})},x=function(a){t(a),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:w})},y=function(){e.getAccountWithPhases({sKey:n,bShowSpinner:!0,onSuccess:x})},z=function(a){b.sAccountTypeGuid=a[0].Guid};"create"!==b.sMode?angular.equals(u,{})?y():(t(u),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:w})):(s({aSelectedPhases:[]}),e.getCountriesWithProvinces({bShowSpinner:!1,onSuccess:w}),"Client"===b.sAccountType&&e.getClientAccountType({bShowSpinner:!1,onSuccess:z}),"Client"===b.sAccountType&&e.getClientAccountType({bShowSpinner:!1,onSuccess:z})),b.onEdit=function(){c.go("app.clientDetailsWrapper.clientDetails",{sMode:"edit",sClientGuid:b.oClient._guid})};var A=function(){var a={GeneralAttributes:{IsDeleted:!0}},d=function(){m.navigateBack({oState:c})};a.Guid=b.oClient._guid,a.LastModifiedAt=b.oClient._lastModifiedAt,e.updateAccount({bShowSpinner:!0,sKey:a.Guid,oData:a,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})};b.onDelete=function(a){d.showConfirmationPopup({sHeader:f.instant("clientDetails_deletionConfirmationHeader"),sContent:f.instant("clientDetails_deletionConfirmationContent"),sOk:f.instant("global_ok"),sCancel:f.instant("global_cancel"),onOk:A,event:a})};var B=function(){for(var a=[],c=[],d="",e=0;e<b.aUserProjectsPhasesForMultiselect.length;e++)b.aUserProjectsPhasesForMultiselect[e].ticked&&(d="Phases('"+b.aUserProjectsPhasesForMultiselect[e].Guid+"')",c.push(d));return c.length&&a.push({sRelationName:"PhaseDetails",bKeepCompanyDependentLinks:!0,aUri:c}),a};b.onDataModified=function(){o=!0},b.onBillingCountryChanged=function(){b.onDataModified(),v({sParentKey:"",sProvincesFor:"billingAddress"})},b.onShippingCountryChanged=function(){b.onDataModified(),v({sParentKey:"",sProvincesFor:"shippingAddress"})},b.onBack=function(){m.navigateBack({oState:c})},b.onSave=function(a,d){var f={GeneralAttributes:{}},g=[],h=function(e){return o=!1,d?void c.go(d.toState,d.toParams):void(a?(b.oClient.sName="",b.oClient.sPhone="",b.oClient.sSecondaryPhone="",b.oClient.sWebsite="",b.oClient.sEmail="",b.oClient.sFax="",f.BillingAddress={},f.ShippingAddress={},b.oClient._aPhases=[]):(b.oClient._lastModifiedAt=e.LastModifiedAt,b.oClient.sLastModifiedAt=i.dBDateToSting(e.LastModifiedAt),b.oClient.sCreatedAt=i.dBDateToSting(e.CreatedAt),b.oClient._guid=e.Guid,b.$parent&&"clientDetailsWrapperView"===b.$parent.sViewName&&(b.$parent.oStateParams.sMode="display"),c.go("app.clientDetailsWrapper.clientDetails",{sMode:"display",sClientGuid:e.Guid})))},j=function(a){return o=!1,b.oClient._lastModifiedAt=a.LastModifiedAt,b.oClient.sLastModifiedAt=i.dBDateToSting(a.LastModifiedAt),d?void c.go(d.toState,d.toParams):(b.$parent&&"clientDetailsWrapperView"===b.$parent.sViewName&&(b.$parent.oStateParams.sMode="display"),void c.go("app.clientDetailsWrapper.clientDetails",{sMode:"display",sClientGuid:a.Guid}))};f.Guid=b.oClient._guid,f.Name=b.oClient.sName,f.MainPhone=b.oClient.sPhone?b.oClient.sPhone.replace(/\D/g,""):"",f.SecondaryPhone=b.oClient.sSecondaryPhone?b.oClient.sSecondaryPhone.replace(/\D/g,""):"",f.Fax=b.oClient.sFax?b.oClient.sFax.replace(/\D/g,""):"",f.Website=b.oClient.sWebsite,f.Email=b.oClient.sEmail,f.DescriptionTags=i.tagsArrayToTagsString(b.oClient.aTags),f.BillingAddress={},f.BillingAddress.BillingStreet=b.oClient.sBillingStreet,f.BillingAddress.BillingCity=b.oClient.sBillingCity,f.BillingAddress.BillingPostalCode=b.oClient.sBillingPostalCode,f.ShippingAddress={},f.ShippingAddress.ShippingStreet=b.oClient.sShippingStreet,f.ShippingAddress.ShippingCity=b.oClient.sShippingCity,f.ShippingAddress.ShippingPostalCode=b.oClient.sShippingPostalCode;for(var k=0;k<b.aBillingCountries.length;k++)if(b.aBillingCountries[k].ticked){f.BillingAddress.BillingCountry=b.aBillingCountries[k].CountryCode;break}for(var k=0;k<b.aBillingProvinces.length;k++)if(b.aBillingProvinces[k].ticked){f.BillingAddress.BillingProvince=b.aBillingProvinces[k].ProvinceCode;break}for(var k=0;k<b.aShippingCountries.length;k++)if(b.aShippingCountries[k].ticked){f.ShippingAddress.ShippingCountry=b.aShippingCountries[k].CountryCode;break}for(var k=0;k<b.aShippingProvinces.length;k++)if(b.aShippingProvinces[k].ticked){f.ShippingAddress.ShippingProvince=b.aShippingProvinces[k].ProvinceCode;break}switch(f.LastModifiedAt=b.oClient._lastModifiedAt,g=B(),b.sMode){case"edit":e.updateAccount({bShowSpinner:!0,sKey:f.Guid,oData:f,aLinks:g,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:j});break;case"create":f.AccountTypeGuid=b.sAccountTypeGuid,e.createAccount({bShowSpinner:!0,oData:f,aLinks:g,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:h})}},b.onSaveAndNew=function(){b.onSave(!0)};var C=function(){b.onSave(!1,p)},D=function(){o=!1,c.go(p.toState,p.toParams)};b.$on("$stateChangeStart",function(a,b,c){o&&(a.preventDefault(),p={toState:b,toParams:c},d.showConfirmationPopup({sHeader:f.instant("global_changesSaveConfirmationHeader"),sContent:f.instant("global_changesSaveConfirmationContent"),sOk:f.instant("global_yes"),sCancel:f.instant("global_no"),onOk:C,onCancel:D,event:a}))})}]),viewControllers.controller("clientDetailsWrapperView",["$scope","$state","$stateParams","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider",function(a,b,c,d,e,f,g,h){a.sViewName="clientDetailsWrapperView",a.sCurrentStateName=b.current.name,a.oStateParams=angular.copy(c),a.$on("$destroy",function(){h.addStateToHistory({sStateName:a.sCurrentStateName,oStateParams:angular.copy(a.oStateParams)})})}]),viewControllers.controller("clientsListView",["$scope","$state","servicesProvider","$translate","apiProvider","cacheProvider","historyProvider","$mdSidenav","$window","$filter",function(a,b,c,d,e,f,g,h,i,j){g.removeHistory(),a.actionsTE=d.instant("global_actions"),a.clientNameTE=d.instant("global_clientName"),a.phoneTE=d.instant("global_phone"),a.emailTE=d.instant("global_email"),a.tagsTE=d.instant("global_tags"),a.sCurrentStateName=b.current.name,a.oStateParams={};var k={aData:[]};a.tableParams=c.createNgTable({oInitialDataArrayWrapper:k,sDisplayedDataArrayName:"aDisplayedClients",oInitialSorting:{sClientName:"asc"},sGroupBy:"sProjectPhase"});var l=function(b){for(var c="",e="",g=!1,h=0;h<b.length;h++){for(var i=0;i<b[h].PhaseDetails.results.length;i++)b[h].PhaseDetails.results[i]._sortingSequence=b[h].PhaseDetails.results[i].GeneralAttributes.SortingSequence;b[h].PhaseDetails.results=j("orderBy")(b[h].PhaseDetails.results,["_sortingSequence"]);for(var i=0;i<b[h].PhaseDetails.results.length;i++){g=!1;for(var l=0;l<f.oUserProfile.aGloballySelectedPhasesGuids.length;l++)if(b[h].PhaseDetails.results[i].Guid===f.oUserProfile.aGloballySelectedPhasesGuids[l]){g=!0;break}g&&(c="en"===d.use()?b[h].PhaseDetails.results[i].ProjectDetails.NameEN:b[h].PhaseDetails.results[i].ProjectDetails.NameFR,c||(c=b[h].PhaseDetails.results[i].ProjectDetails.NameEN),e="en"===d.use()?b[h].PhaseDetails.results[i].NameEN:b[h].PhaseDetails.results[i].NameFR,e||(e=b[h].PhaseDetails.results[i].NameEN),k.aData.push({sClientName:b[h].Name,sPhone:b[h].MainPhone,sEmail:b[h].Email,_guid:b[h].Guid,sTags:b[h].DescriptionTags,sProjectPhase:c+" - "+e}))}}a.tableParams.reload()},m=function(){k.aData=[],e.getClientsWithPhases({bShowSpinner:!0,onSuccess:l})};m(),a.onDisplay=function(a){b.go("app.clientDetailsWrapper.clientDetails",{sMode:"display",sClientGuid:a._guid})},a.onEdit=function(a){b.go("app.clientDetailsWrapper.clientDetails",{sMode:"edit",sClientGuid:a._guid})},a.onAddNew=function(){b.go("app.clientDetailsWrapper.clientDetails",{sMode:"create",sClientGuid:""})},a.$on("globalUserPhasesHaveBeenChanged",function(){m()}),a.$on("accountsShouldBeRefreshed",function(){m()}),a.$on("$destroy",function(){g.addStateToHistory({sStateName:a.sCurrentStateName,oStateParams:a.oStateParams})})}]),viewControllers.controller("accountTypesListView",["$scope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate",function(a,b,c,d,e,f,g){a.actionsTE=g.instant("global_actions"),a.nameENTE=g.instant("global_descriptionEN"),a.nameFRTE=g.instant("global_descriptionFR"),a.sortingSequenceTE=g.instant("global_sortingSequence");var h=0,i={aData:[]};a.tableParams=c.createNgTable({oInitialDataArrayWrapper:i,sDisplayedDataArrayName:"aDisplayedAccountTypes",oInitialSorting:{sortingSequence:"asc"}});var j=function(b){for(var c=0;c<b.length;c++)i.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,nameEN:b[c].NameEN,nameFR:b[c].NameFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};f.getAccountTypes({bShowSpinner:!0,onSuccess:j}),a.onAddNew=function(){i.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:h}),h++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<i.aData.length;c++)if(i.aData[c]._guid===b._guid){i.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,f.updateAccountType({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<i.aData.length;e++)if(i.aData[e]._counter===b._counter){i.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._guid?(b.Guid=a._guid,f.updateAccountType({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):f.createAccountType({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("adminPanelView",["$scope","$state","servicesProvider","$window","CONSTANTS","cacheProvider","$mdSidenav","$window","historyProvider",function(a,b,c,d,e,f,g,d,h){h.removeHistory(),a.sGlobalAdministratorRole=e.sGlobalAdministatorRole,a.sCurrentRole=f.oUserProfile.sCurrentRole,a.toggleLeftSidenav=function(){g("left").toggle()};var i=function(a){g("left").close(),b.go(a)};a.onUserManagement=function(){i("app.adminPanel.usersList")},a.onRoles=function(){i("app.adminPanel.rolesList")},a.onProjects=function(){i("app.adminPanel.projectsList")},a.onPhases=function(){i("app.adminPanel.phasesList")},a.onOperationLogs=function(){i("app.adminPanel.operationLogsList")},a.onDeficiencyStatuses=function(){i("app.adminPanel.deficiencyStatusesList")},a.onDeficiencyPriorities=function(){i("app.adminPanel.deficiencyPrioritiesList")},a.onSystemFiles=function(){i("app.adminPanel.systemFiles")},a.onAccountTypes=function(){i("app.adminPanel.accountTypesList")},a.onContactTypes=function(){i("app.adminPanel.contactTypesList")},a.onCompanies=function(){i("app.adminPanel.companiesList")};var j=angular.element(d);j.bind("resize",function(){g("left").close()})}]),viewControllers.controller("companiesListView",["$scope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","CONSTANTS","cacheProvider","dataProvider",function(a,b,c,d,e,f,g,h,i,j){a.actionsTE=g.instant("global_actions"),a.companyNameTE=g.instant("companiesList_companyName"),a.descriptionENTE=g.instant("global_descriptionEN"),a.descriptionFRTE=g.instant("global_descriptionFR"),a.sortingSequenceTE=g.instant("global_sortingSequence");var k={aData:[]},l=0;a.tableParams=c.createNgTable({oInitialDataArrayWrapper:k,sDisplayedDataArrayName:"aDisplayedCompanies",oInitialSorting:{sortingSequence:"asc"}});var m=function(b){for(var c=0;c<b.length;c++)k.aData.push({_editMode:!1,_companyName:b[c].CompanyName,_lastModifiedAt:b[c].LastModifiedAt,companyName:b[c].CompanyName,descriptionEN:b[c].DescriptionEN,descriptionFR:b[c].DescriptionFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};f.getCompanies({bShowSpinner:!0,onSuccess:m}),a.onAddNew=function(){k.aData.push({_createMode:!0,_editMode:!0,sortingSequence:0,descriptionEN:"",descriptionFR:"",_counter:l}),l++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<k.aData.length;c++)if(k.aData[c]._companyName===b._companyName){k.aData.splice(c,1);break}a.tableParams.reload()};if(b._companyName)c.CompanyName=b._companyName,c.LastModifiedAt=b._lastModifiedAt,f.updateCompany({bShowSpinner:!0,sKey:c.CompanyName,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<k.aData.length;e++)if(k.aData[e]._counter===b._counter){k.aData.splice(e,1),a.tableParams.reload();break}};var n=function(a){var b={},c=i.oUserProfile.sUserName;b.RoleName=h.sDefaultRoleNameForNewCompany,b.CompanyName=a;var d=function(a){var b=[{sRelationName:"RoleDetails",aUri:["Roles('"+a.Guid+"')"]}];j.createLinks({aLinks:b,sParentEntityWithKey:"Users('"+c+"')"})};f.createRole({oData:b,onSuccess:d})},o=function(a){var b=i.oUserProfile.sUserName,c=[{sRelationName:"CompanyDetails",aUri:["Companys('"+a+"')"]}],d=function(){var a=i.oUserProfile.sCurrentCompany,c=i.oUserProfile.sCurrentRole;i.cleanEntitiesCache("oUserEntity"),i.oUserProfile=f.getUserProfile(b),i.oUserProfile.sCurrentCompany=a,i.oUserProfile.sCurrentRole=c};j.createLinks({aLinks:c,sParentEntityWithKey:"Users('"+b+"')",onSuccess:d})};a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._companyName=b.CompanyName,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1,a._createMode=!1,n(b.CompanyName),o(b.CompanyName)},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.DescriptionEN=a.descriptionEN,b.DescriptionFR=a.descriptionFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._companyName?(b.CompanyName=a._companyName,f.updateCompany({bShowSpinner:!0,sKey:b.CompanyName,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):(b.CompanyName=a.companyName,f.createCompany({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c}))}}]),viewControllers.controller("contactTypesListView",["$scope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate",function(a,b,c,d,e,f,g){a.actionsTE=g.instant("global_actions"),a.nameENTE=g.instant("global_descriptionEN"),a.nameFRTE=g.instant("global_descriptionFR"),a.sortingSequenceTE=g.instant("global_sortingSequence");var h=0,i={aData:[]};a.tableParams=c.createNgTable({oInitialDataArrayWrapper:i,sDisplayedDataArrayName:"aDisplayedContactTypes",oInitialSorting:{sortingSequence:"asc"}});var j=function(b){for(var c=0;c<b.length;c++)i.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,nameEN:b[c].NameEN,nameFR:b[c].NameFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};f.getContactTypes({bShowSpinner:!0,onSuccess:j}),a.onAddNew=function(){i.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:h}),h++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<i.aData.length;c++)if(i.aData[c]._guid===b._guid){i.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,f.updateContactType({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<i.aData.length;e++)if(i.aData[e]._counter===b._counter){i.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._guid?(b.Guid=a._guid,f.updateContactType({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):f.createContactType({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("deficiencyPrioritiesListView",["$scope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","$window",function(a,b,c,d,e,f,g){a.actionsTE=g.instant("global_actions"),a.nameENTE=g.instant("global_descriptionEN"),a.nameFRTE=g.instant("global_descriptionFR"),a.associatedColorTE=g.instant("global_associatedColor"),a.sortingSequenceTE=g.instant("global_sortingSequence");var h=0,i={aData:[]};a.tableParams=c.createNgTable({oInitialDataArrayWrapper:i,sDisplayedDataArrayName:"aDisplayedDeficiencyPriorities",oInitialSorting:{sortingSequence:"asc"}});var j=function(b){for(var c=0;c<b.length;c++)i.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,nameEN:b[c].NameEN,nameFR:b[c].NameFR,associatedColor:b[c].AssociatedColor,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};f.getDeficiencyPriorities({bShowSpinner:!0,onSuccess:j}),a.onAddNew=function(){i.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",associatedColor:"",_counter:h}),h++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<i.aData.length;c++)if(i.aData[c]._guid===b._guid){i.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,f.updateDeficiencyPriority({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<i.aData.length;e++)if(i.aData[e]._counter===b._counter){i.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.AssociatedColor=a.associatedColor,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._guid?(b.Guid=a._guid,f.updateDeficiencyPriority({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):f.createDeficiencyPriority({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("deficiencyStatusesListView",["$scope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","$window","cacheProvider",function(a,b,c,d,e,f,g,h,i){a.actionsTE=g.instant("global_actions"),a.iconTE=g.instant("global_icon"),a.nameENTE=g.instant("global_descriptionEN"),a.nameFRTE=g.instant("global_descriptionFR"),a.associatedColorTE=g.instant("global_associatedColor"),a.sortingSequenceTE=g.instant("global_sortingSequence");var j={aData:[]},k=0,l={aData:[]};a.tableParams=c.createNgTable({oInitialDataArrayWrapper:l,sDisplayedDataArrayName:"aDisplayedDeficiencyStatuses",oInitialSorting:{sortingSequence:"asc"}});var m=function(a){c.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:l,oNewParentItemArrayWrapper:j,sDependentKey:"guid",sParentKey:"_associatedIconFileGuid",sDependentIconKey:"guid",sTargetArrayNameInParent:"aStatusIcons"})},n=function(b){for(var c=0;c<b.length;c++)l.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,_associatedIconFileGuid:b[c].AssociatedIconFileGuid,sUrl:h.location.origin+h.location.pathname+"rest/file/get/"+b[c].AssociatedIconFileGuid,nameEN:b[c].NameEN,nameFR:b[c].NameFR,associatedColor:b[c].AssociatedColor,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload(),f.getAttachments({sPath:"rest/file/list/companyDependentSettings/"+i.oUserProfile.sCurrentCompany+"/_deficiencyStatuses_",onSuccess:m})};f.getDeficiencyStatuses({bShowSpinner:!0,onSuccess:n}),a.onAddNew=function(){l.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:k,aStatusIcons:angular.copy(j.aData)}),k++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<l.aData.length;c++)if(l.aData[c]._guid===b._guid){l.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,f.updateDeficiencyStatus({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<l.aData.length;e++)if(l.aData[e]._counter===b._counter){l.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1,a._associatedIconFileGuid=b.AssociatedIconFileGuid,a.sUrl=h.location.origin+h.location.pathname+"rest/file/get/"+b.AssociatedIconFileGuid},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt,a._associatedIconFileGuid=b.AssociatedIconFileGuid,a.sUrl=h.location.origin+h.location.pathname+"rest/file/get/"+b.AssociatedIconFileGuid};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.AssociatedColor=a.associatedColor,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt;for(var e=0;e<a.aStatusIcons.length;e++)if(a.aStatusIcons[e].ticked){b.AssociatedIconFileGuid=a.aStatusIcons[e].guid;break}a._guid?(b.Guid=a._guid,f.updateDeficiencyStatus({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):f.createDeficiencyStatus({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("operationLogsListView",["$scope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","utilsProvider",function(a,b,c,d,e,f,g,h){a.operationNameTE=g.instant("operationLogsList_operationName"),a.operationContentTE=g.instant("operationLogsList_operationContent"),a.createdByTE=g.instant("global_createdBy"),a.createdAtTE=g.instant("global_createdAt");var i={aData:[]};a.tableParams=c.createNgTable({oInitialDataArrayWrapper:i,sDisplayedDataArrayName:"aDisplayedOperationLogs",oInitialSorting:{createdAt:"desc"}});var j=function(b){for(var c={},d={},e=0;e<b.length;e++)c={},d={},c.operationName=b[e].OperationName,c.createdBy=b[e].GeneralAttributes.CreatedBy,c.createdAt=h.dBDateToSting(b[e].CreatedAt),d=h.stringToJson(b[e].OperationContent),c.operationContent=g.instant("global_role")+": "+d.sRole+", ",c.operationContent=c.operationContent+g.instant("global_company")+": "+d.sCompany,i.aData.push(c);a.tableParams.reload()};f.getOperationLogs({sPath:"OperationLogs",bShowSpinner:!0,onSuccess:j})}]),viewControllers.controller("phasesListView",["$scope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","cacheProvider",function(a,b,c,d,e,f,g,h){a.actionsTE=g.instant("global_actions"),a.projectTE=g.instant("global_project"),a.nameENTE=g.instant("global_descriptionEN"),a.nameFRTE=g.instant("global_descriptionFR"),a.sortingSequenceTE=g.instant("global_sortingSequence");var i={aData:[]},j=0,k={aData:[]};a.tableParams=c.createNgTable({oInitialDataArrayWrapper:k,sDisplayedDataArrayName:"aDisplayedPhases",oInitialSorting:{sortingSequence:"asc"}});var l=function(a){for(var b=0;b<a.length;b++)a[b]._sortingSequence=a[b].GeneralAttributes.SortingSequence;a=e("orderBy")(a,["_sortingSequence"]),c.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:k,oNewParentItemArrayWrapper:i,sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",sParentKey:"_projectGuid",sTargetArrayNameInParent:"aProjects"})},m=function(b){for(var c=0;c<b.length;c++){var d={};d._editMode=!1,d._guid=b[c].Guid,d._lastModifiedAt=b[c].LastModifiedAt,d.nameEN=b[c].NameEN,d.nameFR=b[c].NameFR,d.sortingSequence=b[c].GeneralAttributes.SortingSequence,b[c].ProjectDetails&&(d._projectGuid=b[c].ProjectDetails.Guid,d.projectName="en"===g.use()?b[c].ProjectDetails.NameEN:b[c].ProjectDetails.NameFR,d.projectName||(d.projectName=b[c].ProjectDetails.NameEN)),k.aData.push(d)}a.tableParams.reload(),f.getProjects({bShowSpinner:!1,onSuccess:l})};f.getPhases({bShowSpinner:!0,onSuccess:m}),a.onAddNew=function(){k.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:j,aProjects:angular.copy(i.aData)}),j++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<k.aData.length;c++)if(k.aData[c]._guid===b._guid){k.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,f.updatePhase({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<k.aData.length;e++)if(k.aData[e]._counter===b._counter){k.aData.splice(e,1),a.tableParams.reload();break}};var n="";a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1,a.projectName=n,n="",h.cleanEntitiesCache("oProjectEntity")},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt,a.projectName=n,n="",h.cleanEntitiesCache("oProjectEntity")};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt;for(var e=0;e<a.aProjects.length;e++)if(a.aProjects[e].ticked){b.ProjectGuid=a.aProjects[e].Guid,n=a.aProjects[e].name;break}a._guid?(b.Guid=a._guid,f.updatePhase({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):f.createPhase({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("projectsListView",["$scope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate",function(a,b,c,d,e,f,g){a.actionsTE=g.instant("global_actions"),a.nameENTE=g.instant("global_descriptionEN"),a.nameFRTE=g.instant("global_descriptionFR"),a.sortingSequenceTE=g.instant("global_sortingSequence");var h=0,i={aData:[]};a.tableParams=c.createNgTable({oInitialDataArrayWrapper:i,sDisplayedDataArrayName:"aDisplayedProjects",oInitialSorting:{sortingSequence:"asc"}});var j=function(b){for(var c=0;c<b.length;c++)i.aData.push({_editMode:!1,_guid:b[c].Guid,_lastModifiedAt:b[c].LastModifiedAt,nameEN:b[c].NameEN,nameFR:b[c].NameFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});
a.tableParams.reload()};f.getProjects({bShowSpinner:!0,onSuccess:j}),a.onAddNew=function(){i.aData.push({_editMode:!0,sortingSequence:0,nameEN:"",nameFR:"",_counter:h}),h++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<i.aData.length;c++)if(i.aData[c]._guid===b._guid){i.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,f.updateProject({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<i.aData.length;e++)if(i.aData[e]._counter===b._counter){i.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.NameEN=a.nameEN,b.NameFR=a.nameFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,a._guid?(b.Guid=a._guid,f.updateProject({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):f.createProject({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("rolesListView",["$scope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate",function(a,b,c,d,e,f,g){a.actionsTE=g.instant("global_actions"),a.roleNameTE=g.instant("rolesList_roleName"),a.descriptionENTE=g.instant("global_descriptionEN"),a.descriptionFRTE=g.instant("global_descriptionFR"),a.sortingSequenceTE=g.instant("global_sortingSequence");var h={aData:[]},i=0;a.tableParams=c.createNgTable({oInitialDataArrayWrapper:h,sDisplayedDataArrayName:"aDisplayedRoles",oInitialSorting:{sortingSequence:"asc"}});var j=function(b){for(var c=0;c<b.length;c++)h.aData.push({_editMode:!1,_guid:b[c].Guid,_roleName:b[c].RoleName,_lastModifiedAt:b[c].LastModifiedAt,roleName:b[c].RoleName,descriptionEN:b[c].DescriptionEN,descriptionFR:b[c].DescriptionFR,sortingSequence:b[c].GeneralAttributes.SortingSequence});a.tableParams.reload()};f.getRoles({bShowSpinner:!0,onSuccess:j}),a.onAddNew=function(){h.aData.push({_createMode:!0,_editMode:!0,sortingSequence:0,descriptionEN:"",descriptionFR:"",_counter:i}),i++,a.tableParams.reload()},a.onEdit=function(a){a._editMode=!0},a.onDelete=function(b){var c={GeneralAttributes:{IsDeleted:!0}},d=function(){for(var c=0;c<h.aData.length;c++)if(h.aData[c]._guid===b._guid){h.aData.splice(c,1);break}a.tableParams.reload()};if(b._guid)c.Guid=b._guid,c.LastModifiedAt=b._lastModifiedAt,f.updateRole({bShowSpinner:!0,sKey:c.Guid,oData:c,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d});else for(var e=0;e<h.aData.length;e++)if(h.aData[e]._counter===b._counter){h.aData.splice(e,1),a.tableParams.reload();break}},a.onSave=function(a){var b={GeneralAttributes:{}},c=function(b){a._guid=b.Guid,a._lastModifiedAt=b.LastModifiedAt,a._editMode=!1,a._createMode=!1},d=function(b){a._editMode=!1,a._lastModifiedAt=b.LastModifiedAt};b.DescriptionEN=a.descriptionEN,b.DescriptionFR=a.descriptionFR,b.GeneralAttributes.SortingSequence=a.sortingSequence,b.LastModifiedAt=a._lastModifiedAt,b.RoleName=a.roleName,a._guid?(b.Guid=a._guid,f.updateRole({bShowSpinner:!0,sKey:b.Guid,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})):f.createRole({bShowSpinner:!0,oData:b,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:c})}}]),viewControllers.controller("systemFilesView",["$scope","$state","servicesProvider","ngTableParams","$filter","apiProvider","$translate","$upload","$window","cacheProvider",function(a,b,c,d,e,f,g,h,i,j){a.actionsTE=g.instant("global_actions"),a.logoTE=g.instant("systemFiles_logo"),a.iconTE=g.instant("systemFiles_Icon");var k={aData:[]},l={aData:[]};a.logosTableParams=c.createNgTable({oInitialDataArrayWrapper:k,sDisplayedDataArrayName:"aDisplayedLogos"}),a.deficiencyStatusesTableParams=c.createNgTable({oInitialDataArrayWrapper:l,sDisplayedDataArrayName:"aDisplayedDeficiencyStatuses"});var m=function(a,b,c){for(var d=0;d<a.length;d++){var e={};e.sUrl=i.location.origin+i.location.pathname+"rest/file/get/"+a[d].guid,e._createMode=!1,e._editMode=!1,e._guid=a[d].guid,b.push(e)}c.reload()},n=function(a,b){var c={};c._createMode=!0,c._editMode=!0,a.push(c),b.reload()};a.onEditImg=function(a){a._editMode=!0};var o=function(a,b,d,e){d._guid&&c.deleteFileAttachment(d._guid),a.splice(e,1),b.reload()},p=function(a,b,c,d){c._guid||o(a,b,c,d),c._editMode=!1,c._createMode=!1},q=function(b,d,e,f,g){for(var j=0;j<b.length;j++){var k=b[j],d=c.costructUploadUrl({sPath:d});a.upload=h.upload({url:d,file:k}),a.upload.success(function(a){e[g]._createMode=!1,e[g]._editMode=!1,e[g].sUrl=i.location.origin+i.location.pathname+"rest/file/get/"+a,e[g]._guid=a})}};onLogoImgsLoaded=function(b){m(b,k.aData,a.logosTableParams)},onDeficienciesStatusesImgsLoaded=function(b){m(b,l.aData,a.deficiencyStatusesTableParams)},f.getAttachments({sPath:"rest/file/list/companyDependentSettings/"+j.oUserProfile.sCurrentCompany+"/_logo_",onSuccess:onLogoImgsLoaded}),f.getAttachments({sPath:"rest/file/list/companyDependentSettings/"+j.oUserProfile.sCurrentCompany+"/_deficiencyStatuses_",onSuccess:onDeficienciesStatusesImgsLoaded}),a.onAddNewLogo=function(){n(k.aData,a.logosTableParams)},a.onDeleteLogo=function(b,c){o(k.aData,a.logosTableParams,b,c)},a.onCancelLogo=function(b,c){p(k.aData,a.logosTableParams,b,c)},a.onLogoSelected=function(a,b,c){q(a,"rest/file/createUploadUrl/companyDependentSettings/"+j.oUserProfile.sCurrentCompany+"/_logo_",k.aData,b,c)},a.onAddNewDeficiencyStatus=function(){n(l.aData,a.deficiencyStatusesTableParams)},a.onDeleteDeficiencyStatus=function(b,c){o(l.aData,a.deficiencyStatusesTableParams,b,c)},a.onCancelDeficiencyStatus=function(b,c){p(l.aData,a.deficiencyStatusesTableParams,b,c)},a.onDeficiencyStatusSelected=function(a,b,c){q(a,"rest/file/createUploadUrl/companyDependentSettings/"+j.oUserProfile.sCurrentCompany+"/_deficiencyStatuses_",l.aData,b,c)}}]),viewControllers.controller("userDetailsView",["$rootScope","$scope","$state","servicesProvider","apiProvider","$translate","$stateParams","cacheProvider","utilsProvider","$filter","dataProvider","$window","$upload","CONSTANTS","historyProvider",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=g.sUserName,q=!1,r={};b.bShowBackButton=o.aHistoryStates.length>0?!0:!1,b.sCurrentStateName=c.current.name,b.oStateParams={},b.sGlobalAdministratorRole=n.sGlobalAdministatorRole,b.sCurrentRole=h.oUserProfile.sCurrentRole,b.sMode=g.sMode,b.oUser={_aCompanies:[],_aPhases:[],_aRoles:[]};var s={aData:[{}]};b.aCompanies=[],b.aRoles=[],b.aPhases=[];var t=function(a){b.oUser.sUserName=a.UserName,b.oUser.sEmail=a.EMail,b.oUser._lastModifiedAt=a.LastModifiedAt,b.oUser.sCreatedAt=i.dBDateToSting(a.CreatedAt),b.oUser.sLastModifiedAt=i.dBDateToSting(a.LastModifiedAt),b.oUser._aCompanies=angular.copy(a.CompanyDetails.results),b.oUser._aPhases=angular.copy(a.PhaseDetails.results),b.oUser._aRoles=angular.copy(a.RoleDetails.results),b.oUser.sAvatarUrl=a.AvatarFileGuid?l.location.origin+l.location.pathname+"rest/file/get/"+a.AvatarFileGuid:l.location.origin+l.location.pathname+"img/noAvatar.jpg",s.aData[0]=angular.copy(b.oUser)},u=h.getEntityDetails({sCacheProviderAttribute:"oUserEntity",sRequestSettings:"GeneralAttributes/IsDeleted eq falseCompanyDetails,PhaseDetails,RoleDetails",sKeyName:"UserName",sKeyValue:g.sUserName}),v=function(a){for(var c=0;c<a.length;c++)a[c]._sortingSequence=a[c].GeneralAttributes.SortingSequence;a=j("orderBy")(a,["_sortingSequence"]);for(var e=[],c=0;c<b.oUser._aCompanies.length;c++)e.push(b.oUser._aCompanies[c].CompanyName);d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:s,sNameEN:"CompanyName",sNameFR:"CompanyName",sDependentKey:"CompanyName",aParentKeys:e,sTargetArrayNameInParent:"aCompanies"}),s.aData[0]&&(b.aCompanies=angular.copy(s.aData[0].aCompanies))},w=function(a){for(var c=0;c<a.length;c++)a[c]._sortingSequence=a[c].GeneralAttributes.SortingSequence;a=j("orderBy")(a,["_sortingSequence"]);for(var e=[],c=0;c<b.oUser._aRoles.length;c++)e.push(b.oUser._aRoles[c].Guid);d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},oParentArrayWrapper:s,sNameEN:"RoleName",sNameFR:"RoleName",sDependentKey:"Guid",aParentKeys:e,sTargetArrayNameInParent:"aRoles"}),s.aData[0]&&(b.aRoles=angular.copy(s.aData[0].aRoles))},x=function(a){for(var c=0;c<a.length;c++){a[c]._sortingSequence=a[c].GeneralAttributes.SortingSequence;for(var e=0;e<a[c].PhaseDetails.results.length;e++){if(a[c].PhaseDetails.results[e].GeneralAttributes.IsDeleted){a[c].PhaseDetails.results.splice(e,1);break}a[c].PhaseDetails.results[e]._sortingSequence=a[c].PhaseDetails.results[e].GeneralAttributes.SortingSequence}a[c].PhaseDetails.results=j("orderBy")(a[c].PhaseDetails.results,["_sortingSequence"])}a=j("orderBy")(a,["_sortingSequence"]);for(var f=[],c=0;c<b.oUser._aPhases.length;c++)f.push(b.oUser._aPhases[c].Guid);d.constructDependentMultiSelectArray({oDependentArrayWrapper:{aData:a},sSecondLevelAttribute:"PhaseDetails",sSecondLevelNameEN:"NameEN",sSecondLevelNameFR:"NameFR",oParentArrayWrapper:s,sNameEN:"NameEN",sNameFR:"NameFR",sDependentKey:"Guid",aParentKeys:f,sTargetArrayNameInParent:"aPhases"}),s.aData[0]&&(b.aPhases=angular.copy(s.aData[0].aPhases))},y=function(a){t(a),e.getCompanies({bShowSpinner:!1,onSuccess:v}),e.getProjectsWithPhases({bShowSpinner:!1,onSuccess:x}),e.getRoles({bShowSpinner:!1,onSuccess:w})},z=function(){e.getUserWithCompaniesPhasesAndRoles({sKey:p,bShowSpinner:!0,onSuccess:y})};"create"!==b.sMode?angular.equals(u,{})?z():(t(u),e.getCompanies({bShowSpinner:!1,onSuccess:v}),e.getProjectsWithPhases({bShowSpinner:!1,onSuccess:x}),e.getRoles({bShowSpinner:!1,onSuccess:w})):(b.oUser.sAvatarUrl=l.location.origin+l.location.pathname+"img/noAvatar.jpg",e.getCompanies({bShowSpinner:!1,onSuccess:v}),e.getProjectsWithPhases({bShowSpinner:!1,onSuccess:x}),e.getRoles({bShowSpinner:!1,onSuccess:w})),b.onBack=function(){o.navigateBack({oState:c})},b.onEdit=function(){c.go("app.adminPanel.userDetails",{sMode:"edit",sUserName:b.oUser.sUserName})};var A=function(){var a={GeneralAttributes:{IsDeleted:!0}},d=function(){o.navigateBack({oState:c})};a.UserName=b.oUser.sUserName,a.LastModifiedAt=b.oUser._lastModifiedAt,e.updateUser({bShowSpinner:!0,sKey:a.UserName,oData:a,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:d})};b.onDelete=function(a){d.showConfirmationPopup({sHeader:f.instant("userDetails_deletionConfirmationHeader"),sContent:f.instant("userDetails_deletionConfirmationContent"),sOk:f.instant("global_ok"),sCancel:f.instant("global_cancel"),onOk:A,event:a})};var B=function(){for(var a=[],c=[],d="",e=0;e<b.aCompanies.length;e++)b.aCompanies[e].ticked&&(d="Companys('"+b.aCompanies[e].CompanyName+"')",c.push(d));c.length&&a.push({sRelationName:"CompanyDetails",aUri:c}),c=[];for(var e=0;e<b.aRoles.length;e++)b.aRoles[e].ticked&&(d="Roles('"+b.aRoles[e].Guid+"')",c.push(d));c.length&&a.push({sRelationName:"RoleDetails",bKeepCompanyDependentLinks:!0,aUri:c}),c=[];for(var e=0;e<b.aPhases.length;e++)b.aPhases[e].ticked&&(d="Phases('"+b.aPhases[e].Guid+"')",c.push(d));return c.length&&a.push({sRelationName:"PhaseDetails",bKeepCompanyDependentLinks:!0,aUri:c}),a};b.onDataModified=function(){q=!0},b.onSave=function(a,d){var g=new Hashes.SHA512,j={GeneralAttributes:{}},k=[],m=function(e){return q=!1,d?void c.go(d.toState,d.toParams):void(a?(b.oUser.sUserName="",b.oUser.sEmail="",b.oUser._aCompanies=[],b.oUser._aPhases=[],b.oUser._aRoles=[],b.oUser.sPassword="",b.oUser.sPasswordConfirmation="",b.oUser.sAvatarUrl=l.location.origin+l.location.pathname+"img/noAvatar.jpg"):(c.go("app.adminPanel.userDetails",{sMode:"display",sUserName:e.UserName}),b.oUser._lastModifiedAt=e.LastModifiedAt,b.oUser.sLastModifiedAt=i.dBDateToSting(e.LastModifiedAt),b.oUser.sCreatedAt=i.dBDateToSting(e.CreatedAt),b.oUser.sPassword="",b.oUser.sPasswordConfirmation=""))},n=function(a){var f=h.oUserProfile.sCurrentCompany,g=h.oUserProfile.sCurrentRole;return a.UserName===h.oUserProfile.sUserName&&(h.oUserProfile=e.getUserProfile(a.UserName),h.oUserProfile.sCurrentCompany=f,h.oUserProfile.sCurrentRole=g),q=!1,d?void c.go(d.toState,d.toParams):(b.oUser._lastModifiedAt=a.LastModifiedAt,b.oUser.sLastModifiedAt=i.dBDateToSting(a.LastModifiedAt),b.oUser.sPassword="",b.oUser.sPasswordConfirmation="",void c.go("app.adminPanel.userDetails",{sMode:"display",sUserName:a.UserName}))};switch(j.UserName=b.oUser.sUserName,j.EMail=b.oUser.sEmail,j.LastModifiedAt=b.oUser._lastModifiedAt,j.AvatarFileGuid=b.oUser._avatarFileGuid,b.oUser.sPassword&&b.oUser.sPassword===b.oUser.sPasswordConfirmation&&(j.Password=e.hashPassword(g.hex(b.oUser.sPassword)),j.IsPasswordInitial=!0),k=B(),b.sMode){case"edit":e.updateUser({bShowSpinner:!0,sKey:j.UserName,oData:j,aLinks:k,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:n});break;case"create":if(!j.Password)return void i.displayMessage({sText:f.instant("global_noInitialPasswordProvided"),sType:"error"});e.createUser({bShowSpinner:!0,oData:j,aLinks:k,bShowSuccessMessage:!0,bShowErrorMessage:!0,onSuccess:m})}},b.onSaveAndNew=function(){b.onSave(!0)};var C=function(a,c){for(var e=0;e<a.length;e++){var f=a[e],c=d.costructUploadUrl({sPath:c});b.upload=m.upload({url:c,file:f}),b.upload.success(function(a){b.oUser.sAvatarUrl=l.location.origin+l.location.pathname+"rest/file/get/"+a,b.oUser._avatarFileGuid=a})}};b.onAvatarSelected=function(a,c){b.onDataModified(),C(a,"rest/file/createUploadUrl/users/users/_avatar_",c)};var D=function(){b.onSave(!1,r)},E=function(){q=!1,c.go(r.toState,r.toParams)};b.$on("$stateChangeStart",function(a,b,c){q&&(a.preventDefault(),r={toState:b,toParams:c},d.showConfirmationPopup({sHeader:f.instant("global_changesSaveConfirmationHeader"),sContent:f.instant("global_changesSaveConfirmationContent"),sOk:f.instant("global_yes"),sCancel:f.instant("global_no"),onOk:D,onCancel:E,event:a}))}),b.$on("$destroy",function(){o.addStateToHistory({sStateName:b.sCurrentStateName,oStateParams:angular.copy(b.oStateParams)})})}]),viewControllers.controller("usersListView",["$scope","$state","servicesProvider","apiProvider","$translate","$window","cacheProvider","CONSTANTS","historyProvider",function(a,b,c,d,e,f,g,h,i){i.removeHistory(),a.actionsTE=e.instant("global_actions"),a.userNameTE=e.instant("global_userName"),a.emailTE=e.instant("global_email"),a.rolesTE=e.instant("global_roles"),a.companiesTE=e.instant("adminPanel_companies"),a.sCurrentStateName=b.current.name,a.oStateParams={},a.sGlobalAdministratorRole=h.sGlobalAdministatorRole,a.sCurrentRole=g.oUserProfile.sCurrentRole;var j={aData:[]};a.tableParams=c.createNgTable({oInitialDataArrayWrapper:j,sDisplayedDataArrayName:"aDisplayedUsers",oInitialSorting:{userName:"asc"}});var k=function(a){for(var b=0;b<j.aData.length;b++){j.aData[b].sCompanies="";for(var c=0;c<j.aData[b]._companyDetails.results.length;c++)for(var d=0;d<a.length;d++)if(j.aData[b]._companyDetails.results[c].CompanyName===a[d].CompanyName){j.aData[b].sCompanies=j.aData[b].sCompanies+a[d].CompanyName+"; ";break}}},l=function(a){for(var b=0;b<j.aData.length;b++){j.aData[b].sRoles="";for(var c=0;c<j.aData[b]._roleDetails.results.length;c++)for(var d=0;d<a.length;d++)if(j.aData[b]._roleDetails.results[c].Guid===a[d].Guid){j.aData[b].sRoles=j.aData[b].sRoles+a[d].RoleName+"; ";break}}},m=function(b){for(var c=!1,e=0;e<b.length;e++){if(g.oUserProfile.sCurrentRole!==h.sGlobalAdministatorRole){c=!1;for(var f=0;f<b[e].CompanyDetails.results.length;f++)if(b[e].CompanyDetails.results[f].CompanyName===g.oUserProfile.sCurrentCompany){c=!0;break}if(!c)continue;c=!1;for(var f=0;f<b[e].RoleDetails.results.length;f++)if(b[e].RoleDetails.results[f].RoleName===h.sGlobalAdministatorRole&&b[e].UserName!==g.oUserProfile.sUserName){c=!0;break}if(c)continue}j.aData.push({userName:b[e].UserName,email:b[e].EMail,_roleDetails:b[e].RoleDetails,_companyDetails:b[e].CompanyDetails,_lastModifiedAt:b[e].LastModifiedAt,roles:""})}a.tableParams.reload(),d.getCompanies({bShowSpinner:!1,onSuccess:k}),d.getRoles({bShowSpinner:!1,onSuccess:l})};d.getUsersWithCompaniesPhasesAndRoles({bShowSpinner:!0,onSuccess:m}),a.onDisplay=function(a){b.go("app.adminPanel.userDetails",{sMode:"display",sUserName:a.userName})},a.onEdit=function(a){b.go("app.adminPanel.userDetails",{sMode:"edit",sUserName:a.userName})},a.onAddNew=function(){b.go("app.adminPanel.userDetails",{sMode:"create",sUserName:""})},a.$on("$destroy",function(){i.addStateToHistory({sStateName:a.sCurrentStateName,oStateParams:a.oStateParams})})}]);
//# sourceMappingURL=conspector.min.js.map